var U=Object.defineProperty;var x=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var w=(t,e,i)=>e in t?U(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,b=(t,e)=>{for(var i in e||(e={}))W.call(e,i)&&w(t,i,e[i]);if(x)for(var i of x(e))R.call(e,i)&&w(t,i,e[i]);return t};import{bD as V,c3 as I,b7 as L,bQ as q,aW as h,aX as j,aY as E,fW as _}from"./vendor.70daa49e.js";import{t as $}from"./BitmapContainer.ff910785.js";import{l as D}from"./LayerView2D.291c660d.js";import{S as P}from"./ExportStrategy.f46421bd.js";import{i as z}from"./RefreshableLayerView.765039f7.js";import{a as B}from"./WMSLayerView.a2e8eca9.js";import"./brushes.00614641.js";import"./definitions.21e97413.js";import"./Utils.8da54d2f.js";import"./number.dfbabd3f.js";import"./programUtils.96aa856a.js";import"./GeometryUtils.ea8c8742.js";import"./MaterialKey.f8f54134.js";import"./pixelUtils.59d1e551.js";import"./WGLContainer.054d692c.js";import"./Container.879a33d6.js";import"./EffectView.39edae97.js";import"./Bitmap.f5efb0a9.js";import"./ExportWMSImageParameters.374266a6.js";const F=V.getLogger("esri.views.2d.layers.WMSLayerView2D");let s=class extends B(z(D(_))){initialize(){const{layer:t,view:e}=this;t.supportsSpatialReference(e.spatialReference)||this.addResolvingPromise(Promise.reject(new I("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view",{layer:t})))}update(t){this.strategy.update(t).catch(e=>{L(e)||F.error(e)})}attach(){const{layer:t}=this,{imageMaxHeight:e,imageMaxWidth:i}=t;this._bitmapContainer=new $,this.container.addChild(this._bitmapContainer),this.strategy=new P({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:e,imageMaxWidth:i,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add(this.watch("exportImageVersion",()=>this.requestUpdate()),"exportImageVersion")}detach(){this.handles.remove("exportImageVersion"),this.strategy.destroy(),this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(t){const{view:e}=this,i=this._bitmapContainer,{x:r,y:o}=t,{spatialReference:v}=e;let a=null,n=0,d=0;if(i.children.some(S=>{const{width:c,height:f,resolution:y,x:p,y:m}=S,u=p+y*c,g=m-y*f;return r>=p&&r<=u&&o<=m&&o>=g&&(a=new q({xmin:p,ymin:g,xmax:u,ymax:m,spatialReference:v}),n=c,d=f,!0)}),!a)return null;const l=a.width/n,C=Math.round((r-a.xmin)/l),M=Math.round((a.ymax-o)/l);return{extent:a,width:n,height:d,x:C,y:M}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,i,r){return this.layer.fetchImage(t,e,i,b({timeExtent:this.timeExtent},r))}};h([j()],s.prototype,"strategy",void 0),h([j()],s.prototype,"updating",void 0),s=h([E("esri.views.2d.layers.WMSLayerView2D")],s);const ne=s;export{ne as default};
