var U=Object.defineProperty;var b=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var x=(t,e,i)=>e in t?U(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,j=(t,e)=>{for(var i in e||(e={}))R.call(e,i)&&x(t,i,e[i]);if(b)for(var i of b(e))V.call(e,i)&&x(t,i,e[i]);return t};import{X as W,an as q,g as I,a8 as L,e as m,d as w,i as E,eg as _}from"./index.fe92decb.js";import{t as $}from"./BitmapContainer.0f2de15d.js";import{l as P}from"./LayerView2D.7ca65bda.js";import{S as D}from"./ExportStrategy.a966b2f3.js";import{i as z}from"./RefreshableLayerView.4c074742.js";import{a as B}from"./WMSLayerView.ca583267.js";import"./vendor.d9e807b5.js";import"./index.dbbecfd7.js";/* empty css              */import"./qrcode.0911187d.js";/* empty css                 */import"./brushes.54912a2b.js";import"./definitions.21e97413.js";import"./Utils.b6ae6dd5.js";import"./number.dfbabd3f.js";import"./programUtils.bb88f8de.js";import"./GeometryUtils.ea8c8742.js";import"./MaterialKey.2ed20ae2.js";import"./pixelUtils.bd04c746.js";import"./WGLContainer.8d1ee991.js";import"./Container.2f7d1138.js";import"./EffectView.873e2976.js";import"./Bitmap.5c133e5a.js";import"./ExportWMSImageParameters.1d87ed7d.js";const F=W.getLogger("esri.views.2d.layers.WMSLayerView2D");let s=class extends B(z(P(_))){initialize(){const{layer:t,view:e}=this;t.supportsSpatialReference(e.spatialReference)||this.addResolvingPromise(Promise.reject(new q("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view",{layer:t})))}update(t){this.strategy.update(t).catch(e=>{I(e)||F.error(e)})}attach(){const{layer:t}=this,{imageMaxHeight:e,imageMaxWidth:i}=t;this._bitmapContainer=new $,this.container.addChild(this._bitmapContainer),this.strategy=new D({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:e,imageMaxWidth:i,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add(this.watch("exportImageVersion",()=>this.requestUpdate()),"exportImageVersion")}detach(){this.handles.remove("exportImageVersion"),this.strategy.destroy(),this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(t){const{view:e}=this,i=this._bitmapContainer,{x:a,y:o}=t,{spatialReference:v}=e;let r=null,n=0,h=0;if(i.children.some(S=>{const{width:l,height:y,resolution:f,x:d,y:p}=S,g=d+f*l,u=p-f*y;return a>=d&&a<=g&&o<=p&&o>=u&&(r=new L({xmin:d,ymin:u,xmax:g,ymax:p,spatialReference:v}),n=l,h=y,!0)}),!r)return null;const c=r.width/n,C=Math.round((a-r.xmin)/c),M=Math.round((r.ymax-o)/c);return{extent:r,width:n,height:h,x:C,y:M}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,i,a){return this.layer.fetchImage(t,e,i,j({timeExtent:this.timeExtent},a))}};m([w()],s.prototype,"strategy",void 0),m([w()],s.prototype,"updating",void 0),s=m([E("esri.views.2d.layers.WMSLayerView2D")],s);const ce=s;export{ce as default};
