import{aX as u,aY as g,aZ as Y,fS as q,bO as R,du as G,lJ as E,n0 as S,jN as k,gJ as N,gn as m,gM as j,n1 as h,n2 as C,go as D,gm as z,hj as J,n3 as A,cz as V,n4 as H,n5 as U,n6 as W,aq as X,b0 as v,n7 as Z,n8 as K,lN as w,n9 as Q,na as L,b5 as f,nb as x,nc as y,nd as nn,ne as tn,gx as rn,nf as en,bG as an,l3 as on,gL as ln,ng as sn,nh as cn,ni as pn,nj as un,nk as gn,nl as fn}from"./vendor.c8f3cc8c.js";import{a as B,l as hn,x as yn}from"./axisAngleDegrees.9dcb11b2.js";var T;let p=T=class extends q{constructor(n){super(n),this.origin=R(),this.translation=R(),this.rotation=B(),this.scale=G(1,1,1),this.geographic=!0}get localMatrix(){const n=m();return E(n,n,this.scale),S(n,n,yn(this.rotation),hn(this.rotation)),k(n,n,this.translation),n}get localMatrixInverse(){return N(m(),this.localMatrix)}applyLocal(n,r){return j(r,n,this.localMatrix)}applyLocalInverse(n,r){return j(r,n,this.localMatrixInverse)}project(n,r){const t=new Float64Array(n.length),e=h.fromTypedArray(t),a=h.fromTypedArray(n);if(this.geographic){const l=C(D(r)),c=m();return z(r,this.origin,c,l),J(c,c,this.localMatrix),A(e,a,c),V(t,l,0,t,r,0,t.length/3),t}const{localMatrix:o,origin:i}=this;H(o,U)?W(e,a):A(e,a,o);for(let l=0;l<t.length;l+=3)t[l+0]+=i[0],t[l+1]+=i[1],t[l+2]+=i[2];return t}getOriginPoint(n){const[r,t,e]=this.origin;return new X({x:r,y:t,z:e,spatialReference:n})}equals(n){return v(n)&&this.geographic===n.geographic&&Z(this.origin,n.origin)&&K(this.localMatrix,n.localMatrix)}clone(){const n={origin:w(this.origin),translation:w(this.translation),rotation:B(this.rotation),scale:w(this.scale),geographic:this.geographic};return new T(n)}};u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"origin",void 0),u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"translation",void 0),u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"rotation",void 0),u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"scale",void 0),u([g({type:Boolean,nonNullable:!0,json:{write:!0}})],p.prototype,"geographic",void 0),u([g()],p.prototype,"localMatrix",null),u([g()],p.prototype,"localMatrixInverse",null),p=T=u([Y("esri.geometry.support.MeshTransform")],p);const mn=p;function d(n,r){var t;return n.isGeographic||n.isWebMercator&&((t=r==null?void 0:r.geographic)==null||t)}function O(n,r,t){return d(r.spatialReference,t)?$n(n,r,t):dn(n,r,t)}function An(n,r,t){const{position:e,normal:a,tangent:o}=n;if(f(r))return{position:e,normal:a,tangent:o};const i=r.localMatrix;return O({position:un(e,new Float64Array(e.length),i),normal:v(a)?gn(a,new Float32Array(a.length),i):null,tangent:v(o)?fn(o,new Float32Array(o.length),i):null},r.getOriginPoint(t),{geographic:r.geographic})}function zn(n,r,t){if(t!=null&&t.useTransform){var e;const{position:a,normal:o,tangent:i}=n;return{vertexAttributes:{position:a,normal:o,tangent:i},transform:new mn({origin:[r.x,r.y,(e=r.z)!=null?e:0],geographic:d(r.spatialReference,t)})}}return{vertexAttributes:O(n,r,t),transform:null}}function xn(n,r,t){return d(r.spatialReference,t)?_(n,r,t):b(n,r,t)}function Ln(n,r,t,e){if(f(r))return xn(n,t,e);const a=An(n,r,t.spatialReference);return t.equals(r.getOriginPoint(t.spatialReference))?b(a,t,e):d(t.spatialReference,e)?_(a,t,e):b(a,t,e)}function dn(n,r,t){const e=new Float64Array(n.position.length),a=n.position,o=r.x,i=r.y,l=r.z||0,{horizontal:c,vertical:$}=M(t?t.unit:null,r.spatialReference);for(let s=0;s<a.length;s+=3)e[s+0]=a[s+0]*c+o,e[s+1]=a[s+1]*c+i,e[s+2]=a[s+2]*$+l;return{position:e,normal:n.normal,tangent:n.tangent}}function $n(n,r,t){const e=r.spatialReference,a=P(r,t,F),o=new Float64Array(n.position.length),i=vn(n.position,a,e,o),l=L(I,a);return{position:i,normal:wn(i,o,n.normal,l,e),tangent:Tn(i,o,n.tangent,l,e)}}function vn(n,r,t,e){A(h.fromTypedArray(e),h.fromTypedArray(n),r);const a=new Float64Array(n.length);return Q(e,a,t)}function wn(n,r,t,e,a){if(f(t))return null;const o=new Float32Array(t.length);return x(y.fromTypedArray(o),y.fromTypedArray(t),e),nn(o,n,r,a,o),o}function Tn(n,r,t,e,a){if(f(t))return null;const o=new Float32Array(t.length);x(y.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT),y.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),e);for(let i=3;i<o.length;i+=4)o[i]=t[i];return tn(o,n,r,a,o),o}function b(n,r,t){const e=new Float64Array(n.position.length),a=n.position,o=r.x,i=r.y,l=r.z||0,{horizontal:c,vertical:$}=M(t?t.unit:null,r.spatialReference);for(let s=0;s<a.length;s+=3)e[s+0]=(a[s+0]-o)/c,e[s+1]=(a[s+1]-i)/c,e[s+2]=(a[s+2]-l)/$;return{position:e,normal:n.normal,tangent:n.tangent}}function _(n,r,t){const e=r.spatialReference;P(r,t,F);const a=N(Rn,F),o=new Float64Array(n.position.length),i=bn(n.position,e,a,o),l=L(I,a);return{position:i,normal:Mn(n.normal,n.position,o,e,l),tangent:Fn(n.tangent,n.position,o,e,l)}}function P(n,r,t){z(n.spatialReference,[n.x,n.y,n.z||0],t,rn(n.spatialReference));const{horizontal:e,vertical:a}=M(r?r.unit:null,n.spatialReference);return E(t,t,[e,e,a]),t}function bn(n,r,t,e){const a=sn(n,r,e),o=h.fromTypedArray(a),i=new Float64Array(a.length),l=h.fromTypedArray(i);return A(l,o,t),i}function Mn(n,r,t,e,a){if(f(n))return null;const o=cn(n,r,t,e,new Float32Array(n.length)),i=y.fromTypedArray(o);return x(i,i,a),o}function Fn(n,r,t,e,a){if(f(n))return null;const o=pn(n,r,t,e,new Float32Array(n.length)),i=y.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT);return x(i,i,a),o}function M(n,r){if(f(n))return En;const t=r.isGeographic?1:en(r),e=r.isGeographic?1:an(r),a=on(1,n,"meters");return{horizontal:a*t,vertical:a*e}}const F=m(),Rn=m(),I=ln(),En={horizontal:1,vertical:1};export{Ln as M,mn as O,An as _,zn as b,xn as k,d as r,O as x};
