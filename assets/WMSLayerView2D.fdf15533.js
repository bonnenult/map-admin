var U=Object.defineProperty;var x=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var b=(t,e,i)=>e in t?U(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,w=(t,e)=>{for(var i in e||(e={}))R.call(e,i)&&b(t,i,e[i]);if(x)for(var i of x(e))V.call(e,i)&&b(t,i,e[i]);return t};import{bF as W,c5 as I,b9 as L,bS as _,aY as h,aZ as j,a_ as q,fY as E}from"./vendor.47ccae81.js";import{t as $}from"./BitmapContainer.0f98133e.js";import{l as P}from"./LayerView2D.867d4d61.js";import{S as D}from"./ExportStrategy.dd315741.js";import{i as F}from"./RefreshableLayerView.c34d7575.js";import{a as z}from"./WMSLayerView.d487d0f9.js";import"./brushes.c1614039.js";import"./definitions.21e97413.js";import"./Utils.30b0e1a1.js";import"./number.dfbabd3f.js";import"./programUtils.780f0e0a.js";import"./GeometryUtils.ea8c8742.js";import"./MaterialKey.fbe0cf96.js";import"./pixelUtils.b67e8c28.js";import"./WGLContainer.22553251.js";import"./Container.034dd5d7.js";import"./EffectView.fdd4aaf1.js";import"./Bitmap.cada6152.js";import"./ExportWMSImageParameters.47bc5897.js";const B=W.getLogger("esri.views.2d.layers.WMSLayerView2D");let s=class extends z(F(P(E))){initialize(){const{layer:t,view:e}=this;t.supportsSpatialReference(e.spatialReference)||this.addResolvingPromise(Promise.reject(new I("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view",{layer:t})))}update(t){this.strategy.update(t).catch(e=>{L(e)||B.error(e)})}attach(){const{layer:t}=this,{imageMaxHeight:e,imageMaxWidth:i}=t;this._bitmapContainer=new $,this.container.addChild(this._bitmapContainer),this.strategy=new D({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:e,imageMaxWidth:i,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add(this.watch("exportImageVersion",()=>this.requestUpdate()),"exportImageVersion")}detach(){this.handles.remove("exportImageVersion"),this.strategy.destroy(),this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(t){const{view:e}=this,i=this._bitmapContainer,{x:r,y:o}=t,{spatialReference:v}=e;let a=null,n=0,d=0;if(i.children.some(S=>{const{width:l,height:f,resolution:y,x:p,y:m}=S,u=p+y*l,g=m-y*f;return r>=p&&r<=u&&o<=m&&o>=g&&(a=new _({xmin:p,ymin:g,xmax:u,ymax:m,spatialReference:v}),n=l,d=f,!0)}),!a)return null;const c=a.width/n,C=Math.round((r-a.xmin)/c),M=Math.round((a.ymax-o)/c);return{extent:a,width:n,height:d,x:C,y:M}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,i,r){return this.layer.fetchImage(t,e,i,w({timeExtent:this.timeExtent},r))}};h([j()],s.prototype,"strategy",void 0),h([j()],s.prototype,"updating",void 0),s=h([q("esri.views.2d.layers.WMSLayerView2D")],s);const ne=s;export{ne as default};
