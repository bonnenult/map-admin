import{aY as u,aZ as g,a_ as Y,fT as q,bP as R,dv as k,lK as E,n1 as G,jO as S,gK as N,go as m,gN as j,n2 as h,n3 as C,gp as D,gn as z,hk as H,n4 as A,cA as K,n5 as V,n6 as J,n7 as U,aq as W,b1 as $,n8 as Z,n9 as Q,lO as w,na as X,nb as L,b6 as f,nc as x,nd as y,ne as nn,nf as tn,gy as en,ng as rn,bH as an,l4 as on,gM as ln,nh as sn,ni as cn,nj as pn,nk as un,nl as gn,nm as fn}from"./vendor.47ccae81.js";import{a as O,l as hn,x as yn}from"./axisAngleDegrees.66febbc9.js";var T;let p=T=class extends q{constructor(n){super(n),this.origin=R(),this.translation=R(),this.rotation=O(),this.scale=k(1,1,1),this.geographic=!0}get localMatrix(){const n=m();return E(n,n,this.scale),G(n,n,yn(this.rotation),hn(this.rotation)),S(n,n,this.translation),n}get localMatrixInverse(){return N(m(),this.localMatrix)}applyLocal(n,e){return j(e,n,this.localMatrix)}applyLocalInverse(n,e){return j(e,n,this.localMatrixInverse)}project(n,e){const t=new Float64Array(n.length),r=h.fromTypedArray(t),a=h.fromTypedArray(n);if(this.geographic){const l=C(D(e)),c=m();return z(e,this.origin,c,l),H(c,c,this.localMatrix),A(r,a,c),K(t,l,0,t,e,0,t.length/3),t}const{localMatrix:o,origin:i}=this;V(o,J)?U(r,a):A(r,a,o);for(let l=0;l<t.length;l+=3)t[l+0]+=i[0],t[l+1]+=i[1],t[l+2]+=i[2];return t}getOriginPoint(n){const[e,t,r]=this.origin;return new W({x:e,y:t,z:r,spatialReference:n})}equals(n){return $(n)&&this.geographic===n.geographic&&Z(this.origin,n.origin)&&Q(this.localMatrix,n.localMatrix)}clone(){const n={origin:w(this.origin),translation:w(this.translation),rotation:O(this.rotation),scale:w(this.scale),geographic:this.geographic};return new T(n)}};u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"origin",void 0),u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"translation",void 0),u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"rotation",void 0),u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"scale",void 0),u([g({type:Boolean,nonNullable:!0,json:{write:!0}})],p.prototype,"geographic",void 0),u([g()],p.prototype,"localMatrix",null),u([g()],p.prototype,"localMatrixInverse",null),p=T=u([Y("esri.geometry.support.MeshTransform")],p);const mn=p;function d(n,e){var t;return n.isGeographic||n.isWebMercator&&((t=e==null?void 0:e.geographic)==null||t)}function _(n,e,t){return d(e.spatialReference,t)?vn(n,e,t):dn(n,e,t)}function An(n,e,t){const{position:r,normal:a,tangent:o}=n;if(f(e))return{position:r,normal:a,tangent:o};const i=e.localMatrix;return _({position:un(r,new Float64Array(r.length),i),normal:$(a)?gn(a,new Float32Array(a.length),i):null,tangent:$(o)?fn(o,new Float32Array(o.length),i):null},e.getOriginPoint(t),{geographic:e.geographic})}function zn(n,e,t){if(t!=null&&t.useTransform){var r;const{position:a,normal:o,tangent:i}=n;return{vertexAttributes:{position:a,normal:o,tangent:i},transform:new mn({origin:[e.x,e.y,(r=e.z)!=null?r:0],geographic:d(e.spatialReference,t)})}}return{vertexAttributes:_(n,e,t),transform:null}}function xn(n,e,t){return d(e.spatialReference,t)?B(n,e,t):b(n,e,t)}function Ln(n,e,t,r){if(f(e))return xn(n,t,r);const a=An(n,e,t.spatialReference);return t.equals(e.getOriginPoint(t.spatialReference))?b(a,t,r):d(t.spatialReference,r)?B(a,t,r):b(a,t,r)}function dn(n,e,t){const r=new Float64Array(n.position.length),a=n.position,o=e.x,i=e.y,l=e.z||0,{horizontal:c,vertical:v}=M(t?t.unit:null,e.spatialReference);for(let s=0;s<a.length;s+=3)r[s+0]=a[s+0]*c+o,r[s+1]=a[s+1]*c+i,r[s+2]=a[s+2]*v+l;return{position:r,normal:n.normal,tangent:n.tangent}}function vn(n,e,t){const r=e.spatialReference,a=P(e,t,F),o=new Float64Array(n.position.length),i=$n(n.position,a,r,o),l=L(I,a);return{position:i,normal:wn(i,o,n.normal,l,r),tangent:Tn(i,o,n.tangent,l,r)}}function $n(n,e,t,r){A(h.fromTypedArray(r),h.fromTypedArray(n),e);const a=new Float64Array(n.length);return X(r,a,t)}function wn(n,e,t,r,a){if(f(t))return null;const o=new Float32Array(t.length);return x(y.fromTypedArray(o),y.fromTypedArray(t),r),nn(o,n,e,a,o),o}function Tn(n,e,t,r,a){if(f(t))return null;const o=new Float32Array(t.length);x(y.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT),y.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),r);for(let i=3;i<o.length;i+=4)o[i]=t[i];return tn(o,n,e,a,o),o}function b(n,e,t){const r=new Float64Array(n.position.length),a=n.position,o=e.x,i=e.y,l=e.z||0,{horizontal:c,vertical:v}=M(t?t.unit:null,e.spatialReference);for(let s=0;s<a.length;s+=3)r[s+0]=(a[s+0]-o)/c,r[s+1]=(a[s+1]-i)/c,r[s+2]=(a[s+2]-l)/v;return{position:r,normal:n.normal,tangent:n.tangent}}function B(n,e,t){const r=e.spatialReference;P(e,t,F);const a=N(Rn,F),o=new Float64Array(n.position.length),i=bn(n.position,r,a,o),l=L(I,a);return{position:i,normal:Mn(n.normal,n.position,o,r,l),tangent:Fn(n.tangent,n.position,o,r,l)}}function P(n,e,t){z(n.spatialReference,[n.x,n.y,n.z||0],t,en(n.spatialReference));const{horizontal:r,vertical:a}=M(e?e.unit:null,n.spatialReference);return E(t,t,[r,r,a]),t}function bn(n,e,t,r){const a=sn(n,e,r),o=h.fromTypedArray(a),i=new Float64Array(a.length),l=h.fromTypedArray(i);return A(l,o,t),i}function Mn(n,e,t,r,a){if(f(n))return null;const o=cn(n,e,t,r,new Float32Array(n.length)),i=y.fromTypedArray(o);return x(i,i,a),o}function Fn(n,e,t,r,a){if(f(n))return null;const o=pn(n,e,t,r,new Float32Array(n.length)),i=y.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT);return x(i,i,a),o}function M(n,e){if(f(n))return En;const t=e.isGeographic?1:rn(e),r=e.isGeographic?1:an(e),a=on(1,n,"meters");return{horizontal:a*t,vertical:a*r}}const F=m(),Rn=m(),I=ln(),En={horizontal:1,vertical:1};export{Ln as M,mn as O,An as _,zn as b,xn as k,d as r,_ as x};
