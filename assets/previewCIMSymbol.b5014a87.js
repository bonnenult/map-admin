import{rI as M,rJ as I,es as C}from"./vendor.47ccae81.js";import{CIMSymbolRasterizer as z}from"./CIMSymbolRasterizer.86ccd16b.js";import{l as S}from"./renderUtils.ab95ea15.js";import"./cimAnalyzer.c8eeedb3.js";import"./CIMSymbolHelper.280cbd1b.js";import"./BidiEngine.aae60613.js";import"./definitions.21e97413.js";import"./number.dfbabd3f.js";import"./GeometryUtils.d4e26b77.js";import"./Rasterizer.3dfc6cf3.js";import"./colorUtils.92e1b957.js";const v=new z(null,!0),D=120;async function G(e,t={}){const{size:c,maxSize:p,node:f,opacity:y}=t,h=t.cimOptions||t,{feature:u,fieldMap:g,geometryType:j,style:w}=h,b=M(e),i=Math.min(c!=null?c:b,p!=null?p:C(D));i!==b&&(e=e.clone(),I(e,i,{preserveOutlineWidth:!0}));let n=3;e&&e.data&&e.data.symbol&&e.data.symbol.type!=="CIMPointSymbol"&&(n=1);const m=await v.rasterizeCIMSymbolAsync(e,u,g,j,{scaleFactor:n,style:w}),a=document.createElement("canvas");a.width=m.imageData.width,a.height=m.imageData.height,a.getContext("2d").putImageData(m.imageData,0,0);let o=a.width/n,r=a.height/n;if(c!=null&&((t==null?void 0:t.scale)==null||(t==null?void 0:t.scale))){const l=o/r;o=l<=1?Math.ceil(i*l):i,r=l<=1?i:Math.ceil(i/l)}const s=new Image(o,r);s.src=a.toDataURL(),y!=null&&(s.style.opacity=`${y}`);let d=s;if(t.effectView!=null){const l={shape:{type:"image",x:0,y:0,width:o,height:r,src:s.src},fill:null,stroke:null,offset:[0,0]};d=S([[l]],[o,r],{effectView:t.effectView})}return f&&f.appendChild(d),d}export{G as previewCIMSymbol};
