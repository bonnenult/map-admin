import{dj as R}from"./vendor.c8f3cc8c.js";const G=(()=>{if(!("document"in globalThis))return()=>null;const t=document.createElement("canvas"),e=t.getContext("2d"),n=512;return t.height=n,t.width=1,r=>{e.clearRect(0,0,1,t.height);const a=e.createLinearGradient(0,0,0,t.height);for(const{ratio:i,color:o}of r.colorStops)a.addColorStop(Math.max(i,.001),`rgba(${o[0]}, ${o[1]}, ${o[2]}, ${o[3]})`);return e.fillStyle=a,e.fillRect(0,0,1,t.height),e.getImageData(0,0,1,t.height).data}})();function T(t,e,n,r){const{blurRadius:a,fieldOffset:i,field:o}=e,u=new Float64Array(n*r),s=j(a),c=Math.round(3*a);let h,l=Number.NEGATIVE_INFINITY;const A=D(o,i),M=new Set;for(const I of t){const d=I.getCursor();for(;d.next();){const b=d.getObjectId();if(M.has(b))continue;M.add(b);const f=d.readLegacyPointGeometry(),g=128;if(f.x<-g||f.x>=n+g||f.y<-g||f.y>r+g)continue;const p=+A(d),x=Math.round(f.x)-c,w=Math.round(f.y)-c,U=Math.max(0,x),$=Math.max(0,w),v=Math.min(r,Math.round(f.y)+c),C=Math.min(n,Math.round(f.x)+c);for(let m=$;m<v;m++){const F=s[m-w];for(let y=U;y<C;y++){const N=s[y-x];h=u[m*n+y]+=F*N*p,h>l&&(l=h)}}}}return{matrix:u.buffer,max:l}}function L(t,e,n,r,a,i){t.canvas.width=t.canvas.height=e,t.clearRect(0,0,e,e);const o=t.getImageData(0,0,e,e);n&&r&&o.data.set(new Uint8ClampedArray(S(e,n,r,a,i))),t.putImageData(o,0,0)}function S(t,e,n,r,a){const i=new Uint32Array(t*t),o="buffer"in e?e:new Float64Array(e),u="buffer"in n?new Uint32Array(n.buffer):new Uint32Array(new Uint8Array(n).buffer),s=u.length/(a-r);for(let c=0;c<o.length;c++){const h=o[c],l=Math.floor((h-r)*s);i[c]=u[R(l,0,u.length-1)]}return i.buffer}function j(t){const e=Math.round(3*t),n=2*t*t,r=new Float64Array(2*e+1);for(let a=0;a<=r.length;a++)r[a]=Math.exp(-((a-e)**2)/n)/Math.sqrt(2*Math.PI)*(t/2);return r}function D(t,e){return t!=null?typeof e=="string"?n=>-1*+n.readAttribute(t):n=>+n.readAttribute(t)+e:n=>1}export{G as e,L as o,T as r};
