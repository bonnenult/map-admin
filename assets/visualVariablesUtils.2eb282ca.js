var S=Object.defineProperty;var u=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var c=(t,e,s)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,f=(t,e)=>{for(var s in e||(e={}))b.call(e,s)&&c(t,s,e[s]);if(u)for(var s of u(e))$.call(e,s)&&c(t,s,e[s]);return t};import{d2 as p,t as x,bk as E}from"./index.988b09cd.js";import{x as v}from"./number.dfbabd3f.js";import{l as V}from"./definitions.21e97413.js";import{A as l}from"./Utils.56a5b8e8.js";import{o as _}from"./visualVariablesUtils.08738833.js";const A=8388607,m=8388608,I=254,M=255,N=0,d=1,y=t=>(t&m)>>>23,O=t=>t&A,P=t=>y(t)===d?I:M;function q(t){return y(t)===d}function B(t,e){return((e?m:0)|t)>>>0}function U(t,e=0,s=!1){const n=t[e+3];return t[e+0]*=n,t[e+1]*=n,t[e+2]*=n,s||(t[e+3]*=255),t}function C(t){if(!t)return 0;const{r:e,g:s,b:n,a:o}=t;return v(e*o,s*o,n*o,255*o)}function G(t){if(!t)return 0;const[e,s,n,o]=t;return v(e*(o/255),s*(o/255),n*(o/255),o)}const X=(t,e)=>t&&((...s)=>e.warn("DEBUG:",...s))||(()=>null),H=!1;function J(t,e){if(!t||!e)return t;switch(e){case"radius":case"distance":return 2*t;case"diameter":case"width":return t;case"area":return Math.sqrt(t)}return t}function w(t){return{value:t.value,size:p(t.size)}}function a(t){return t.map(e=>w(e))}function h(t){if(typeof t=="string"||typeof t=="number")return p(t);const e=t;return{type:"size",expression:e.expression,stops:a(e.stops)}}const z=t=>{const e=[],s=[],n=a(t),o=n.length;for(let i=0;i<6;i++){const r=n[Math.min(i,o-1)];e.push(r.value),s.push(r.size==null?V:E(r.size))}return{values:new Float32Array(e),sizes:new Float32Array(s)}};function K(t){const e=t&&t.length>0?{}:null,s=e?{}:null;if(!e)return{vvFields:e,vvRanges:s};for(const n of t)if(n.field&&(e[n.type]=n.field),n.type==="size"){s.size||(s.size={});const o=n;switch(_(o)){case l.SIZE_MINMAX_VALUE:s.size.minMaxValue={minDataValue:o.minDataValue,maxDataValue:o.maxDataValue,minSize:h(o.minSize),maxSize:h(o.maxSize)};break;case l.SIZE_SCALE_STOPS:s.size.scaleStops={stops:a(o.stops)};break;case l.SIZE_FIELD_STOPS:if(o.levels){const i={};for(const r in o.levels)i[r]=z(o.levels[r]);s.size.fieldStops={type:"level-dependent",levels:i}}else s.size.fieldStops=f({type:"static"},z(o.stops));break;case l.SIZE_UNIT_VALUE:s.size.unitValue={unit:o.valueUnit,valueRepresentation:o.valueRepresentation}}}else if(n.type==="color")s.color=F(n);else if(n.type==="opacity")s.opacity=D(n);else if(n.type==="rotation"){const o=n;s.rotation={type:o.rotationType}}return{vvFields:e,vvRanges:s}}function D(t){const e={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(typeof t.field=="string"){if(!t.stops)return null;{if(t.stops.length>8)return null;const s=t.stops;for(let n=0;n<8;++n){const o=s[Math.min(n,s.length-1)];e.values[n]=o.value,e.opacities[n]=o.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const s=t.stops&&t.stops.length>=0&&t.stops[0].opacity;for(let n=0;n<8;n++)e.values[n]=1/0,e.opacities[n]=s}}return e}function g(t,e,s){t[4*e+0]=s.r/255,t[4*e+1]=s.g/255,t[4*e+2]=s.b/255,t[4*e+3]=s.a}function F(t){if(x(t)||t.normalizationField)return null;const e={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if(typeof t.field=="string"){if(!t.stops)return null;{if(t.stops.length>8)return null;e.field=t.field;const s=t.stops;for(let n=0;n<8;++n){const o=s[Math.min(n,s.length-1)];e.values[n]=o.value,g(e.colors,n,o.color)}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const s=t.stops&&t.stops.length>=0&&t.stops[0].color;for(let n=0;n<8;n++)e.values[n]=1/0,g(e.colors,n,s)}}for(let s=0;s<32;s+=4)U(e.colors,s,!0);return e}export{G as a,P as b,d as c,A as d,y as e,O as f,C as i,H as l,K as m,X as n,q as p,J as r,B as s,N as u};
