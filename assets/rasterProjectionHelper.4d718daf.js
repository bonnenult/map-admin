var _=Object.defineProperty,tt=Object.defineProperties;var nt=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var at=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable;var $=(t,n,a)=>n in t?_(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,B=(t,n)=>{for(var a in n||(n={}))at.call(n,a)&&$(t,a,n[a]);if(F)for(var a of F(n))it.call(n,a)&&$(t,a,n[a]);return t},E=(t,n)=>tt(t,nt(n));import{k8 as O,hu as et,bS as X,hv as k,b6 as ot,fE as q,b1 as S,aq as b,co as st,c5 as rt,k9 as H}from"./vendor.47ccae81.js";const G=5e-4;function lt(t,n,a){return!st(t,n,a)}function P(t,n,a){const e=lt(t,n,a);if(e&&!O())throw new rt("rasterprojectionhelper-project","projection engine is not loaded");return e}const J=function(t,n,a){const e=(t[0]+t[4]+t[4*n.cols]+t[4*n.cols+4])/4,o=(t[1]+t[5]+t[4*n.rows+1]+t[4*n.rows+5])/4,i=(t[4*n.cols]-t[0]+t[4*n.cols+4]-t[4])/a[0]*.5,s=(t[4*n.cols+1]-t[1]+t[4*n.cols+5]-t[5])/a[1]*.5;return[i===0||isNaN(i)?0:Math.abs(e-t[2*n.rows+2])/Math.abs(i),s===0||isNaN(s)?0:Math.abs(o-t[2*n.rows+3])/Math.abs(s)]},ct={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},T=32,I=4,xt=I;async function Mt(){if(O())return null;await et()}function dt(t,n,a){return P(t.spatialReference,n)?a?H(n,t.spatialReference,t):H(t.spatialReference,n,t):null}function Q(t,n,a,e=null){if(t.spatialReference.equals(n))return t;P(t.spatialReference,n,e);const o=a.center,i=new X({xmin:o.x-t.x/2,xmax:o.x+t.x/2,ymin:o.y-t.y/2,ymax:o.y+t.y/2,spatialReference:t.spatialReference}),s=k(i,n,e);return ot(s)?null:{x:s.xmax-s.xmin,y:s.ymax-s.ymin}}function D(t,n=.01){return q(t)?n/q(t):0}function K(t,n,a=null,e=!0){const o=t.spatialReference;if(o.equals(n))return t;P(o,n,a);const i=k(t,n,a);if(e&&n.isGeographic){const[s,r]=A(o,!0),c=D(o);c&&s!=null&&r!=null&&(Math.abs(t.x-s)<c&&Math.abs(180-i.x)<G?i.x-=360:Math.abs(t.x-r)<c&&Math.abs(180+i.x)<G&&(i.x+=360))}return i}function ut(t,n,a=null){const e=t[0].spatialReference;return e.equals(n)?t:(P(e,n,a),k(t,n,a))}function U(t){const n=W(t[0].spatialReference);if(t.length<2||!S(n))return t[0];let{xmin:a,xmax:e,ymin:o,ymax:i}=t[0];for(let s=1;s<t.length;s++){const r=t[s];e=r.xmax+n*s,o=Math.min(o,r.ymin),i=Math.max(i,r.ymax)}return new X({xmin:a,xmax:e,ymin:o,ymax:i,spatialReference:t[0].spatialReference})}function ft(t,n,a=null,e=!0){if(t.spatialReference.equals(n))return t;const o=mt(t),i=W(t.spatialReference,!0);return!S(i)||o===0?V(t,n,a,e):U(t.clone().normalize().map(s=>V(s,n,a,e)))}function V(t,n,a=null,e=!0){const o=t.spatialReference;if(o.equals(n))return t;P(o,n,a);const i=k(t,n,a);let[s,r]=A(o,!0);if(i&&e&&o.isWebMercator&&n.isGeographic&&s!=null&&r!=null){const y=.001,x=1e3;if(Math.abs(t.xmin-s)<y&&Math.abs(r-t.xmax)>x&&Math.abs(180-i.xmax)<G){i.xmin=-180;const f=[];f.push(new b(t.xmax,t.ymin,o)),f.push(new b(t.xmax,(t.ymin+t.ymax)/2,o)),f.push(new b(t.xmax,t.ymax,o));const u=f.map(m=>K(m,n,a)).filter(m=>!isNaN(m==null?void 0:m.x)).map(m=>m.x);i.xmax=Math.max.apply(null,u)}if(Math.abs(t.xmax-r)<y&&Math.abs(s-t.xmin)>x&&Math.abs(180+i.xmin)<G){i.xmax=180;const f=[];f.push(new b(t.xmin,t.ymin,o)),f.push(new b(t.xmin,(t.ymin+t.ymax)/2,o)),f.push(new b(t.xmin,t.ymax,o));const u=f.map(m=>K(m,n,a)).filter(m=>!isNaN(m==null?void 0:m.x)).map(m=>m.x);i.xmin=Math.min.apply(null,u)}}[s,r]=A(n,!0);const c=D(n);return c&&s!=null&&r!=null&&i&&(Math.abs(i.xmin-s)<c&&(i.xmin=s),Math.abs(i.xmax-r)<c&&(i.xmax=r)),i}function W(t,n=!1){const a=n?20037508342787e-6:20037508342788905e-9;return t.isWebMercator?2*a:t.wkid&&t.isGeographic?360:2*ct[t.wkid]||null}function A(t,n=!1){const a=[],e=W(t,n);return S(e)&&(a.push(-e/2),a.push(e/2)),a}function Y(t,n,a,e){let o=(t-n)/a;return o-Math.floor(o)!=0?o=Math.floor(o):e&&(o-=1),o}function mt(t,n=!1){const a=W(t.spatialReference);if(!S(a))return 0;const e=n?0:-(a/2);return Y(t.xmax,e,a,!0)-Y(t.xmin,e,a,!1)}function gt(t){const n=t.storageInfo.origin.x,a=W(t.spatialReference,!0);if(!S(a))return{originX:n,halfWorldWidth:null,pyramidsInfo:null};const e=a/2,{nativePixelSize:o,storageInfo:i,extent:s}=t,{maximumPyramidLevel:r,blockWidth:c,pyramidScalingFactor:y}=i;let x=o.x;const f=[],u=S(t.transform)&&t.transform.type==="gcs-shift",m=n+(u?0:e),h=u?a-n:e-n;for(let p=0;p<=r;p++){const d=(s.xmax-n)/x/c,w=d-Math.floor(d)==0?d:Math.ceil(d),g=h/x/c,l=g-Math.floor(g)==0?g:Math.ceil(g),R=Math.floor(m/x/c),M=Math.round(m/x)%c,v=(c-Math.round(h/x)%c)%c;f.push({resolutionX:x,blockWidth:c,datsetColumnCount:w,worldColumnCountFromOrigin:l,leftMargin:M,rightPadding:v,originColumnOffset:R}),x*=y}return{originX:n,halfWorldWidth:e,pyramidsInfo:f,hasGCSSShiftTransform:u}}function wt(t){const n=t.isAdaptive&&t.spacing==null,a=t.spacing||[T,T];let e=Z(t),o={cols:e.size[0]+1,rows:e.size[1]+1},i=J(e.offsets,o,a);const s=(i[0]+i[1])/2,r=e.outofBoundPointCount>0&&e.outofBoundPointCount<e.offsets.length/2;return n&&(r||s>xt)&&(e=Z(E(B({},t),{spacing:[I,I]})),o={cols:e.size[0]+1,rows:e.size[1]+1},i=J(e.offsets,o,a)),e.error=i,e.coefficients=ht(e.offsets,o,r),e}function Z(t){const{projectedExtent:n,srcBufferExtent:a,pixelSize:e,datumTransformation:o,rasterTransform:i}=t,s=n.spatialReference,r=a.spatialReference;P(s,r);const{xmin:c,ymin:y,xmax:x,ymax:f}=n,u=W(r),m=t.hasWrapAround||(i==null?void 0:i.type)==="gcs-shift",h=t.spacing||[T,T],p={x:h[0]*e.x,y:h[1]*e.y},d={cols:Math.ceil((x-c)/p.x-.1/h[0])+1,rows:Math.ceil((f-y)/p.y-.1/h[1])+1},w=p.x,g=p.y,l=[];let R,M=0;const v=[];for(let z=0;z<d.cols;z++)for(let C=0;C<d.rows;C++)v.push(new b({x:c+w*z,y:f-g*C,spatialReference:s}));const L=ut(v,r,o);for(let z=0;z<d.cols;z++){const C=[];for(let j=0;j<d.rows;j++){let N=L[z*d.rows+j];i&&(N=i.inverseTransform(N)),C.push(N),z>0&&m&&N&&R[j]&&S(u)&&N.x<R[j].x&&(N.x+=u),N?(l.push((N.x-a.xmin)/(a.xmax-a.xmin)),l.push((a.ymax-N.y)/(a.ymax-a.ymin))):(l.push(NaN),l.push(NaN),M++)}R=C}return{offsets:l,error:null,coefficients:null,outofBoundPointCount:M,spacing:h,size:[d.cols-1,d.rows-1]}}function ht(t,n,a){const{cols:e,rows:o}=n,i=new Float32Array((e-1)*(o-1)*2*6),s=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),r=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let c=0;c<e-1;c++){for(let y=0;y<o-1;y++){let x=c*o*2+2*y;const f=t[x],u=t[x+1],m=t[x+2],h=t[x+3];x+=2*o;const p=t[x],d=t[x+1],w=t[x+2],g=t[x+3];let l=0,R=12*(y*(e-1)+c);for(let M=0;M<3;M++)i[R++]=s[l++]*f+s[l++]*m+s[l++]*w;l=0;for(let M=0;M<3;M++)i[R++]=s[l++]*u+s[l++]*h+s[l++]*g;l=0;for(let M=0;M<3;M++)i[R++]=r[l++]*f+r[l++]*p+r[l++]*w;l=0;for(let M=0;M<3;M++)i[R++]=r[l++]*u+r[l++]*d+r[l++]*g}if(a)for(let y=0;y<i.length;y++)isNaN(i[y])&&(i[y]=-1)}return i}function Rt(t){const n=t.clone().normalize();return n.length===1?n[0]:U(n)}function bt(t,n,a){const{storageInfo:e,pixelSize:o}=n;let i,s=!1;const{pyramidResolutions:r}=e;if(S(r)&&r.length){const u=(t.x+t.y)/2,m=r[r.length-1],h=(m.x+m.y)/2,p=(o.x+o.y)/2;if(u<=p)i=0;else if(u>=h)i=r.length,s=u/h>8;else{let w,g=p;for(let l=1;l<=r.length;l++){if(w=(r[l-1].x+r[l-1].y)/2,u<=w){u===w?i=l:a==="down"?(i=l-1,s=u/g>8):i=a==="up"||u-g>w-u||u/g>2?l:l-1;break}g=w}}const d=i===0?o:r[i-1];return{pyramidLevel:i,pyramidResolution:new b({x:d.x,y:d.y,spatialReference:n.spatialReference}),excessiveReading:s}}const c=Math.log(t.x/o.x)/Math.LN2,y=Math.log(t.y/o.y)/Math.LN2,x=n.storageInfo.maximumPyramidLevel||0;i=a==="down"?Math.floor(Math.min(c,y)):a==="up"?Math.ceil(Math.max(c,y)):Math.round((c+y)/2),i<0?i=0:i>x&&(s=i>x+3,i=x);const f=2**i;return{pyramidLevel:i,pyramidResolution:new b({x:f*n.nativePixelSize.x,y:f*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:s}}function vt(t,n,a=512,e=!0){const{extent:o,spatialReference:i,pixelSize:s}=t,r=Q(new b({x:s.x,y:s.y,spatialReference:i}),n,o);if(r==null)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const c=(r.x+r.y)/2,y=q(n),x=c*y*96*39.37,f=n.isGeographic?256/a*2958287637958547e-7:256/a*591657527591555e-6;let u=t.dataType==="vector-magdir"||t.dataType==="vector-uv";const m=ft(o,n);u||e&&(n.isGeographic||n.isWebMercator)&&(u=m.xmin*m.xmax<0);let h,p=x;const d=1.001;if(u){p=f;const M=n.isGeographic?1341104507446289e-21:.29858214164761665,v=M*(96*y*39.37),L=n.isGeographic?4326:3857;h=Q(new b({x:M,y:M,spatialReference:{wkid:L}}),i,m),h.x*=p/v,h.y*=p/v}else{h={x:s.x,y:s.y};const M=Math.ceil(Math.log(Math.min(t.width,t.height)/32)/Math.LN2);let v=0;for(;p<f*(d/2)&&v<M;)v++,p*=2,h.x*=2,h.y*=2;Math.max(p,f)/Math.min(p,f)<=d&&(p=f)}const w=[p],g=[{x:h.x,y:h.y}],l=70.5310735,R=Math.min(l,x)/d;for(;p>=R;)p/=2,h.x/=2,h.y/=2,w.push(p),g.push({x:h.x,y:h.y});return{projectedPixelSize:r,scales:w,srcResolutions:g,isCustomTilingScheme:!u}}export{bt as A,vt as F,mt as G,wt as L,W as P,Q as R,gt as T,Mt as d,ft as j,Rt as q,K as v,dt as w,lt as x};
