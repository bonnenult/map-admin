var Q=Object.defineProperty,V=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var H=(e,s,r)=>s in e?Q(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r,O=(e,s)=>{for(var r in s||(s={}))Y.call(s,r)&&H(e,r,s[r]);if(F)for(var r of F(s))_.call(s,r)&&H(e,r,s[r]);return e},N=(e,s)=>V(e,X(s));import{bE as $,b5 as z,rw as ee,rx as se,fF as T,c4 as B,d0 as w,c6 as te,ry as ae,b0 as M,rz as W,rA as re,rB as ne,qz as le}from"./vendor.c8f3cc8c.js";import{y as oe,p as ie}from"./colorUtils.92e1b957.js";import{u as P,t as U,l as ce,s as pe,L as ue,p as he,o as me,n as fe,e as ye,c as de,m as be}from"./previewUtils.2948f758.js";import{l as I,d as ve}from"./renderUtils.96564456.js";import{resolveWebStyleSymbol as ge}from"./webStyleSymbolUtils.b498d126.js";const L=22,D=120,q=80,G=40,A=20,ke=$.getLogger("esri.symbols.support.previewSymbol3D");function j(e){const s=e.outline,r=M(e.material)?e.material.color:null,t=M(r)?r.toHex():null;if(z(s)||"pattern"in s&&M(s.pattern)&&s.pattern.type==="style"&&s.pattern.style==="none")return e.type==="fill"&&t==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const a=w(s.size)||0;return{color:"rgba("+(M(s.color)?s.color.toRgba():"255,255,255,1")+")",width:Math.min(a,q),style:"pattern"in s&&M(s.pattern)&&s.pattern.type==="style"?W(s.pattern.style):null,join:"butt",cap:"patternCap"in s?s.patternCap:"butt"}}function we(e,s){const r=s&&s.resource,t=r&&r.href;if(e.thumbnail&&e.thumbnail.url)return Promise.resolve(e.thumbnail.url);if(t&&s.type!=="object")return Promise.resolve(ae(e,s));const a=T("esri/images/Legend/legend3dsymboldefault.png");return e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)?ge(e.styleOrigin,{portal:e.styleOrigin.portal},"webRef").catch(n=>n).then(n=>{var l;return(n==null||(l=n.thumbnail)==null?void 0:l.url)||a}):Promise.resolve(a)}function R(e,s=1){const r=e.a,t=oe(e),a=t.h,n=t.s/s,l=100-(100-t.v)/s,{r:p,g:y,b:h}=ie({h:a,s:n,v:l});return[p,y,h,r]}function C(e){return e.type==="water"?z(e.color)?null:e.color:z(e.material)||z(e.material.color)?null:e.material.color}function i(e,s=0){const r=C(e);if(!r){if(e.type==="fill")return null;const a=ee.r,n=P(a,s);return[n,n,n,100]}const t=r.toRgba();for(let a=0;a<3;a++)t[a]=P(t[a],s);return t}async function xe(e,s){const r=e.style;return r==="none"?null:{type:"pattern",x:0,y:0,src:await se(T(`esri/symbols/patterns/${r}.png`),s.toCss(!0)),width:5,height:5}}function J(e){return e.outline?j(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function K(e,s){const r=C(e);if(!r)return null;let t="rgba(";return t+=P(r.r,s)+",",t+=P(r.g,s)+",",t+=P(r.b,s)+",",t+r.a+");"}function Z(e,s){const r=K(e,s);return r?"pattern"in e&&M(e.pattern)&&e.pattern.type==="style"&&e.pattern.style==="none"?null:{color:r,width:Math.min(e.size?w(e.size):.75,q),style:"pattern"in e&&M(e.pattern)&&e.pattern.type==="style"?W(e.pattern.style):null,cap:"cap"in e?e.cap:null,join:"join"in e?e.join==="miter"?w(2):e.join:null}:{}}function E(e,s,r){const t=.75*r;return{type:"linear",x1:t?.25*t:0,y1:t?.5*t:0,x2:t||4,y2:t?.5*t:4,colors:[{color:e,offset:0},{color:s,offset:1}]}}function Me(e){const s=e.depth,r=e.height,t=e.width;return t&&s&&r&&t===s&&t<r}function Le(e,s,r){const t=[];if(!e)return t;switch(e.type){case"icon":{const a=0,n=0,l=s,p=s;switch(e.resource&&e.resource.primitive||ne){case"circle":t.push({shape:{type:"circle",cx:0,cy:0,r:.5*s},fill:i(e,0),stroke:j(e)});break;case"square":t.push({shape:{type:"path",path:[{command:"M",values:[a,p]},{command:"L",values:[a,n]},{command:"L",values:[l,n]},{command:"L",values:[l,p]},{command:"Z",values:[]}]},fill:i(e,0),stroke:j(e)});break;case"triangle":t.push({shape:{type:"path",path:[{command:"M",values:[a,p]},{command:"L",values:[.5*l,n]},{command:"L",values:[l,p]},{command:"Z",values:[]}]},fill:i(e,0),stroke:j(e)});break;case"cross":t.push({shape:{type:"path",path:[{command:"M",values:[.5*l,n]},{command:"L",values:[.5*l,p]},{command:"M",values:[a,.5*p]},{command:"L",values:[l,.5*p]}]},stroke:J(e)});break;case"x":t.push({shape:{type:"path",path:[{command:"M",values:[a,n]},{command:"L",values:[l,p]},{command:"M",values:[l,n]},{command:"L",values:[a,p]}]},stroke:J(e)});break;case"kite":t.push({shape:{type:"path",path:[{command:"M",values:[a,.5*p]},{command:"L",values:[.5*l,n]},{command:"L",values:[l,.5*p]},{command:"L",values:[.5*l,p]},{command:"Z",values:[]}]},fill:i(e,0),stroke:j(e)})}break}case"object":switch(e.resource&&e.resource.primitive||re){case"cone":{const a=E(i(e,0),i(e,-.6),r?A:s),n=fe(s,r);t.push({shape:n[0],fill:a}),t.push({shape:n[1],fill:a});break}case"inverted-cone":{const a=i(e,0),n=E(a,i(e,-.6),s),l=me(s);t.push({shape:l[0],fill:n}),t.push({shape:l[1],fill:a});break}case"cube":{const a=he(s,r);t.push({shape:a[0],fill:i(e,0)}),t.push({shape:a[1],fill:i(e,-.3)}),t.push({shape:a[2],fill:i(e,-.5)});break}case"cylinder":{const a=E(i(e,0),i(e,-.6),r?A:s),n=ue(s,r);t.push({shape:n[0],fill:a}),t.push({shape:n[1],fill:a}),t.push({shape:n[2],fill:i(e,0)});break}case"diamond":{const a=pe(s);t.push({shape:a[0],fill:i(e,-.3)}),t.push({shape:a[1],fill:i(e,0)}),t.push({shape:a[2],fill:i(e,-.3)}),t.push({shape:a[3],fill:i(e,-.7)});break}case"sphere":{const a=E(i(e,0),i(e,-.6));a.x1=0,a.y1=0,a.x2=.25*s,a.y2=.25*s,t.push({shape:{type:"circle",cx:0,cy:0,r:.5*s},fill:a});break}case"tetrahedron":{const a=ce(s);t.push({shape:a[0],fill:i(e,-.3)}),t.push({shape:a[1],fill:i(e,0)}),t.push({shape:a[2],fill:i(e,-.6)});break}}break}return t}function ze(e){return e.type==="icon"?"multiply":"tint"}function je(e,s){const r=s&&s.size?w(s.size):null,t=s&&s.maxSize?w(s.maxSize):null,a=s&&s.disableUpsampling,n=e.symbolLayers,l=[];let p=0,y=0;const h=n.getItemAt(n.length-1);let d;return h&&h.type==="icon"&&(d=h.size&&w(h.size)),n.forEach(f=>{if(f.type!=="icon"&&f.type!=="object")return;const c=f.type==="icon"?f.size&&w(f.size):0,u=r||c?Math.ceil(Math.min(r||c,t||D)):L;if(f&&f.resource&&f.resource.href){const o=we(e,f).then(function(m){const b=f.get("material.color"),v=ze(f);return ve(m,u,b,v,a)}).then(function(m){const b=m.width,v=m.height;return p=Math.max(p,b),y=Math.max(y,v),[{shape:{type:"image",x:0,y:0,width:b,height:v,src:m.url},fill:null,stroke:null}]});l.push(o)}else{var k;let o=u;f.type==="icon"&&d&&r&&(o=u*(c/d));const m=(s==null?void 0:s.symbolConfig)==="tall"||(s==null||(k=s.symbolConfig)==null?void 0:k.isTall)||f.type==="object"&&Me(f);p=Math.max(p,m?A:o),y=Math.max(y,o),l.push(Promise.resolve(Le(f,o,m)))}}),te(l).then(function(f){const c=[];return f.forEach(function(u){u.value?c.push(u.value):u.error&&ke.warn("error while building swatchInfo!",u.error)}),I(c,[p,y],{node:s&&s.node,scale:!1,opacity:s&&s.opacity})})}function Se(e,s){const r=e.symbolLayers,t=[],a=le(e),n=s&&s.size?w(s.size):null,l=(s&&s.maxSize?w(s.maxSize):null)||q;let p,y=0,h=0;return r.forEach((d,f)=>{if(!d||d.type!=="line"&&d.type!=="path")return;const c=[];switch(d.type){case"line":{const u=Z(d,0);if(z(u))break;const k=u&&u.width||0;f===0&&(p=k);const o=Math.min(n||k,l),m=f===0?o:n?o*(k/p):o,b=m>G/2?2*m:G;h=Math.max(h,m),y=Math.max(y,b),u.width=m,c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*h]},{command:"L",values:[y,.5*h]}]},stroke:u});break}case"path":{const u=Math.min(n||L,l),k=i(d,0),o=i(d,-.2),m=K(d,-.4),b=m?{color:m,width:1}:{};if(d.profile==="quad"){const v=d.width,g=d.height,x=ye(v&&g?v/g:1,g===0,v===0),S=N(O({},b),{join:"bevel"});c.push({shape:x[0],fill:o,stroke:S}),c.push({shape:x[1],fill:o,stroke:S}),c.push({shape:x[2],fill:k,stroke:S})}else c.push({shape:U.pathSymbol3DLayer[0],fill:o,stroke:b}),c.push({shape:U.pathSymbol3DLayer[1],fill:k,stroke:b});h=Math.max(h,u),y=h}}t.push(c)}),Promise.resolve(I(t,[y,h],{node:s&&s.node,scale:a,opacity:s&&s.opacity}))}async function Pe(e,s){const r=e.type==="mesh-3d",t=e.symbolLayers,a=s&&s.size?w(s.size):null,n=s&&s.maxSize?w(s.maxSize):null,l=a||L,p=[];let y=0,h=0,d=!1;for(let f=0;f<t.length;f++){const c=t.getItemAt(f),u=[];if(r&&c.type!=="fill")continue;const k=U.fill[0];switch(c.type){case"fill":{const o=j(c),m=Math.min(l,n||D);y=Math.max(y,m),h=Math.max(h,m),d=!0;let b=i(c,0);const v="pattern"in c&&c.pattern,g=C(c);!r&&M(v)&&v.type==="style"&&v.style!=="solid"&&g&&(b=await xe(v,g)),u.push({shape:k,fill:b,stroke:o});break}case"line":{const o=Z(c,0);if(z(o))break;const m={stroke:o,shape:k};y=Math.max(y,L),h=Math.max(h,L),u.push(m);break}case"extrude":{const o=O({join:"round",width:1},Z(c,-.4)),m=i(c,0),b=i(c,-.2),v=Math.min(l,n||D),g=be(v);o.width=1,u.push({shape:g[0],fill:b,stroke:o}),u.push({shape:g[1],fill:b,stroke:o}),u.push({shape:g[2],fill:m,stroke:o});const x=L,S=.7*L+.5*v;y=Math.max(y,x),h=Math.max(h,S);break}case"water":{const o=C(c),m=R(o),b=R(o,2),v=R(o,3),g=de();d=!0,u.push({shape:g[0],fill:m}),u.push({shape:g[1],fill:b}),u.push({shape:g[2],fill:v});const x=Math.min(l,n||D);y=Math.max(y,x),h=Math.max(h,x);break}}p.push(u)}return Promise.resolve(I(p,[y,h],{node:s&&s.node,scale:d,opacity:s&&s.opacity}))}function qe(e,s){if(e.symbolLayers.length===0)return Promise.reject(new B("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return je(e,s);case"line-3d":return Se(e,s);case"polygon-3d":case"mesh-3d":return Pe(e,s)}return Promise.reject(new B("symbolPreview: swatchInfo3D","symbol not supported."))}export{xe as getPatternDescriptor,i as getSymbolLayerFill,qe as previewSymbol3D};
