var S=Object.defineProperty;var u=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var c=(e,t,s)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,f=(e,t)=>{for(var s in t||(t={}))b.call(t,s)&&c(e,s,t[s]);if(u)for(var s of u(t))$.call(t,s)&&c(e,s,t[s]);return e};import{d2 as p,t as x,bk as E}from"./index.fe92decb.js";import{x as v}from"./number.dfbabd3f.js";import{l as V}from"./definitions.21e97413.js";import{A as l}from"./Utils.b6ae6dd5.js";import{o as _}from"./visualVariablesUtils.2043fc08.js";const A=8388607,m=8388608,I=254,M=255,N=0,d=1,y=e=>(e&m)>>>23,O=e=>e&A,P=e=>y(e)===d?I:M;function q(e){return y(e)===d}function B(e,t){return((t?m:0)|e)>>>0}function U(e,t=0,s=!1){const n=e[t+3];return e[t+0]*=n,e[t+1]*=n,e[t+2]*=n,s||(e[t+3]*=255),e}function C(e){if(!e)return 0;const{r:t,g:s,b:n,a:o}=e;return v(t*o,s*o,n*o,255*o)}function G(e){if(!e)return 0;const[t,s,n,o]=e;return v(t*(o/255),s*(o/255),n*(o/255),o)}const X=(e,t)=>e&&((...s)=>t.warn("DEBUG:",...s))||(()=>null),H=!1;function J(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function w(e){return{value:e.value,size:p(e.size)}}function a(e){return e.map(t=>w(t))}function h(e){if(typeof e=="string"||typeof e=="number")return p(e);const t=e;return{type:"size",expression:t.expression,stops:a(t.stops)}}const z=e=>{const t=[],s=[],n=a(e),o=n.length;for(let i=0;i<6;i++){const r=n[Math.min(i,o-1)];t.push(r.value),s.push(r.size==null?V:E(r.size))}return{values:new Float32Array(t),sizes:new Float32Array(s)}};function K(e){const t=e&&e.length>0?{}:null,s=t?{}:null;if(!t)return{vvFields:t,vvRanges:s};for(const n of e)if(n.field&&(t[n.type]=n.field),n.type==="size"){s.size||(s.size={});const o=n;switch(_(o)){case l.SIZE_MINMAX_VALUE:s.size.minMaxValue={minDataValue:o.minDataValue,maxDataValue:o.maxDataValue,minSize:h(o.minSize),maxSize:h(o.maxSize)};break;case l.SIZE_SCALE_STOPS:s.size.scaleStops={stops:a(o.stops)};break;case l.SIZE_FIELD_STOPS:if(o.levels){const i={};for(const r in o.levels)i[r]=z(o.levels[r]);s.size.fieldStops={type:"level-dependent",levels:i}}else s.size.fieldStops=f({type:"static"},z(o.stops));break;case l.SIZE_UNIT_VALUE:s.size.unitValue={unit:o.valueUnit,valueRepresentation:o.valueRepresentation}}}else if(n.type==="color")s.color=F(n);else if(n.type==="opacity")s.opacity=D(n);else if(n.type==="rotation"){const o=n;s.rotation={type:o.rotationType}}return{vvFields:t,vvRanges:s}}function D(e){const t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(typeof e.field=="string"){if(!e.stops)return null;{if(e.stops.length>8)return null;const s=e.stops;for(let n=0;n<8;++n){const o=s[Math.min(n,s.length-1)];t.values[n]=o.value,t.opacities[n]=o.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const s=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(let n=0;n<8;n++)t.values[n]=1/0,t.opacities[n]=s}}return t}function g(e,t,s){e[4*t+0]=s.r/255,e[4*t+1]=s.g/255,e[4*t+2]=s.b/255,e[4*t+3]=s.a}function F(e){if(x(e)||e.normalizationField)return null;const t={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if(typeof e.field=="string"){if(!e.stops)return null;{if(e.stops.length>8)return null;t.field=e.field;const s=e.stops;for(let n=0;n<8;++n){const o=s[Math.min(n,s.length-1)];t.values[n]=o.value,g(t.colors,n,o.color)}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const s=e.stops&&e.stops.length>=0&&e.stops[0].color;for(let n=0;n<8;n++)t.values[n]=1/0,g(t.colors,n,s)}}for(let s=0;s<32;s+=4)U(t.colors,s,!0);return t}export{G as a,P as b,d as c,A as d,y as e,O as f,C as i,H as l,K as m,X as n,q as p,J as r,B as s,N as u};
