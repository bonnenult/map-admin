import{el as o,av as l,t as m,e as h,i as p}from"./index.fe92decb.js";import{V as c}from"./DynamicLayerView3D.0493f612.js";import{u}from"./ImageryLayerView.865b7fc5.js";import"./vendor.d9e807b5.js";import"./index.dbbecfd7.js";/* empty css              */import"./qrcode.0911187d.js";/* empty css                 */import"./projectExtentUtils.d632c7a8.js";import"./RefreshableLayerView.4c074742.js";import"./popupUtils.16f9871e.js";let s=class extends u(c){constructor(){super(...arguments),this.type="imagery-3d",this.redrawDebounced=o(async e=>{this.redraw((t,i)=>this._redrawImage(t,i),e)},2e3)}initialize(){this.handles.add([l(this.view.basemapTerrain,"ready",()=>this.initializeMaximumDataResolution()),this.layer.on("redraw",()=>this.redrawDebounced())]),this.updatingHandles.add(this.layer,"exportImageServiceParameters.version",()=>{this.updatingHandles.addPromise(this.refreshDebounced())}),this.updatingHandles.add(this,"timeExtent",()=>this.updatingHandles.addPromise(this.refreshDebounced()))}initializeMaximumDataResolution(){const e=this.view.basemapTerrain.spatialReference,t=this.layer.fullExtent;t&&e.equals(t.spatialReference)&&(this.maximumDataResolution={x:this.layer.pixelSizeX,y:this.layer.pixelSizeY})}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,t,i){t.imageElement?e.image=t.imageElement:(e.image=document.createElement("canvas"),e.pixelData=t.pixelData,await this._redrawImage(e,i))}async _redrawImage(e,t){if(!(e.image instanceof HTMLCanvasElement)||m(e.pixelData))return Promise.reject();const i=e.image,r=i.getContext("2d"),d=await this.layer.applyRenderer(e.pixelData,{signal:t}),a=this.layer.applyFilter(d).pixelBlock;if(m(a))return Promise.reject();i.width=a.width,i.height=a.height;const n=r.createImageData(a.width,a.height);n.data.set(a.getAsRGBA()),r.putImageData(n,0,0)}};s=h([p("esri.views.3d.layers.ImageryLayerView3D")],s);const I=s;export{I as default};
