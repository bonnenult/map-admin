import{rG as M,rH as C,eq as I}from"./vendor.70daa49e.js";import{CIMSymbolRasterizer as z}from"./CIMSymbolRasterizer.f5c52636.js";import{l as S}from"./renderUtils.c2f0d764.js";import"./cimAnalyzer.f8c59bac.js";import"./CIMSymbolHelper.8e5a45e2.js";import"./BidiEngine.aae60613.js";import"./definitions.21e97413.js";import"./number.dfbabd3f.js";import"./GeometryUtils.d4e26b77.js";import"./Rasterizer.74e9e0e0.js";import"./colorUtils.92e1b957.js";const v=new z(null,!0),D=120;async function q(e,t={}){const{size:m,maxSize:d,node:f,opacity:y}=t,u=t.cimOptions||t,{feature:b,fieldMap:g,geometryType:j,style:w}=u,h=M(e),i=Math.min(m!=null?m:h,d!=null?d:I(D));i!==h&&(e=e.clone(),C(e,i,{preserveOutlineWidth:!0}));let n=3;e&&e.data&&e.data.symbol&&e.data.symbol.type!=="CIMPointSymbol"&&(n=1);const c=await v.rasterizeCIMSymbolAsync(e,b,g,j,{scaleFactor:n,style:w}),a=document.createElement("canvas");a.width=c.imageData.width,a.height=c.imageData.height,a.getContext("2d").putImageData(c.imageData,0,0);let o=a.width/n,r=a.height/n;if(m!=null&&((t==null?void 0:t.scale)==null||(t==null?void 0:t.scale))){const l=o/r;o=l<=1?Math.ceil(i*l):i,r=l<=1?i:Math.ceil(i/l)}const s=new Image(o,r);s.src=a.toDataURL(),y!=null&&(s.style.opacity=`${y}`);let p=s;if(t.effectView!=null){const l={shape:{type:"image",x:0,y:0,width:o,height:r,src:s.src},fill:null,stroke:null,offset:[0,0]};p=S([[l]],[o,r],{effectView:t.effectView})}return f&&f.appendChild(p),p}export{q as previewCIMSymbol};
