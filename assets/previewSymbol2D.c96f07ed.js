var H=Object.defineProperty,T=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var S=(t,e,s)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,L=(t,e)=>{for(var s in e||(e={}))R.call(e,s)&&S(t,s,e[s]);if(F)for(var s of F(e))B.call(e,s)&&S(t,s,e[s]);return t},j=(t,e)=>T(t,A(e));import{bk as g,q1 as G,q2 as I,a as J,an as K,pV as N,cL as O}from"./index.fe92decb.js";import{t as b,h as P}from"./previewUtils.7b028938.js";import{l as Q}from"./renderUtils.1b005f8d.js";import"./vendor.d9e807b5.js";import"./index.dbbecfd7.js";/* empty css              */import"./qrcode.0911187d.js";/* empty css                 */import"./colorUtils.92e1b957.js";const E="picture-fill",W="picture-marker",X="simple-fill",Y="simple-line",_="simple-marker",$="text",ee="Aa",U=22,x=120,V=80,te=40,ae=document.createElement("canvas");function le(t,e){const s=ae.getContext("2d"),h=[];return e&&(e.weight&&h.push(e.weight),e.size&&h.push(e.size+"px"),e.family&&h.push(e.family)),s.font=h.join(" "),s.measureText(t).width}const ne=7.2/2.54,se=72/2.54;function oe(t){if(t.length===0)return 0;if(t.length>2){const e=O(1),s=parseFloat(t);switch(t.slice(-2)){case"px":return s;case"pt":return s*e;case"in":return 72*s*e;case"pc":return 12*s*e;case"mm":return s*ne*e;case"cm":return s*se*e}}return parseFloat(t)}function ye(t,e){var s,h;const m=(e==null?void 0:e.size)!=null?g(e.size):null,v=(e==null?void 0:e.maxSize)!=null?g(e.maxSize):null,Z=(e==null?void 0:e.opacity)!=null?e.opacity:null,y=(e==null?void 0:e.rotation)!=null?e.rotation:"angle"in t?t.angle:null,f=G(t);let p=I(t);if(f&&!p){const n="type"in f?null:new J(f);(n?n.toHex():null)==="#ffffff"&&(p={color:"#bdc3c7",width:.75})}const c={shape:null,fill:null,stroke:p,offset:[0,0]};(s=p)!=null&&s.width&&(p.width=Math.min(p.width,V));const r=((h=p)==null?void 0:h.width)||0;let d=m!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale)),a=0,l=0,w=!1;switch(t.type){case _:{const n=t.style,i=Math.min(m!=null?m:g(t.size),v||x);switch(a=i,l=i,n){case"circle":c.shape={type:"circle",cx:0,cy:0,r:.5*i},d||(a+=r,l+=r);break;case"cross":c.shape={type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[a,.5*l]},{command:"M",values:[.5*a,0]},{command:"L",values:[.5*a,l]}]};break;case"diamond":c.shape={type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[.5*a,0]},{command:"L",values:[a,.5*l]},{command:"L",values:[.5*a,l]},{command:"Z",values:[]}]},d||(a+=r,l+=r);break;case"square":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[a,0]},{command:"L",values:[a,l]},{command:"L",values:[0,l]},{command:"Z",values:[]}]},d||(a+=r,l+=r),y&&(w=!0);break;case"triangle":c.shape={type:"path",path:[{command:"M",values:[.5*a,0]},{command:"L",values:[a,l]},{command:"L",values:[0,l]},{command:"Z",values:[]}]},d||(a+=r,l+=r),y&&(w=!0);break;case"x":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[a,l]},{command:"M",values:[a,0]},{command:"L",values:[0,l]}]},y&&(w=!0);break;case"path":c.shape={type:"path",path:t.path||""},d||(a+=r,l+=r),y&&(w=!0),d=!0}break}case Y:{const n=Math.min(m!=null?m:r,v||V),i=n>U?2*n:te;p.width=n,a=i,l=n,c.shape={type:"path",path:[{command:"M",values:[0,l]},{command:"L",values:[a,l]}]};break}case E:case X:a=Math.min(m!=null?m:U,v||x)+r,l=a,d=!0,c.shape=typeof(e==null?void 0:e.symbolConfig)=="object"&&e!=null&&e.symbolConfig.isSquareFill?b.squareFill[0]:b.fill[0];break;case W:{let n=g(t.width),i=g(t.height);const o=m!=null?m:Math.max(n,i),u=n/i;n=u<=1?Math.ceil(o*u):o,i=u<=1?o:Math.ceil(o/u),a=Math.min(n,v||x),l=Math.min(i,v||x),c.shape={type:"image",x:-Math.round(a/2),y:-Math.round(l/2),width:a,height:l,src:t.url||""},y&&(w=!0);break}case $:{const n=t,i=n.text||ee,o=n.font,u=Math.min(m!=null?m:g(o.size),v||x),D=le(i,{weight:o.weight,size:u,family:o.family}),C=/[\uE600-\uE6FF]/.test(i);a=C?u:D,l=u;let q=.25*oe((o?u:0).toString());C&&(q+=5),c.shape={type:"text",text:i,x:0,y:q,align:"middle",decoration:o&&o.decoration,rotated:n.rotated,kerning:n.kerning},c.font=o&&{size:u,style:o.style,decoration:o.decoration,weight:o.weight,family:o.family};break}}if(!c.shape)return Promise.reject(new K("symbolPreview: renderPreviewHTML2D","symbol not supported."));const M=f,z=t.color;let k=null;return M&&M.type==="pattern"&&z&&t.type!==E?k=N(M.src,z.toCss(!0)).then(n=>(M.src=n,c.fill=M,c)):(c.fill=f,k=Promise.resolve(c)),k.then(n=>{const i=[[n]];if(typeof(e==null?void 0:e.symbolConfig)=="object"&&e!=null&&e.symbolConfig.applyColorModulation){const o=.6*a;i.unshift([j(L({},n),{offset:[-o,0],fill:P(f,-.3)})]),i.push([j(L({},n),{offset:[o,0],fill:P(f,.3)})]),a+=2*o}return Q(i,[a,l],{node:e&&e.node,scale:d,opacity:Z,rotation:y,useRotationSize:w,effectView:e==null?void 0:e.effectView})})}export{ye as previewSymbol2D};
