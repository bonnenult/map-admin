var f=Object.defineProperty,g=Object.defineProperties;var u=Object.getOwnPropertyDescriptors;var l=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var c=(i,e,t)=>e in i?f(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,p=(i,e)=>{for(var t in e||(e={}))_.call(e,t)&&c(i,t,e[t]);if(l)for(var t of l(e))b.call(e,t)&&c(i,t,e[t]);return i},m=(i,e)=>g(i,u(e));import{cL as T,aW as w,aY as y}from"./vendor.70daa49e.js";import{a as C}from"./WGLContainer.054d692c.js";import{l as j}from"./LayerView2D.291c660d.js";import R from"./GroupLayerView.bd3abd41.js";import"./brushes.00614641.js";import"./definitions.21e97413.js";import"./Utils.8da54d2f.js";import"./number.dfbabd3f.js";import"./programUtils.96aa856a.js";import"./GeometryUtils.ea8c8742.js";import"./MaterialKey.f8f54134.js";import"./pixelUtils.59d1e551.js";import"./Container.879a33d6.js";import"./EffectView.39edae97.js";class F extends C{constructor(){super(...arguments),this._lastWidth=0,this._lastHeight=0,this.requiresDedicatedFBO=!1}dispose(){this._renderTarget&&(this._renderTarget.dispose(),this._renderTarget=null)}doRender(e){const t=this.createRenderParams(e),{context:r,painter:s,profiler:a}=t;this._prevFBO=r.getBoundFramebufferObject(),a.recordContainerStart(this.name);const o=this._getFbo(t),d=s.getRenderTarget();r.bindFramebuffer(o),s.setRenderTarget(o),r.setDepthWriteEnabled(!0),r.setColorMask(!0,!0,!0,!0),r.setClearColor(0,0,0,0),r.setClearDepth(1),r.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT),r.setDepthWriteEnabled(!1);for(const n of this.children)n.beforeRender(e);for(const n of this.children)n.processRender(t);for(const n of this.children)n.afterRender(e);s.setRenderTarget(d),r.bindFramebuffer(this._prevFBO),s.beforeRenderLayer(t,this._clippingInfos?255:0,this.computedOpacity),r.setStencilTestEnabled(!1),r.setStencilWriteMask(0),s.blitTexture(r,o.colorTexture,9728),s.compositeLayer(t,this.computedOpacity),a.recordContainerEnd()}createRenderParams(e){return m(p({},super.createRenderParams(e)),{blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:1})}_getFbo(e){const{context:t,painter:r}=e,{width:s,height:a}=t.getViewport();if(s!==this._lastWidth||a!==this._lastHeight)if(this._lastWidth=s,this._lastHeight=a,this._renderTarget)this._renderTarget.resize(s,a);else{const o={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:s,height:a},d={colorTarget:0,depthStencilTarget:3};this._renderTarget=new T(t,d,o,r.getSharedStencilBuffer())}return this._renderTarget}}let h=class extends j(R){constructor(){super(...arguments),this.container=new F}attach(){this._updateStageChildren(),this.handles.add(this.layerViews.on("after-changes",()=>this._updateStageChildren()),"grouplayerview2d")}detach(){this.handles.remove("grouplayerview2d"),this.container.removeAllChildren()}update(i){}moveStart(){}viewChange(){}moveEnd(){}_updateStageChildren(){this.container.removeAllChildren(),this.layerViews.forEach((i,e)=>this.container.addChildAt(i.container,e))}};h=w([y("esri.views.2d.layers.GroupLayerView2D")],h);const A=h;export{A as default};
