import{q3 as M,q4 as C,cL as I}from"./index.a1c5dd56.js";import{CIMSymbolRasterizer as z}from"./CIMSymbolRasterizer.d75be735.js";import{l as S}from"./renderUtils.62c2284a.js";import"./vendor.c6be4c00.js";import"./index.a0863940.js";/* empty css              */import"./qrcode.0911187d.js";/* empty css                 */import"./cimAnalyzer.c15d2222.js";import"./CIMSymbolHelper.a880d9c5.js";import"./BidiEngine.aae60613.js";import"./definitions.21e97413.js";import"./number.dfbabd3f.js";import"./GeometryUtils.d4e26b77.js";import"./Rasterizer.172303a5.js";import"./colorUtils.92e1b957.js";const x=new z(null,!0),v=120;async function T(e,t={}){const{size:m,maxSize:p,node:y,opacity:f}=t,u=t.cimOptions||t,{feature:b,fieldMap:j,geometryType:g,style:w}=u,h=M(e),i=Math.min(m!=null?m:h,p!=null?p:I(v));i!==h&&(e=e.clone(),C(e,i,{preserveOutlineWidth:!0}));let s=3;e&&e.data&&e.data.symbol&&e.data.symbol.type!=="CIMPointSymbol"&&(s=1);const c=await x.rasterizeCIMSymbolAsync(e,b,j,g,{scaleFactor:s,style:w}),a=document.createElement("canvas");a.width=c.imageData.width,a.height=c.imageData.height,a.getContext("2d").putImageData(c.imageData,0,0);let l=a.width/s,r=a.height/s;if(m!=null&&((t==null?void 0:t.scale)==null||(t==null?void 0:t.scale))){const o=l/r;l=o<=1?Math.ceil(i*o):i,r=o<=1?i:Math.ceil(i/o)}const n=new Image(l,r);n.src=a.toDataURL(),f!=null&&(n.style.opacity=`${f}`);let d=n;if(t.effectView!=null){const o={shape:{type:"image",x:0,y:0,width:l,height:r,src:n.src},fill:null,stroke:null,offset:[0,0]};d=S([[o]],[l,r],{effectView:t.effectView})}return y&&y.appendChild(d),d}export{T as previewCIMSymbol};
