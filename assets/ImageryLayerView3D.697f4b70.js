import{g0 as d,cc as o,b5 as m,aX as h,aZ as c}from"./vendor.c8f3cc8c.js";import{V as p}from"./DynamicLayerView3D.809cdda5.js";import{u as g}from"./ImageryLayerView.a6f5358a.js";import"./projectExtentUtils.32bc4bc4.js";import"./RefreshableLayerView.552e5409.js";import"./popupUtils.37c6f82e.js";let s=class extends g(p){constructor(){super(...arguments),this.type="imagery-3d",this.redrawDebounced=d(async e=>{this.redraw((a,t)=>this._redrawImage(a,t),e)},2e3)}initialize(){this.handles.add([o(this.view.basemapTerrain,"ready",()=>this.initializeMaximumDataResolution()),this.layer.on("redraw",()=>this.redrawDebounced())]),this.updatingHandles.add(this.layer,"exportImageServiceParameters.version",()=>{this.updatingHandles.addPromise(this.refreshDebounced())}),this.updatingHandles.add(this,"timeExtent",()=>this.updatingHandles.addPromise(this.refreshDebounced()))}initializeMaximumDataResolution(){const e=this.view.basemapTerrain.spatialReference,a=this.layer.fullExtent;a&&e.equals(a.spatialReference)&&(this.maximumDataResolution={x:this.layer.pixelSizeX,y:this.layer.pixelSizeY})}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,a,t){a.imageElement?e.image=a.imageElement:(e.image=document.createElement("canvas"),e.pixelData=a.pixelData,await this._redrawImage(e,t))}async _redrawImage(e,a){if(!(e.image instanceof HTMLCanvasElement)||m(e.pixelData))return Promise.reject();const t=e.image,r=t.getContext("2d"),l=await this.layer.applyRenderer(e.pixelData,{signal:a}),i=this.layer.applyFilter(l).pixelBlock;if(m(i))return Promise.reject();t.width=i.width,t.height=i.height;const n=r.createImageData(i.width,i.height);n.data.set(i.getAsRGBA()),r.putImageData(n,0,0)}};s=h([c("esri.views.3d.layers.ImageryLayerView3D")],s);const b=s;export{b as default};
