import{b0 as h,b5 as c,c5 as E,rc as T,bg as V,b1 as u,hy as j,k_ as R,bh as I,aX as p,aY as g,aZ as P,a_ as H,bP as B,h3 as k,bs as $,fl as D,pG as U,kY as O,hN as F,pH as L,cd as q,co as Y,rd as J,cf as K,cg as N,lI as W,re as X,g7 as Z,rf as S,bJ as Q,h0 as x,hn as ee,cz as te,rg as se,hK as re,gU as ie,rh as oe,bO as M}from"./vendor.c8f3cc8c.js";import{y as ae,p as ne}from"./colorUtils.92e1b957.js";class le{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return h(this._resources)?this._resources.object:null}get resources(){return h(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this.resourceFactory.recreateGeometry)return void this.recreate();const e=this.resourceFactory.view._stage;if(c(this._resources)||!e)return;const t=this._resources.object;this._resources.external.forEach(i=>{i.type===2&&e.remove(i)}),t.removeAllGeometries();const s=this.resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);e.addMany(s)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this.resourceFactory.view._stage;if(!e)return;const t=new E({isPickable:!1,updatePolicy:1});e.add(t);const s=new T({castShadow:!1}),i=this.resourceFactory.createResources(s,t);i.forEach(d=>e.add(d)),e.add(s),t.add(s),this._syncVisible();const a=this.resourceFactory.cameraChanged?V(this.resourceFactory.view.state,"camera",d=>this.resourceFactory.cameraChanged(d)):null;this._resources={layer:t,object:s,external:i,cameraHandle:a}}_destroyResources(){if(c(this._resources))return;const e=this.resourceFactory.view._stage;e==null||e.remove(this._resources.object),e==null||e.remove(this._resources.layer),this._resources.external.forEach(t=>{e==null||e.remove(t),"dispose"in t&&t.dispose()}),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}_syncVisible(){c(this._resources)||this._resources.object.setVisible(this._visible)}}const r={main:new u([255,127,0]),selected:new u([255,255,255]),staged:new u([12,207,255]),outline:new u([0,0,0,.5]),selectedOutline:new u([255,255,255])},m=.3;function w(o,e){const t=o.clone();return t.a*=e,t}function he(o,e){const t=o.clone(),s=ae(t);s.s*=e;const i=ne(s);return t.r=i.r,t.g=i.g,t.b=i.b,t}function l(o,e){if(e)for(const t in e)o[t]=e[t]}class ce{constructor(e){this.color=r.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,l(this,e)}}class G{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=r.main,this.outlineColor=r.outline,this.renderOccluded=16,this.hoverOutlineColor=r.selectedOutline,l(this,e)}apply(e,t){const s=this[e];t.setParameters({color:_(s),transparent:e!=="color"||s.a<1,renderOccluded:this.renderOccluded})}}class de{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=w(r.main,.5),this.hoverColor=r.main,this.renderOccluded=2,this.minSquaredEdgeLength=900,l(this,e)}apply(e,t){const s=this[e];t.setParameters({color:_(s),transparent:s.a<1,renderOccluded:this.renderOccluded})}}class ue{constructor(e){this.vertex=new G({color:r.main,outlineColor:r.outline}),this.edge=new G({color:he(w(r.main,2/3),.5),outlineColor:w(r.outline,.5),size:8,collisionPadding:8}),this.selected=new G({color:r.selected,outlineColor:r.outline}),this.edgeOffset=new de,l(this,e)}}class A{constructor(e){this.color=r.selected,this.width=1.5,this.stipplePattern=R(5),this.stippleOffColor=r.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=r.selected,this.renderOccluded=4,l(this,e)}apply(e){e.color=_(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=_(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=_(this.innerColor),e.renderOccluded=this.renderOccluded}}class pe{constructor(e){this.color=r.selected,this.size=4,this.outlineSize=1,this.outlineColor=r.outline,this.shape="square",l(this,e)}apply(e){e.color=_(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=_(this.outlineColor),e.primitive=this.shape}}class b{constructor(e){this.innerColor=r.selected,this.innerWidth=1,this.glowColor=r.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=m,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=r.main,l(this,e)}apply(e,t=1){const s={glowColor:u.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:u.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=s:e.laserlineStyle=s}}class _e{constructor(e){this.outline=new A({color:r.outline,renderOccluded:8,stippleOffColor:r.selected,stipplePattern:R(5),width:1.5,innerWidth:0}),this.staged=new A({color:r.selected,renderOccluded:8,innerColor:r.staged,stippleOffColor:r.outline,stipplePattern:R(5),width:1.5}),this.shadowStyle=new b({globalAlpha:m,glowColor:r.main,glowFalloff:8,glowWidth:8,innerColor:r.selected,innerWidth:1}),l(this,e)}}class ge{constructor(e){this.outline=new pe({color:r.selected,outlineColor:r.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new b({globalAlpha:m,glowColor:r.main,glowFalloff:1.5,glowWidth:6,innerColor:r.selected,innerWidth:1,radius:2}),l(this,e)}}class me extends A{constructor(e){super(),this.extensionType=2,l(this,e)}}class fe{constructor(e){this.lineGraphics=new _e,this.pointGraphics=new ge,this.heightPlane=new b({globalAlpha:m,glowColor:r.main,glowFalloff:8,glowWidth:8,innerColor:r.selected,innerWidth:1}),this.heightBox=new b({globalAlpha:m,glowColor:r.main,glowFalloff:8,glowWidth:8,innerColor:r.selected,innerWidth:0,heightFillColor:r.main}),this.zVerticalLine=new me({color:w(r.main,5*m/3),falloff:2,innerColor:w(r.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,l(this,e)}}class ye{constructor(e){this.visualElements=new fe,this.reshapeManipulators=new ue,this.zManipulator=new ce,l(this,e)}colorToVec4(e){return _(e)}}function _(o){return j(u.toUnitRGBA(o))}const Re=new ye;class we{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return h(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this.resourceFactory.recreateGeometry?c(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?c(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this.resourceFactory.createResources();this._resources={layerView:new v({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();const s=(e=this.resourceFactory.view.basemapTerrain)==null?void 0:e.overlayManager;s&&s.registerDrapeSource(this._resources.layerView)}_destroyResources(){var e;if(c(this._resources))return;this.ensureRenderGeometriesRemoved();const t=(e=this.resourceFactory.view.basemapTerrain)==null?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved()}ensureRenderGeometriesRemoved(){var e;c(this._resources)||(e=this.resourceFactory.view)==null||!e.basemapTerrain||!this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)}ensureRenderGeometriesAdded(){c(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)}}let v=class extends I(H){constructor(o){super(o),this.drapeSourceType=1,this.updatePolicy=1}};p([g({constructOnly:!0})],v.prototype,"view",void 0),p([g({readOnly:!0})],v.prototype,"drapeSourceType",void 0),v=p([P("DrapedVisualElementLayerView")],v);class Oe{constructor(e){this.view=null,this._attachmentOrigin=k(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new $,this._isDraped=!1,this._geometry=null,this._width=1,this._color=D(1,0,1,1),this._innerWidth=0,this._innerColor=D(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new le({view:e.view,createResources:s=>this.createResources(s),recreateGeometry:(s,i)=>(s.geometries.length=0,this.recreateGeometry(i,s.material,s.geometries),s.geometries)}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new we({view:e.view,createResources:()=>this._createDrapedResources(),recreateGeometry:s=>{s.geometries=this._createRenderGeometriesDraped(s.material),this.attachmentOriginChanged()}});let t=!0;this._laserline=new U({view:e.view});for(const s in e)s in this?s==="attached"?t=e[s]:this[s]=e[s]:console.error("Cannot set unknown property",s);this.attached=t}destroy(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}get laserlineAttached(){return this.attached&&this.visible&&h(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}get attached(){return this.resources.attached||this.drapedResources.attached}set attached(e){this.updateAttached(e)}updateAttached(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){O(e,this._color)||(F(this._color,e),this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){O(e,this._innerColor)||(F(this._innerColor,e),this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=h(e)!==h(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&O(e,this._stippleOffColor)||(this._stippleOffColor=e?L(e):null,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,h(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=h(this.resources.resources)?this.resources.resources.geometries:null;if(!e||e.length===0)return null;q(f,0,0,0);let t=0;for(const s of e){const i=s.vertexAttributes.get("position"),a=s.indices.get("position"),d=Y(this.resources.resources).material.isClosed(i.data,a);J(i,a,d,z)&&(K(f,f,z),t++)}return t===0?null:(N(f,f,1/t),this.view.renderCoordsHelper.fromRenderCoords(f,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}updateMaterial(){h(this.resources.resources)&&this.resources.resources.material.setParameters(this.materialParameters),h(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this.materialParameters)}get isClosed(){return h(this.geometry)&&this.geometry.type==="polygon"}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}get normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===8?4:this._renderOccluded}recreateGeometry(e,t,s){const i=this.createRenderGeometries();for(const a of i)e.addGeometry(a,t),s.push(a);this.attachmentOriginChanged()}attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}createResources(e){const t=new W(this.materialParameters),s=[];return this.recreateGeometry(e,t,s),{material:t,geometries:s,forEach:i=>{i(t),s.forEach(i)}}}_createDrapedResources(){const e=new W(this.materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const t=this.geometry;if(c(t))return[];const s=X(t,this.view.basemapTerrain.spatialReference),i=[];for(const{position:a}of s.lines){const d={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:a},removeDuplicateStartEnd:this.isClosed?1:0},C=new Z(S(d),e),n=Q(ve);x(n,a),ee(C.boundingSphere,.5*(n[0]+n[3]),.5*(n[1]+n[4]),0,.5*Math.sqrt((n[3]-n[0])*(n[3]-n[0])+(n[4]-n[1])*(n[4]-n[1]))),i.push(C)}return i}calculateMapBounds(e){if(c(this.resources.resources))return!1;const t=this.view.renderCoordsHelper;for(const s of this.resources.resources.geometries){const i=s.vertexAttributes.get("position"),a=new Float64Array(i.data.length);te(i.data,t.spatialReference,0,a,this.view.spatialReference,0,i.data.length/3),x(e,a)}return!0}createRenderGeometries(){var e;const t=this.geometry;if(c(t))return[];const s=se(t,this.view.elevationProvider,this.view.renderCoordsHelper,re.fromElevationInfo((e=this.elevationInfo)!=null?e:new ie({mode:oe(t,null)}))),i=[],a=[];for(const{position:d,mapPosition:C}of s.lines){const n={overlayInfo:null,attributeData:{position:d,mapPosition:C},removeDuplicateStartEnd:this.isClosed?1:0};i.push(S(n)),a.push(d)}return this._laserline.pathVerticalPlane=a,i}}const ve=B(),z=M(),f=M();let y=class extends $.EventedAccessor{constructor(o){super(o),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};p([g({constructOnly:!0})],y.prototype,"graphic",void 0),p([g()],y.prototype,"tracking",void 0),p([g()],y.prototype,"displaying",void 0),p([g()],y.prototype,"isDraped",void 0),y=p([P("esri.views.3d.layers.graphics.GraphicState")],y);export{Re as A,Oe as a,y as e,le as o,r as s};
