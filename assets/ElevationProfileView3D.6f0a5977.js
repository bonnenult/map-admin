import{lQ as H,c4 as v,b6 as u,b1 as f,dH as D,bB as P,st as L,q2 as $,pT as k,gj as G,aY as g,aZ as w,a_ as V,a$ as j,aW as y,dn as z,l0 as d,l1 as p,hz as T,b2 as x,bJ as A,ly as I,sx as M,hc as E,ba as _,su as b}from"./vendor.47ccae81.js";import{h as O}from"./HoveredPoints.f6be80af.js";import{a as R,e as S,A as C}from"./GraphicState.991d5ee4.js";import"./colorUtils.92e1b957.js";class B{constructor(e){this._params=e,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null}destroy(){this.remove()}remove(){this._highlightTask=H(this._highlightTask),this._highlightHandle=v(this._highlightHandle),this._visualElementHandle=v(this._visualElementHandle)}showHighlight(e){if(this.remove(),u(e)||!m(e))return;const s=e.layer;this._highlightTask=D(async t=>{const h=await this._params.view.whenLayerView(s);P(t),L(h)&&(this._highlightHandle=h.highlight(e))})}showReshaping(e){if(this.remove(),u(e))return;const s=this._params.view,t=new R({view:s,geometry:m(e)?e.geometry:null,attached:!1,elevationInfo:$(e),renderOccluded:8}),h=new S({graphic:e}),i=[h.watch("isDraped",o=>{t.isDraped=o}),h.on("changed",()=>{t.geometry=m(e)?e.geometry:null}),s.trackGraphicState(h),s.maskOccludee(e),k(t)];C.visualElements.lineGraphics.outline.apply(t),t.attached=!0,this._visualElementHandle=G(i)}}function m(a){return f(a.geometry)&&a.geometry.type==="polyline"}const U=100;let c=class extends j{constructor(a){super(a),this._chartData=null,this._visualElements=[],this._handles=new y}initialize(){const a=z(e=>{this._update(e)},U);this._handles.add([d(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),a,p),a])}destroy(){this._handles.destroy(),this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(a){this._chartData=a}_update(a){const{chartData:e}=a;if(u(e))return this.remove();if(!e.refined)return;const s=this._visualElements,t=e.lines.filter(n=>n.viewVisualizationEnabled),h=t.length;for(;s.length>h;)s.pop().destroy();const i=M;for(;s.length<h;){const n=new R({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:i.width-i.outlineSize,width:i.width,falloff:i.falloff,color:i.outlineColor,renderOccluded:i.renderOccluded});s.push(n)}const o=a.spatialReference;for(let n=0;n<h;++n){const l=s[n],r=t[h-1-n];l.geometry=this._createLineGeometry(r,o),l.innerColor=T(x.toUnitRGBA(r.color))}}_createLineGeometry(a,e){const s=A(a.samples,[]),t=s.length-1,h=[];let i=[];for(let o=0;o<=t;o++){const{x:n,y:l,z:r}=s[o];f(r)&&i.push([n,l,r]),(o===t||u(r))&&i.length&&(h.push(i),i=[])}return new I({paths:h,hasZ:!0,spatialReference:e})}_destroyVisualElements(){this._visualElements.forEach(a=>a.destroy()),this._visualElements.length=0}};g([w()],c.prototype,"view",void 0),g([w()],c.prototype,"_chartData",void 0),c=g([V("esri.widgets.ElevationProfile.support.ProfileLines3D")],c);class J{constructor(e,s){this._handles=new y,this._inputRepresentation=new B({view:e}),this._hoveredPoints=new O({view:e}),this._profileLines=new c({view:e}),this._handles.add([d(()=>s.viewModel.hoveredPoints,t=>this._hoveredPoints.update(t),p),d(()=>{const{state:t,editable:h,highlightEnabled:i,viewModel:o}=s,n=o.input;return E(n,l=>{l.commitProperty("geometry"),l.commitProperty("layer")}),{input:n,state:t,editable:h,highlightEnabled:i}},t=>this._updateInputRepresentation(t),p),d(()=>s.viewModel.chartData,t=>this._profileLines.update(t),p),d(()=>E(s.viewModel.input,t=>t.geometry),()=>{this._profileLines.remove()},p)])}destroy(){this._handles=_(this._handles),this._inputRepresentation=_(this._inputRepresentation),this._hoveredPoints=_(this._hoveredPoints),this._profileLines=_(this._profileLines)}_updateInputRepresentation({input:e,state:s,editable:t,highlightEnabled:h}){const i=this._inputRepresentation;if(!h)return i.remove();s===b.Selected?i.showHighlight(e):s!==b.Created||t?i.remove():i.showReshaping(e)}}export{J as ElevationProfileView3D};
