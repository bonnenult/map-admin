import{r as v,t as k}from"./index.a1c5dd56.js";import{a as O,b as R,d as w}from"./PointCloudUniqueValueRenderer.9849882d.js";import{C as A,y as S,c as V,a as B}from"./I3SBinaryReader.b22fe25b.js";function $(n,t,u,f){const{rendererJSON:d,isRGBRenderer:p}=n;let r=null,s=null;if(t&&p)r=t;else if(t&&d.type==="pointCloudUniqueValueRenderer"){s=O.fromJSON(d);const e=s.colorUniqueValueInfos;r=new Uint8Array(3*f);const a=m(s.fieldTransformType);for(let o=0;o<f;o++){const i=(a?a(t[o]):t[o])+"";for(let l=0;l<e.length;l++)if(e[l].values.indexOf(i)>=0){r[3*o]=e[l].color.r,r[3*o+1]=e[l].color.g,r[3*o+2]=e[l].color.b;break}}}else if(t&&d.type==="pointCloudStretchRenderer"){s=R.fromJSON(d);const e=s.stops;r=new Uint8Array(3*f);const a=m(s.fieldTransformType);for(let o=0;o<f;o++){const i=a?a(t[o]):t[o],l=e.length-1;if(i<e[0].value)r[3*o]=e[0].color.r,r[3*o+1]=e[0].color.g,r[3*o+2]=e[0].color.b;else if(i>=e[l].value)r[3*o]=e[l].color.r,r[3*o+1]=e[l].color.g,r[3*o+2]=e[l].color.b;else for(let c=1;c<e.length;c++)if(i<e[c].value){const b=(i-e[c-1].value)/(e[c].value-e[c-1].value);r[3*o]=e[c].color.r*b+e[c-1].color.r*(1-b),r[3*o+1]=e[c].color.g*b+e[c-1].color.g*(1-b),r[3*o+2]=e[c].color.b*b+e[c-1].color.b*(1-b);break}}}else if(t&&d.type==="pointCloudClassBreaksRenderer"){s=w.fromJSON(d);const e=s.colorClassBreakInfos;r=new Uint8Array(3*f);const a=m(s.fieldTransformType);for(let o=0;o<f;o++){const i=a?a(t[o]):t[o];for(let l=0;l<e.length;l++)if(i>=e[l].minValue&&i<=e[l].maxValue){r[3*o]=e[l].color.r,r[3*o+1]=e[l].color.g,r[3*o+2]=e[l].color.b;break}}}else{r=new Uint8Array(3*f);for(let e=0;e<r.length;e++)r[e]=255}if(u&&s&&s.colorModulation){const e=s.colorModulation.minValue,a=s.colorModulation.maxValue,o=.3;for(let i=0;i<f;i++){const l=u[i],c=l>=a?1:l<=e?o:o+(1-o)*(l-e)/(a-e);r[3*i]=c*r[3*i],r[3*i+1]=c*r[3*i+1],r[3*i+2]=c*r[3*i+2]}}return r}function q(n,t){if(n.encoding==null||n.encoding===""){const u=S(t,n);if(k(u.vertexAttributes.position))return;const f=V(t,u.vertexAttributes.position),d=u.header.fields,p=[d.offsetX,d.offsetY,d.offsetZ],r=[d.scaleX,d.scaleY,d.scaleZ],s=f.length/3,e=new Float64Array(3*s);for(let a=0;a<s;a++)e[3*a]=f[3*a]*r[0]+p[0],e[3*a+1]=f[3*a+1]*r[1]+p[1],e[3*a+2]=f[3*a+2]*r[2]+p[2];return e}if(n.encoding==="lepcc-xyz")return B(t).result}function F(n,t,u){return v(n)&&n.attributeInfo.useElevation?U(t,u):v(n)?A(n.attributeInfo.storageInfo,n.buffer,u):null}function U(n,t){const u=new Float64Array(t);for(let f=0;f<t;f++)u[f]=n[3*f+2];return u}function J(n,t,u,f,d){const p=n.length/3;let r=0;for(let s=0;s<p;s++){let e=!0;for(let a=0;a<f.length&&e;a++){const{filterJSON:o}=f[a],i=d[a].values[s];switch(o.type){case"pointCloudValueFilter":{const l=o.mode==="exclude";o.values.indexOf(i)!==-1===l&&(e=!1);break}case"pointCloudBitfieldFilter":{const l=C(o.requiredSetBits),c=C(o.requiredClearBits);(i&l)===l&&(i&c)==0||(e=!1);break}case"pointCloudReturnFilter":{const l=15&i,c=i>>>4&15,b=c>1,x=l===1,y=l===c;let h=!1;for(const g of o.includedReturns)if(g==="last"&&y||g==="firstOfMany"&&x&&b||g==="lastOfMany"&&y&&b||g==="single"&&!b){h=!0;break}h||(e=!1);break}}}e&&(u[r]=s,n[3*r]=n[3*s],n[3*r+1]=n[3*s+1],n[3*r+2]=n[3*s+2],t[3*r]=t[3*s],t[3*r+1]=t[3*s+1],t[3*r+2]=t[3*s+2],r++)}return r}function m(n){return n==null||n==="none"?null:n==="low-four-bit"?t=>15&t:n==="high-four-bit"?t=>(240&t)>>4:n==="absolute-value"?t=>Math.abs(t):n==="modulo-ten"?t=>t%10:null}function C(n){let t=0;for(const u of n||[])t|=1<<u;return t}export{F as a,q as c,U as d,J as m,$ as u};
