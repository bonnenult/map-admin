import{aW as u,aX as g,aY as Y,fR as q,bN as b,dt as G,lI as E,m$ as S,jM as k,gI as N,gm as m,gL as j,n0 as h,n1 as C,gn as D,gl as z,hi as V,n2 as A,cy as W,n3 as H,n4 as J,n5 as K,ap as U,a$ as w,n6 as X,n7 as Q,lM as v,n8 as Z,n9 as L,b4 as f,na as x,nb as y,nc as tt,nd as nt,gw as et,ne as rt,bF as at,l2 as ot,gK as it,nf as lt,ng as st,nh as ct,ni as pt,nj as ut,nk as gt}from"./vendor.70daa49e.js";import{a as B,l as ft,x as ht}from"./axisAngleDegrees.ec99b7a7.js";var M;let p=M=class extends q{constructor(t){super(t),this.origin=b(),this.translation=b(),this.rotation=B(),this.scale=G(1,1,1),this.geographic=!0}get localMatrix(){const t=m();return E(t,t,this.scale),S(t,t,ht(this.rotation),ft(this.rotation)),k(t,t,this.translation),t}get localMatrixInverse(){return N(m(),this.localMatrix)}applyLocal(t,e){return j(e,t,this.localMatrix)}applyLocalInverse(t,e){return j(e,t,this.localMatrixInverse)}project(t,e){const n=new Float64Array(t.length),r=h.fromTypedArray(n),a=h.fromTypedArray(t);if(this.geographic){const l=C(D(e)),c=m();return z(e,this.origin,c,l),V(c,c,this.localMatrix),A(r,a,c),W(n,l,0,n,e,0,n.length/3),n}const{localMatrix:o,origin:i}=this;H(o,J)?K(r,a):A(r,a,o);for(let l=0;l<n.length;l+=3)n[l+0]+=i[0],n[l+1]+=i[1],n[l+2]+=i[2];return n}getOriginPoint(t){const[e,n,r]=this.origin;return new U({x:e,y:n,z:r,spatialReference:t})}equals(t){return w(t)&&this.geographic===t.geographic&&X(this.origin,t.origin)&&Q(this.localMatrix,t.localMatrix)}clone(){const t={origin:v(this.origin),translation:v(this.translation),rotation:B(this.rotation),scale:v(this.scale),geographic:this.geographic};return new M(t)}};u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"origin",void 0),u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"translation",void 0),u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"rotation",void 0),u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"scale",void 0),u([g({type:Boolean,nonNullable:!0,json:{write:!0}})],p.prototype,"geographic",void 0),u([g()],p.prototype,"localMatrix",null),u([g()],p.prototype,"localMatrixInverse",null),p=M=u([Y("esri.geometry.support.MeshTransform")],p);const yt=p;function $(t,e){var n;return t.isGeographic||t.isWebMercator&&((n=e==null?void 0:e.geographic)==null||n)}function I(t,e,n){return $(e.spatialReference,n)?$t(t,e,n):xt(t,e,n)}function mt(t,e,n){const{position:r,normal:a,tangent:o}=t;if(f(e))return{position:r,normal:a,tangent:o};const i=e.localMatrix;return I({position:pt(r,new Float64Array(r.length),i),normal:w(a)?ut(a,new Float32Array(a.length),i):null,tangent:w(o)?gt(o,new Float32Array(o.length),i):null},e.getOriginPoint(n),{geographic:e.geographic})}function jt(t,e,n){if(n!=null&&n.useTransform){var r;const{position:a,normal:o,tangent:i}=t;return{vertexAttributes:{position:a,normal:o,tangent:i},transform:new yt({origin:[e.x,e.y,(r=e.z)!=null?r:0],geographic:$(e.spatialReference,n)})}}return{vertexAttributes:I(t,e,n),transform:null}}function At(t,e,n){return $(e.spatialReference,n)?_(t,e,n):T(t,e,n)}function zt(t,e,n,r){if(f(e))return At(t,n,r);const a=mt(t,e,n.spatialReference);return n.equals(e.getOriginPoint(n.spatialReference))?T(a,n,r):$(n.spatialReference,r)?_(a,n,r):T(a,n,r)}function xt(t,e,n){const r=new Float64Array(t.position.length),a=t.position,o=e.x,i=e.y,l=e.z||0,{horizontal:c,vertical:d}=F(n?n.unit:null,e.spatialReference);for(let s=0;s<a.length;s+=3)r[s+0]=a[s+0]*c+o,r[s+1]=a[s+1]*c+i,r[s+2]=a[s+2]*d+l;return{position:r,normal:t.normal,tangent:t.tangent}}function $t(t,e,n){const r=e.spatialReference,a=O(e,n,R),o=new Float64Array(t.position.length),i=dt(t.position,a,r,o),l=L(P,a);return{position:i,normal:wt(i,o,t.normal,l,r),tangent:vt(i,o,t.tangent,l,r)}}function dt(t,e,n,r){A(h.fromTypedArray(r),h.fromTypedArray(t),e);const a=new Float64Array(t.length);return Z(r,a,n)}function wt(t,e,n,r,a){if(f(n))return null;const o=new Float32Array(n.length);return x(y.fromTypedArray(o),y.fromTypedArray(n),r),tt(o,t,e,a,o),o}function vt(t,e,n,r,a){if(f(n))return null;const o=new Float32Array(n.length);x(y.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT),y.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT),r);for(let i=3;i<o.length;i+=4)o[i]=n[i];return nt(o,t,e,a,o),o}function T(t,e,n){const r=new Float64Array(t.position.length),a=t.position,o=e.x,i=e.y,l=e.z||0,{horizontal:c,vertical:d}=F(n?n.unit:null,e.spatialReference);for(let s=0;s<a.length;s+=3)r[s+0]=(a[s+0]-o)/c,r[s+1]=(a[s+1]-i)/c,r[s+2]=(a[s+2]-l)/d;return{position:r,normal:t.normal,tangent:t.tangent}}function _(t,e,n){const r=e.spatialReference;O(e,n,R);const a=N(Rt,R),o=new Float64Array(t.position.length),i=Mt(t.position,r,a,o),l=L(P,a);return{position:i,normal:Tt(t.normal,t.position,o,r,l),tangent:Ft(t.tangent,t.position,o,r,l)}}function O(t,e,n){z(t.spatialReference,[t.x,t.y,t.z||0],n,et(t.spatialReference));const{horizontal:r,vertical:a}=F(e?e.unit:null,t.spatialReference);return E(n,n,[r,r,a]),n}function Mt(t,e,n,r){const a=lt(t,e,r),o=h.fromTypedArray(a),i=new Float64Array(a.length),l=h.fromTypedArray(i);return A(l,o,n),i}function Tt(t,e,n,r,a){if(f(t))return null;const o=st(t,e,n,r,new Float32Array(t.length)),i=y.fromTypedArray(o);return x(i,i,a),o}function Ft(t,e,n,r,a){if(f(t))return null;const o=ct(t,e,n,r,new Float32Array(t.length)),i=y.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT);return x(i,i,a),o}function F(t,e){if(f(t))return bt;const n=e.isGeographic?1:rt(e),r=e.isGeographic?1:at(e),a=ot(1,t,"meters");return{horizontal:a*n,vertical:a*r}}const R=m(),Rt=m(),P=it(),bt={horizontal:1,vertical:1};export{zt as M,yt as O,mt as _,jt as b,At as k,$ as r,I as x};
