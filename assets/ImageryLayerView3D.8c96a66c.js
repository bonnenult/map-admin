import{el as o,av as l,t as m,e as h,i as p}from"./index.988b09cd.js";import{V as c}from"./DynamicLayerView3D.999da6f2.js";import{u}from"./ImageryLayerView.b93b40bd.js";import"./vendor.c6be4c00.js";import"./index.25aa0880.js";/* empty css              */import"./qrcode.0911187d.js";/* empty css                 */import"./projectExtentUtils.237a1767.js";import"./RefreshableLayerView.c8d2ecf1.js";import"./popupUtils.54225bd2.js";let s=class extends u(c){constructor(){super(...arguments),this.type="imagery-3d",this.redrawDebounced=o(async e=>{this.redraw((t,a)=>this._redrawImage(t,a),e)},2e3)}initialize(){this.handles.add([l(this.view.basemapTerrain,"ready",()=>this.initializeMaximumDataResolution()),this.layer.on("redraw",()=>this.redrawDebounced())]),this.updatingHandles.add(this.layer,"exportImageServiceParameters.version",()=>{this.updatingHandles.addPromise(this.refreshDebounced())}),this.updatingHandles.add(this,"timeExtent",()=>this.updatingHandles.addPromise(this.refreshDebounced()))}initializeMaximumDataResolution(){const e=this.view.basemapTerrain.spatialReference,t=this.layer.fullExtent;t&&e.equals(t.spatialReference)&&(this.maximumDataResolution={x:this.layer.pixelSizeX,y:this.layer.pixelSizeY})}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,t,a){t.imageElement?e.image=t.imageElement:(e.image=document.createElement("canvas"),e.pixelData=t.pixelData,await this._redrawImage(e,a))}async _redrawImage(e,t){if(!(e.image instanceof HTMLCanvasElement)||m(e.pixelData))return Promise.reject();const a=e.image,r=a.getContext("2d"),d=await this.layer.applyRenderer(e.pixelData,{signal:t}),i=this.layer.applyFilter(d).pixelBlock;if(m(i))return Promise.reject();a.width=i.width,a.height=i.height;const n=r.createImageData(i.width,i.height);n.data.set(i.getAsRGBA()),r.putImageData(n,0,0)}};s=h([p("esri.views.3d.layers.ImageryLayerView3D")],s);const I=s;export{I as default};
