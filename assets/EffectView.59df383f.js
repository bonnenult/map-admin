import{aX as o,aY as u,aZ as y,a_ as v,bC as T,bE as $,ej as p,fi as E,fj as S,fk as b}from"./vendor.c8f3cc8c.js";const _=-1;let a=class extends v{constructor(t){super(t),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=T("mapview-transitions-duration"),this.effects=[]}set effect(t){if(this._get("effect")!==(t=t||"")){this._set("effect",t);try{this._transitionTo(g(t))}catch(e){this._transitionTo([]),$.getLogger(this.declaredClass).warn("Invalid Effect",{effect:t,error:e})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(t){this._updateForScale(t)}get transitioning(){return this._to!==null}canTransitionTo(t){try{return this.scale>0&&m(this._current,g(t),this.scale)}catch{return!1}}transitionStep(t,e){this._applyTimeTransition(t),this._updateForScale(e)}end(){this._applyTimeTransition(this.duration)}_transitionTo(t){this.scale>0&&m(this._current,t,this.scale)?(this._final=t,this._to=p(t),j(this._current,this._to,this.scale),this._from=p(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set("effects",this._current[0]?p(this._current[0].effects):[])}_applyTimeTransition(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;const e=Math.min(1,this._time/this.duration);for(let i=0;i<this._current.length;i++){const r=this._current[i],c=this._from[i],n=this._to[i];r.scale=w(c.scale,n.scale,e);for(let s=0;s<r.effects.length;s++){const f=r.effects[s],h=c.effects[s],d=n.effects[s];f.interpolate(h,d,e)}}e===1&&(this._current=this._final,this._set("effects",this._current[0]?p(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(t){if(this._set("scale",t),this._current.length===0)return;const e=this._current,i=this._current.length-1;let r,c,n=1;if(e.length===1||t>=e[0].scale)c=r=e[0].effects;else if(t<=e[i].scale)c=r=e[i].effects;else for(let s=0;s<i;s++){const f=e[s],h=e[s+1];if(f.scale>=t&&h.scale<=t){n=(t-f.scale)/(h.scale-f.scale),r=f.effects,c=h.effects;break}}for(let s=0;s<this.effects.length;s++)this.effects[s].interpolate(r[s],c[s],n)}};o([u()],a.prototype,"_to",void 0),o([u()],a.prototype,"duration",void 0),o([u({value:""})],a.prototype,"effect",null),o([u({readOnly:!0})],a.prototype,"effects",void 0),o([u({readOnly:!0})],a.prototype,"hasEffects",null),o([u({value:0})],a.prototype,"scale",null),o([u({readOnly:!0})],a.prototype,"transitioning",null),a=o([y("esri.layers.effects.EffectView")],a);const k=a;function g(t){const e=E(t)||[];return F(e)?[{scale:_,effects:e}]:e}function m(t,e,i){var r,c,n,s;return(r=t[0])==null||!r.effects||(c=e[0])==null||!c.effects?!0:!((((n=t[0])==null?void 0:n.scale)===_||((s=e[0])==null?void 0:s.scale)===_)&&(t.length>1||e.length>1)&&i<=0)&&S(t[0].effects,e[0].effects)}function j(t,e,i){var r,c;const n=t.length>e.length?t:e,s=t.length>e.length?e:t,f=s[s.length-1],h=(r=f==null?void 0:f.scale)!=null?r:i,d=(c=f==null?void 0:f.effects)!=null?c:[];for(let l=s.length;l<n.length;l++)s.push({scale:h,effects:[...d]});for(let l=0;l<n.length;l++)s[l].scale=s[l].scale===_?i:s[l].scale,n[l].scale=n[l].scale===_?i:n[l].scale,b(s[l].effects,n[l].effects)}function w(t,e,i){return t+(e-t)*i}function F(t){const e=t[0];return!!e&&"type"in e}export{k as u};
