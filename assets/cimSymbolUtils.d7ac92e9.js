import{I as h}from"./cimAnalyzer.644bcc6c.js";import{E as m}from"./Utils.56a5b8e8.js";import{L as b}from"./MaterialKey.d5a4d0f6.js";import{an as u,dt as x,T as o,du as S,dv as d,dw as y,dx as w,dy as z,dz as N,dA as V,dB as $,dC as g}from"./index.988b09cd.js";const j={marker:m.MARKER,fill:m.FILL,line:m.LINE,text:m.TEXT};class K{constructor(a,t,n,l){const r={minScale:t==null?void 0:t.minScale,maxScale:t==null?void 0:t.maxScale},i=T(r);this.layers=a,this.data=t,this.hash=this._createHash()+i,this.rendererKey=n;const c={isOutline:!1,isOutlinedFill:!1,placement:null,stride:{fill:"default"},vvFlags:n};for(const s of a){const p=j[s.type];s.materialKey=b(p,c),s.maxVVSize=l,s.scaleInfo=r,s.templateHash+=i}}get type(){return"expanded-cim"}_createHash(){let a="";for(const t of this.layers)a+=t.templateHash;return a}}function T(e){return e.minScale||e.maxScale?e.minScale+"-"+e.maxScale:""}async function H(e,a,t){if(!e.name)return Promise.reject(new u("style-symbol-reference-name-missing","Missing name in style symbol reference"));if(e.styleName&&e.styleName==="Esri2DPointSymbolsStyle")return v(e,t);try{return E(await x(e,a,t),e.name,a,t)}catch(n){return o(n),null}}async function v(e,a){const t=S.replace(/\{SymbolName\}/gi,e.name);try{const n=await d(t,a);return y(n.data)}catch(n){return o(n),null}}async function E(e,a,t,n){const l=e.data,r={portal:t&&t.portal||w.getDefault(),url:z(e.baseUrl),origin:"portal-item"},i=l.items.find(s=>s.name===a);if(!i)throw new u("symbolstyleutils:symbol-name-not-found",`The symbol name '${a}' could not be found`,{symbolName:a});let c=N(V(i,"cimRef"),r);$()&&(c=g(c));try{const s=await d(c,n);return y(s.data)}catch(s){return o(s),null}}const f=async(e,a,t)=>new K(await h(e.data,a,t),e.data,e.rendererKey,e.maxVVSize),F=async(e,a,t,n)=>{if(!e)return null;if(e.type==="cim")return f(e,a,t);if(e.type==="web-style"){const l={type:"cim",data:await H(e,null,n),rendererKey:e.rendererKey,maxVVSize:e.maxVVSize};return f(l,a,t)}return e};function M(e){if(!e)return null;const{type:a,cim:t,url:n,materialHash:l}=e,r={cim:t,type:a,mosaicHash:l,url:n,size:null,dashTemplate:null,path:null,text:null,fontName:null};switch(a){case"marker":r.size=e.size,r.path=e.path;break;case"line":r.dashTemplate=e.dashTemplate;break;case"text":r.text=e.text,r.fontName=e.fontName}return r}export{M as i,F as l};
