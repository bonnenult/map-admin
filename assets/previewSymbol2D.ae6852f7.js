var V=Object.defineProperty,A=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var q=(a,e,s)=>e in a?V(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s,L=(a,e)=>{for(var s in e||(e={}))B.call(e,s)&&q(a,s,e[s]);if(S)for(var s of S(e))G.call(e,s)&&q(a,s,e[s]);return a},z=(a,e)=>A(a,R(e));import{c$ as g,rE as I,rF as J,b0 as K,c3 as N,rw as O,eq as Q}from"./vendor.70daa49e.js";import{t as E,h as P}from"./previewUtils.ef718dc2.js";import{l as W}from"./renderUtils.c2f0d764.js";import"./colorUtils.92e1b957.js";const U="picture-fill",X="picture-marker",Y="simple-fill",_="simple-line",b="simple-marker",$="text",ee="Aa",Z=22,k=120,D=80,ae=40,te=document.createElement("canvas");function le(a,e){const s=te.getContext("2d"),d=[];return e&&(e.weight&&d.push(e.weight),e.size&&d.push(e.size+"px"),e.family&&d.push(e.family)),s.font=d.join(" "),s.measureText(a).width}const ne=7.2/2.54,se=72/2.54;function oe(a){if(a.length===0)return 0;if(a.length>2){const e=Q(1),s=parseFloat(a);switch(a.slice(-2)){case"px":return s;case"pt":return s*e;case"in":return 72*s*e;case"pc":return 12*s*e;case"mm":return s*ne*e;case"cm":return s*se*e}}return parseFloat(a)}function he(a,e){var s,d;const m=(e==null?void 0:e.size)!=null?g(e.size):null,v=(e==null?void 0:e.maxSize)!=null?g(e.maxSize):null,H=(e==null?void 0:e.opacity)!=null?e.opacity:null,y=(e==null?void 0:e.rotation)!=null?e.rotation:"angle"in a?a.angle:null,f=I(a);let h=J(a);if(f&&!h){const n="type"in f?null:new K(f);(n?n.toHex():null)==="#ffffff"&&(h={color:"#bdc3c7",width:.75})}const c={shape:null,fill:null,stroke:h,offset:[0,0]};(s=h)!=null&&s.width&&(h.width=Math.min(h.width,D));const r=((d=h)==null?void 0:d.width)||0;let p=m!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale)),t=0,l=0,w=!1;switch(a.type){case b:{const n=a.style,i=Math.min(m!=null?m:g(a.size),v||k);switch(t=i,l=i,n){case"circle":c.shape={type:"circle",cx:0,cy:0,r:.5*i},p||(t+=r,l+=r);break;case"cross":c.shape={type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[t,.5*l]},{command:"M",values:[.5*t,0]},{command:"L",values:[.5*t,l]}]};break;case"diamond":c.shape={type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[.5*t,0]},{command:"L",values:[t,.5*l]},{command:"L",values:[.5*t,l]},{command:"Z",values:[]}]},p||(t+=r,l+=r);break;case"square":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[t,l]},{command:"L",values:[0,l]},{command:"Z",values:[]}]},p||(t+=r,l+=r),y&&(w=!0);break;case"triangle":c.shape={type:"path",path:[{command:"M",values:[.5*t,0]},{command:"L",values:[t,l]},{command:"L",values:[0,l]},{command:"Z",values:[]}]},p||(t+=r,l+=r),y&&(w=!0);break;case"x":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,l]},{command:"M",values:[t,0]},{command:"L",values:[0,l]}]},y&&(w=!0);break;case"path":c.shape={type:"path",path:a.path||""},p||(t+=r,l+=r),y&&(w=!0),p=!0}break}case _:{const n=Math.min(m!=null?m:r,v||D),i=n>Z?2*n:ae;h.width=n,t=i,l=n,c.shape={type:"path",path:[{command:"M",values:[0,l]},{command:"L",values:[t,l]}]};break}case U:case Y:t=Math.min(m!=null?m:Z,v||k)+r,l=t,p=!0,c.shape=typeof(e==null?void 0:e.symbolConfig)=="object"&&e!=null&&e.symbolConfig.isSquareFill?E.squareFill[0]:E.fill[0];break;case X:{let n=g(a.width),i=g(a.height);const o=m!=null?m:Math.max(n,i),u=n/i;n=u<=1?Math.ceil(o*u):o,i=u<=1?o:Math.ceil(o/u),t=Math.min(n,v||k),l=Math.min(i,v||k),c.shape={type:"image",x:-Math.round(t/2),y:-Math.round(l/2),width:t,height:l,src:a.url||""},y&&(w=!0);break}case $:{const n=a,i=n.text||ee,o=n.font,u=Math.min(m!=null?m:g(o.size),v||k),T=le(i,{weight:o.weight,size:u,family:o.family}),C=/[\uE600-\uE6FF]/.test(i);t=C?u:T,l=u;let F=.25*oe((o?u:0).toString());C&&(F+=5),c.shape={type:"text",text:i,x:0,y:F,align:"middle",decoration:o&&o.decoration,rotated:n.rotated,kerning:n.kerning},c.font=o&&{size:u,style:o.style,decoration:o.decoration,weight:o.weight,family:o.family};break}}if(!c.shape)return Promise.reject(new N("symbolPreview: renderPreviewHTML2D","symbol not supported."));const M=f,j=a.color;let x=null;return M&&M.type==="pattern"&&j&&a.type!==U?x=O(M.src,j.toCss(!0)).then(n=>(M.src=n,c.fill=M,c)):(c.fill=f,x=Promise.resolve(c)),x.then(n=>{const i=[[n]];if(typeof(e==null?void 0:e.symbolConfig)=="object"&&e!=null&&e.symbolConfig.applyColorModulation){const o=.6*t;i.unshift([z(L({},n),{offset:[-o,0],fill:P(f,-.3)})]),i.push([z(L({},n),{offset:[o,0],fill:P(f,.3)})]),t+=2*o}return W(i,[t,l],{node:e&&e.node,scale:p,opacity:H,rotation:y,useRotationSize:w,effectView:e==null?void 0:e.effectView})})}export{he as previewSymbol2D};
