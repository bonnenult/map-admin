import{ka as j,am as v,t as u,r as f,bZ as D,T as P,qO as H,op as L,oe as $,eD as k,e as _,d as w,i as x,p as G,u as y,bG as V,jm as d,jn as p,fU as O,a as S,$ as T,jU as q,qS as z,fx as b,b as m,qP as E}from"./index.fe92decb.js";import{h as A}from"./HoveredPoints.afaa673a.js";import{a as R,e as I,A as M}from"./GraphicState.2162e41d.js";import"./vendor.d9e807b5.js";import"./index.dbbecfd7.js";/* empty css              */import"./qrcode.0911187d.js";/* empty css                 */import"./colorUtils.92e1b957.js";class U{constructor(e){this._params=e,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null}destroy(){this.remove()}remove(){this._highlightTask=j(this._highlightTask),this._highlightHandle=v(this._highlightHandle),this._visualElementHandle=v(this._visualElementHandle)}showHighlight(e){if(this.remove(),u(e)||!g(e))return;const i=e.layer;this._highlightTask=D(async t=>{const n=await this._params.view.whenLayerView(i);P(t),H(n)&&(this._highlightHandle=n.highlight(e))})}showReshaping(e){if(this.remove(),u(e))return;const i=this._params.view,t=new R({view:i,geometry:g(e)?e.geometry:null,attached:!1,elevationInfo:L(e),renderOccluded:8}),n=new I({graphic:e}),s=[n.watch("isDraped",h=>{t.isDraped=h}),n.on("changed",()=>{t.geometry=g(e)?e.geometry:null}),i.trackGraphicState(n),i.maskOccludee(e),$(t)];M.visualElements.lineGraphics.outline.apply(t),t.attached=!0,this._visualElementHandle=k(s)}}function g(a){return f(a.geometry)&&a.geometry.type==="polyline"}const C=100;let c=class extends G{constructor(a){super(a),this._chartData=null,this._visualElements=[],this._handles=new y}initialize(){const a=V(e=>{this._update(e)},C);this._handles.add([d(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),a,p),a])}destroy(){this._handles.destroy(),this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(a){this._chartData=a}_update(a){const{chartData:e}=a;if(u(e))return this.remove();if(!e.refined)return;const i=this._visualElements,t=e.lines.filter(o=>o.viewVisualizationEnabled),n=t.length;for(;i.length>n;)i.pop().destroy();const s=z;for(;i.length<n;){const o=new R({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:s.width-s.outlineSize,width:s.width,falloff:s.falloff,color:s.outlineColor,renderOccluded:s.renderOccluded});i.push(o)}const h=a.spatialReference;for(let o=0;o<n;++o){const r=i[o],l=t[n-1-o];r.geometry=this._createLineGeometry(l,h),r.innerColor=O(S.toUnitRGBA(l.color))}}_createLineGeometry(a,e){const i=T(a.samples,[]),t=i.length-1,n=[];let s=[];for(let h=0;h<=t;h++){const{x:o,y:r,z:l}=i[h];f(l)&&s.push([o,r,l]),(h===t||u(l))&&s.length&&(n.push(s),s=[])}return new q({paths:n,hasZ:!0,spatialReference:e})}_destroyVisualElements(){this._visualElements.forEach(a=>a.destroy()),this._visualElements.length=0}};_([w()],c.prototype,"view",void 0),_([w()],c.prototype,"_chartData",void 0),c=_([x("esri.widgets.ElevationProfile.support.ProfileLines3D")],c);class Y{constructor(e,i){this._handles=new y,this._inputRepresentation=new U({view:e}),this._hoveredPoints=new A({view:e}),this._profileLines=new c({view:e}),this._handles.add([d(()=>i.viewModel.hoveredPoints,t=>this._hoveredPoints.update(t),p),d(()=>{const{state:t,editable:n,highlightEnabled:s,viewModel:h}=i,o=h.input;return b(o,r=>{r.commitProperty("geometry"),r.commitProperty("layer")}),{input:o,state:t,editable:n,highlightEnabled:s}},t=>this._updateInputRepresentation(t),p),d(()=>i.viewModel.chartData,t=>this._profileLines.update(t),p),d(()=>b(i.viewModel.input,t=>t.geometry),()=>{this._profileLines.remove()},p)])}destroy(){this._handles=m(this._handles),this._inputRepresentation=m(this._inputRepresentation),this._hoveredPoints=m(this._hoveredPoints),this._profileLines=m(this._profileLines)}_updateInputRepresentation({input:e,state:i,editable:t,highlightEnabled:n}){const s=this._inputRepresentation;if(!n)return s.remove();i===E.Selected?s.showHighlight(e):i!==E.Created||t?s.remove():s.showReshaping(e)}}export{Y as ElevationProfileView3D};
