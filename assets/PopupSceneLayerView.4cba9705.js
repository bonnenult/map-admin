import{aX as f,aZ as P,c4 as u,b0 as l,gf as F,gg as w}from"./vendor.c8f3cc8c.js";import{d as h,t as m}from"./popupUtils.37c6f82e.js";const b=y=>{let r=class extends y{_validateFetchPopupFeatures(p){const{layer:e}=this,{popupEnabled:s}=e;return s?h(e,p)?void 0:new u("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:e}):new u("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:e})}async prepareFetchPopupFeatures(p){}async fetchPopupFeatures(p,e){const s=this._validateFetchPopupFeatures(e);if(s)return Promise.reject(s);const c=l(e)?e.clientGraphics:null;if(!c||c.length===0)return Promise.resolve([]);const d=this.layer.type==="scene"&&l(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,o=F(this.layer.fieldsIndex,await m(d,h(this.layer,e)));await this.prepareFetchPopupFeatures(o);const n=new Set,i=[],a=[];for(const t of c)w(o,t,n)?a.push(t):i.push(t);return a.length===0?Promise.resolve(i):this.whenGraphicAttributes(a,[...n]).catch(()=>a).then(t=>i.concat(t))}};return r=f([P("esri.views.3d.layers.support.PopupSceneLayerView")],r),r};export{b as c};
