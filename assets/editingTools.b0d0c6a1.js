var Ma=Object.defineProperty,ba=Object.defineProperties;var xa=Object.getOwnPropertyDescriptors;var ni=Object.getOwnPropertySymbols;var wa=Object.prototype.hasOwnProperty,Sa=Object.prototype.propertyIsEnumerable;var ri=(t,e,i)=>e in t?Ma(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,O=(t,e)=>{for(var i in e||(e={}))wa.call(e,i)&&ri(t,i,e[i]);if(ni)for(var i of ni(e))Sa.call(e,i)&&ri(t,i,e[i]);return t},$=(t,e)=>ba(t,xa(e));import{o0 as Ea,o1 as Oa,ji as zt,kb as oi,u as U,a5 as w,bN as I,dG as Tt,k3 as li,o2 as pt,r as p,ej as P,aI as S,a2 as le,gg as A,i2 as Ct,lu as ct,jj as he,g7 as xe,t as _,o3 as Ga,$ as Qe,o4 as kt,o5 as Da,hZ as $a,o6 as Ra,o7 as Aa,o8 as Pa,o9 as Ve,iO as Ke,ay as ie,jC as Ht,jB as Lt,jL as Je,bj as pe,bR as we,bM as ze,hu as hi,oa as Ia,bD as dt,ob as Va,eq as za,oc as Ta,ax as ut,fm as Ca,g8 as Ft,g4 as gt,aw as N,jR as b,od as ka,oe as B,a as ce,of as V,og as et,jQ as de,oh as Ha,oi as La,oj as pi,fd as Fa,eD as k,q as Se,nQ as Ba,ok as ja,ol as Ua,a_ as Te,b as z,om as Za,e as m,d as v,i as ue,on as Z,oo as ci,op as T,iW as mt,az as ge,a6 as Na,a0 as Ya,oq as Xa,or as di,iL as Wa,os as qa,ot as Qa,J as me,ou as Y,ov as tt,ow as Bt,ox as Ka,oy as Ce,oz as ui,ks as j,i4 as ke,oA as Ja,fF as vt,ln as yt,kr as _t,k2 as jt,eI as ft,oB as gi,oC as es,oD as mi,oE as ae,k6 as ts,ge as Mt,iP as ve,i5 as is,oF as as,k4 as vi,V as ss,oG as ns,oH as He,oI as rs,bF as yi,nZ as bt,n as os,oJ as xt,oK as ls,fp as wt,oL as Ee,oM as Ut,oN as hs,oO as ps,oP as St,i_ as Et,oQ as cs,oR as ds,oS as us,oT as it,oU as _i,oV as fi,hY as Zt,gf as gs,jD as Mi,im as Nt,oW as at,am as Oe,oX as bi,ls as ms,fV as Le,oY as vs,oZ as ys,jU as _s,o_ as xi,o$ as fs,p0 as Ms,p1 as bs,bs as xs,k8 as wi,p2 as Yt,p3 as Si,p4 as ws,jY as st,gc as Ss,p5 as Ei,p6 as Oi,ke as Gi,jm as Di,kd as $i,aA as Es,p7 as Ri,p8 as Os,p9 as Gs,pa as Ds,pb as $s,pc as Rs,pd as Ai,pe as Pi,pf as Ii,km as Fe,pg as Be,k1 as Vi,ph as As,pi as Ps,pj as Is,pk as Vs,pl as zs,pm as Ts,pn as Cs,po as ks,pp as Hs,dY as zi,pq as ye,pr as Ti,ps as Ot,pt as Ci,bo as Ls,pu as Fs,pv as Bs,pw as js,kt as Us,px as Zs,py as Ns,pz as Ys}from"./index.a1c5dd56.js";import{o as Xs,A as d,e as Ge,a as De,s as Xt}from"./GraphicState.a3dc9d1f.js";import{y as Ws}from"./RightAngleQuadVisualElement.e4fcdbca.js";import{O as qs,x as Qs}from"./DrawGraphicTool.04b507d6.js";import{q as Ks}from"./colorUtils.92e1b957.js";import{l as Js,v as en}from"./axisAngleDegrees.2f2e5543.js";import"./vendor.c6be4c00.js";import"./index.a0863940.js";/* empty css              */import"./qrcode.0911187d.js";/* empty css                 */class Wt extends zt{constructor(e){super(e),this._ray=oi(),this._externalResources=null,this._handles=new U,this._isWorldDown=!1,this._start=w(),this._end=I(1,0,0),this._width=1,this._color=Tt(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=Tt(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=0,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=4,this._fadedExtensions=Li,this.applyProps(e)}createExternalResources(){const e=new li(this.materialParameters);this._handles.add(this.view.state.watch("camera",()=>{this.updateGeometry()}));const i=new pt({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:i}}destroyExternalResources(){p(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){p(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const i=[w(),w()],a=this.extensionType===3;a&&i.push(w(),w());const s=a?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,n=P.createPolylineGeometry(i,null,s);e.addGeometry(n,S(this._externalResources).material),this.updateVertices(e)}updateVisibility(e){super.updateVisibility(e),p(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,le(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),A(this._end,e,this._end),Ct(this._start,this._end,this._ray),this.updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,ct(this._start,e)||(le(this._start,e),Ct(this._start,this._end,this._ray),this.updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,ct(this._end,e)||(le(this._end,e),Ct(this._start,this._end,this._ray),this.updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){he(e,this._color)||(xe(this._color,e),this.updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this.updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){he(e,this._innerColor)||(xe(this._innerColor,e),this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const i=p(e)!==p(this._stipplePattern);this._stipplePattern=e,i?this.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(_(e)||_(this._stippleOffColor)||!he(e,this._stippleOffColor))&&(this._stippleOffColor=p(e)?Ga(e):null,this.updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&p(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,p(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,p(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,p(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=Qe(e,Li),this.recreateGeometry()}updateMaterial(){_(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}updateGeometry(){p(this.object)&&this.updateVertices(this.object)}updateVertices(e){const i=this._extensionType===3?this.updateLineSegmentFinite(ki):this.updateLineSegmentInfinite(this._extensionType,ki);this.updateVertexAttributes(e,i),p(this._externalResources)&&(this._externalResources.laserline.intersectsLine=i)}updateLineSegmentFinite(e){return kt(this._start,this._end,e)}updateLineSegmentInfinite(e,i){const a=this.view.state.camera;switch(Da(this._ray,_e),e){case 0:_e.c0=-Number.MAX_VALUE;break;case 1:case 2:{const r=this._ray.origin,o=Qe(this.view.elevationProvider.getElevation(r[0],r[1],r[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),l=this.view.renderCoordsHelper.getAltitude(r);this._isWorldDown&&l<o&&$a(_e.ray.direction,_e.ray.direction),this._extensionType===2&&o!=null&&(_e.c1=Math.abs(l-o));break}}if(!Ra(a.frustum,_e))return kt(this._start,this._end,i);const s=Aa(_e,$e),n=Pa(_e,tn);return kt(s,n,i)}updateVertexAttributes(e,i){const a=e.geometries[0].getMutableAttribute("position").data;if(this.extensionType===3){const s=Ve(i,-this.fadedExtensions.start,$e);a[0]=s[0],a[1]=s[1],a[2]=s[2];const n=Ve(i,0,$e);a[3]=n[0],a[4]=n[1],a[5]=n[2];const r=Ve(i,1,$e);a[6]=r[0],a[7]=r[1],a[8]=r[2];const o=Ve(i,1+this.fadedExtensions.end,$e);a[9]=o[0],a[10]=o[1],a[11]=o[2]}else{const s=Ve(i,0,$e);a[0]=s[0],a[1]=s[1],a[2]=s[2];const n=Ve(i,1,$e);a[3]=n[0],a[4]=n[1],a[5]=n[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}const _e=Ea(),$e=w(),tn=w(),ki=Oa(),Hi=1/3,Li={start:Hi,end:Hi};class an extends zt{constructor(e){super(e),this._handles=new U,this._location=w(),this._direction=I(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=Tt(1,0,1,1),this._renderOccluded=4,this.applyProps(e)}get location(){return this._location}set location(e){ct(this._location,e)||(le(this._location,e),this.updateGeometry())}get direction(){return this._direction}set direction(e){ct(this._direction,e)||(le(this._direction,e),this.updateGeometry())}setDirectionFromPoints(e,i){Ke(this._direction,A(this._direction,i,e)),this.updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this.updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this.updateGeometry())}get color(){return this._color}set color(e){he(e,this._color)||(xe(this._color,e),this.updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}createExternalResources(){const e=new li(this.materialParameters);this._handles.add(this.view.state.watch("camera",()=>{this.updateGeometry()})),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const i=P.createPolylineGeometry([w(),w()]),a=P.createPolylineGeometry([w(),w()]),s=S(this._externalResources).material;e.addGeometry(i,s),e.addGeometry(a,s),this.updateVertices(e)}forEachExternalMaterial(e){p(this._externalResources)&&e(this._externalResources.material)}updateMaterial(){_(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}updateGeometry(){const e=this.object;_(e)||this.updateVertices(e)}updateVertices(e){const i=this.view.state.camera;i.projectToScreen(this.location,Gt),ie(J,this.location,this.direction),i.projectToScreen(J,je),Ht(je,Lt(je,je,Gt)),this.updateVertexAttributes(i,e,0,Gt,je,1),this.updateVertexAttributes(i,e,1,Gt,je,-1)}updateVertexAttributes(e,i,a,s,n,r){const o=i.geometryRecords[a],l=o.geometry.getMutableAttribute("position").data,h=Je(Fi,pe(Fi,n[1]*r,n[0]*-r),this.offset+this.width/2),c=we(Dt,we(Dt,we(Dt,s,Je(Dt,n,this.length/2)),h),h),g=we(Bi,c,Je(Bi,n,-this.length));e.unprojectFromScreen(c,J),l[0]=J[0],l[1]=J[1],l[2]=J[2],e.unprojectFromScreen(g,J),l[3]=J[0],l[4]=J[1],l[5]=J[2],i.geometryVertexAttrsUpdated(o)}}const J=w(),Gt=ze(),je=ze(),Fi=ze(),Dt=ze(),Bi=ze();class qt{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=hi(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=hi(1,1,1,1),this._elevationInfo=null,this.resources=new Xs({view:e.view,createResources:a=>this.createResources(a),recreateGeometry:(a,s)=>(a.geometry=this.recreateGeometry(s,a.material),p(a.geometry)?[a.geometry]:[])});let i=!0;for(const a in e)a in this?a==="attached"?i=e[a]:this[a]=e[a]:console.error("Cannot set unknown property",a);this.attached=i}destroy(){this.resources.destroy()}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e}get attached(){return this.resources.attached}set attached(e){this.resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const i=this.preferredTextureSize;this._size=e,i<this.preferredTextureSize?p(this.resources)&&this.resources.recreate():this.updateSizeAttribute()}}get color(){return this._color}set color(e){he(e,this._color)||(xe(this._color,e),this.updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this.updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,p(this.resources)&&this.resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){he(e,this._outlineColor)||(xe(this._outlineColor,e),this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()}updateMaterial(){const e=this.resources.resources;_(e)||e.material.setParameters(this.materialParameters(e.texture.id))}updateSizeAttribute(){const e=this.resources.resources,i=this.resources.object;if(_(e)||_(i))return;const a=e.geometry;if(_(a))return;const s=a.getMutableAttribute("size").data,n=this.geometrySize;s[0]=n,s[1]=n,i.geometryVertexAttrsUpdated(i.geometryRecords[0])}materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:sn,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get geometrySize(){return this._size/Ue}recreateGeometry(e,i){const a=this.createRenderGeometry();return p(a)&&e.addGeometry(a,i),a}createResources(e){const i=this.createTexture(),a=new Ia(this.materialParameters(i.id)),s=this.recreateGeometry(e,a);return{material:a,texture:i,geometry:s,forEach(n){n(i),n(a),p(this.geometry)&&n(this.geometry)}}}get preferredTextureSize(){return dt(Va(2*this.geometrySize),16,128)}createTexture(){const e=this.preferredTextureSize;return new za(Ta(this._primitive,e,e*Ue),{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,components:4,noUnpackFlip:!0})}calculateMapBounds(e){if(_(this.resources.resources)||_(this.resources.resources.geometry))return!1;const i=this.resources.resources.geometry.vertexAttributes.get("position");return ut(i.data,this.view.renderCoordsHelper.spatialReference,ji,this.view.spatialReference),Ca(e,ji),!0}createRenderGeometry(){const e=this.geometry;if(_(e))return null;const{renderCoordsHelper:i,elevationProvider:a}=this.view,s=Ft(e,a,gt.fromElevationInfo(this.elevationInfo),i),n=N(b.get(),e.x,e.y,s),r=b.get();ut(n,e.spatialReference,r,i.spatialReference);const o=this.geometrySize;return P.createPointGeometry(null,r,null,[o,o],[0,0,0,1])}}const Ue=.5,sn=[Ue/2,Ue/2,1-Ue/2,1-Ue/2],ji=w();class nt extends ka{visualizeIntersectionPoint(e,i){const{coordinateHelper:a,elevationInfo:s,view:n}=i;return B(new qt({view:n,primitive:"circle",geometry:a.vectorToPoint(e.intersectionPoint),elevationInfo:s,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:ce.toUnitRGBA(V.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,i){const{coordinateHelper:a,elevationInfo:s,view:n}=i;return B(new qt({view:n,primitive:"circle",geometry:a.vectorToPoint(e.point),elevationInfo:s,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:ce.toUnitRGBA(V.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,i){const{coordinateHelper:a,elevationInfo:s,view:n}=i;return B(this.createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,a,s,n,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,i){const{coordinateHelper:a,elevationInfo:s,view:n}=i,r=et(e.lineStart,a,s,i.view),o=et(e.lineEnd,a,s,i.view),l=de(o,r,o,.5),h=new an({view:n,attached:!1,offset:V.parallelLineHintOffset,length:V.parallelLineHintLength,width:V.parallelLineHintWidth,color:ce.toUnitRGBA(V.orange),location:l,renderOccluded:16});return h.setDirectionFromPoints(r,l),h.attached=!0,B(h)}visualizeRightAngleQuad(e,i){const{coordinateHelper:a,elevationInfo:s,view:n}=i;return B(new Ws({view:n,attached:!0,color:ce.toUnitRGBA(V.orange),renderOccluded:2,outlineRenderOccluded:16,outlineColor:ce.toUnitRGBA(V.orange),outlineSize:V.rightAngleHintOutlineSize,size:V.rightAngleHintSize,geometry:{previous:et(e.previousVertex,a,s,n),center:et(e.centerVertex,a,s,n),next:et(e.nextVertex,a,s,n)}}))}createLineSegmentHintFromMap(e,i,a,s,n,r,o=!0,l=!0){const h=w(),c=w();return Ha(i,a,s,n,r,h,c),this.createLineSegmentHint(e,r,h,c,o,l)}createLineSegmentHint(e,i,a,s,n=!0,r=!0){const o=new Wt({view:i,extensionType:3,start:a,end:s,color:ce.toUnitRGBA(V.orange),renderOccluded:16});switch(e){case 0:o.width=V.lineHintWidthTarget,o.fadedExtensions={start:0,end:V.lineHintFadedExtensions};break;case 2:o.width=V.lineHintWidthReference,o.fadedExtensions={start:0,end:0};break;case 1:o.width=V.lineHintWidthReference,o.fadedExtensions={start:n?V.lineHintFadedExtensions:0,end:r?V.lineHintFadedExtensions:0}}return o.attached=!0,o}}class Ui extends zt{constructor(e){super(e),this.view=null,this._renderOccluded=4,this._vertices=null,this._spatialReference=null,this._color=d.colorToVec4(d.reshapeManipulators.vertex.color),this._size=d.reshapeManipulators.vertex.size,this._outlineColor=d.colorToVec4(d.reshapeManipulators.vertex.outlineColor),this._outlineSize=d.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){he(e,this._color)||(xe(this._color,e),this.updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){he(e,this._outlineColor)||(xe(this._outlineColor,e),this.updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}get vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}updateMaterial(){this.attached&&this.vertexMaterial.setParameters(this.vertexMaterialParameters)}updateOutlineMaterial(){this.attached&&this.vertexOutlineMaterial.setParameters(this.vertexOutlineMaterialParameters)}createRenderGeometries(){const e=this.vertices;if(_(e)||e.length===0)return[];const i=.5,a=.5,s=La(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,gt.fromElevationInfo(this.elevationInfo)),n=[],r=s.numVertices,o=s.position;for(let l=0;l<r;++l){const h=N(nn,o[3*l+0],o[3*l+1],o[3*l+2]),c=Zi(i,h),g=Zi(a,h);n.push({vertexGeometry:c,vertexOutlineGeometry:g})}return n}createGeometries(e){const i=this.createRenderGeometries();for(const{vertexGeometry:a,vertexOutlineGeometry:s}of i)e.addGeometry(a,this.vertexMaterial),e.addGeometry(s,this.vertexOutlineMaterial)}createExternalResources(){this.vertexMaterial=new pi($(O({},this.vertexMaterialParameters),{writeDepth:!0,cullFace:2,screenSizeEnabled:!0})),this.vertexOutlineMaterial=new pi($(O({},this.vertexOutlineMaterialParameters),{transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1}))}destroyExternalResources(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}const nn=w();function Zi(t,e){return P.createSphereGeometry(t,16,16,{offset:e})}let Ze=class extends qs{constructor(t){super(t),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:t,offset:e}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new Fa({mode:t,offset:e})}normalizeCtorArgs(t){if(!t.elevationInfo){var e;const i=(e=t.hasZ)==null||e;return $(O({},t),{elevationInfo:{mode:i?"absolute-height":"on-the-ground",offset:0}})}return t}initializeGraphic(t){return this._createGraphicState=new Ge({graphic:t}),k([this.view.maskOccludee(t),this.view.trackGraphicState(this._createGraphicState),Se(this._createGraphicState,"isDraped",e=>{p(this._outlineVisualElement)&&(this._outlineVisualElement.isDraped=e)})])}makeDrawOperation(){return new Ba({view:this.view,manipulators:this.manipulators,geometryType:Qs(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new ja(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new Ua(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new nt})}onActiveVertexChanged(t){return p(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[t],null):(this._activeVertexVisualElement=new Ui({view:this.view,spatialReference:this.view.spatialReference,vertices:[t],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:d.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=d.colorToVec4(d.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,Te(()=>{this._activeVertexVisualElement=z(this._activeVertexVisualElement)}))}onOutlineChanged(t){if(p(this._outlineVisualElement))return this._outlineVisualElement.geometry=t,null;const e=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new De({view:this.view,geometry:t,elevationInfo:e,isDraped:p(this._createGraphicState)?this._createGraphicState.isDraped:Za(this.hasZ,e)==="on-the-ground",attached:!1}),d.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),d.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,Te(()=>{this._outlineVisualElement=z(this._outlineVisualElement)})}onRegularVerticesChanged(t){return p(this._verticesVisualElement)?(this._verticesVisualElement.vertices=t,null):(this._verticesVisualElement=new Ui({view:this.view,spatialReference:this.view.spatialReference,vertices:t,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:d.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,Te(()=>{this._verticesVisualElement=z(this._verticesVisualElement)}))}};m([v({constructOnly:!0})],Ze.prototype,"elevationInfo",void 0),m([v({constructOnly:!0})],Ze.prototype,"geometryType",void 0),m([v({readOnly:!0})],Ze.prototype,"type",void 0),m([v({constructOnly:!0,nonNullable:!0})],Ze.prototype,"view",void 0),Ze=m([ue("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Ze);class Ni{constructor(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((i,a)=>{if(a===0&&(this.zManipulator=i),i instanceof Z&&(i.selected&&(this.numSelected===0&&(this.firstSelected=i),this.numSelected++),_(this.firstGrabbedXY)&&i.grabbing&&a===1&&(this.firstGrabbedXY=i)),i.grabbing)switch(this.grabbingState|=1,a){case 0:this.grabbingState|=2;break;case 1:this.grabbingState|=4}})}}function rn(t){const{view:e,graphic:i}=t,a=new Ge({graphic:i}),s=on(t,a),n=[s,ln(t,s.visualElement,a),e.maskOccludee(i),e.trackGraphicState(a)];return{visualElement:s.visualElement,remove:()=>k(n).remove()}}function on(t,e){const{view:i,graphic:a}=t,s=new De({view:i,geometry:Qt(a)?a.geometry:null,elevationInfo:T(a),attached:!1});d.visualElements.lineGraphics.shadowStyle.apply(s);const n=()=>{s.attached=e.displaying};d.visualElements.lineGraphics.outline.apply(s);const r=[e.watch("displaying",n),e.watch("isDraped",o=>s.isDraped=o),e.on("changed",()=>s.geometry=Qt(a)?a.geometry:null),B(s)];return n(),{visualElement:s,remove:()=>k(r).remove()}}function ln(t,e,i){const{graphic:a,view:s}=t,n=[],r=T(a),o=r.mode==="on-the-ground"||!r.offset&&r.mode!=="absolute-height",l=new Ni,h=new Wt({view:s,extensionType:d.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});d.visualElements.pointGraphics.shadowStyle.apply(h);const c=mt(d.visualElements.heightPlaneAngleCutoff),g=new pt({view:s,attached:!1,angleCutoff:c});d.visualElements.heightPlane.apply(g);let u=1,y=1;const f=()=>{if(l.update(t),!i.displaying||o&&(i.isDraped||!Qt(a)||!a.geometry.hasZ))return e.laserlineEnabled=!1,h.attached=!1,void(g.attached=!1);e.laserlineEnabled=!0;{const M=4&l.grabbingState?d.visualElements.laserlineAlphaMultiplier:1;M!==u&&(u=M,d.visualElements.lineGraphics.shadowStyle.apply(e,M),d.visualElements.pointGraphics.shadowStyle.apply(h,M))}{const M=2&l.grabbingState?d.visualElements.laserlineAlphaMultiplier:1;M!==y&&(y=M,d.visualElements.heightPlane.apply(g,M))}hn(h,l),pn(t,e,g,l)};d.visualElements.zVerticalLine.apply(h),n.push(i.on("changed",f),i.watch("displaying",f),e.events.on("attachment-origin-changed",f),B(h),B(g));const E=[],G=()=>{k(E).remove(),E.length=0,t.forEachManipulator(M=>E.push(M.events.on("grab-changed",f))),t.forEachManipulator(M=>E.push(M.events.on("select-changed",f))),f()};return G(),n.push(t.onManipulatorsChanged(G),ci(()=>k(E))),k(n)}function hn(t,e){const i=e.numSelected===1?e.firstSelected:e.numSelected>1&&p(e.firstGrabbedXY)?e.firstGrabbedXY:null;p(i)?(t.setStartEndFromWorldDownAtLocation(i.renderLocation),t.attached=!0):t.attached=!1}function pn(t,e,i,a){if(a.numSelected>0){N(Re,0,0,0);let s=0;t.forEachManipulator((n,r)=>{r===1&&n.selected&&n instanceof Z&&(ie(Re,Re,n.renderLocation),s++)}),s>0?(i.heightManifoldTarget=ge(Re,Re,1/s),i.attached=!0):i.attached=!1}else{const s=e.attachmentOrigin;p(s)&&t.view.renderCoordsHelper.toRenderCoords(s,Re)?(i.heightManifoldTarget=Re,i.attached=!0):i.attached=!1}}function Qt(t){return p(t.geometry)&&(t.geometry.type==="polygon"||t.geometry.type==="polyline")}const Re=w();function cn(t){const{view:e,graphic:i}=t,a=new Ge({graphic:i}),s=[],n=un(t,a,s);return dn(t,a,s,n),s.push(e.trackGraphicState(a)),{visualElement:n,remove(){k(s).remove()}}}function dn(t,e,i,a){const{view:s,graphic:n}=t,r=new Wt({view:s,extensionType:d.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});d.visualElements.zVerticalLine.apply(r);const o=new pt({view:s,intersectsLineInfinite:!0,attached:!1});d.visualElements.pointGraphics.shadowStyle.apply(o);const l=mt(d.visualElements.heightPlaneAngleCutoff),h=new pt({view:s,attached:!1,angleCutoff:l});d.visualElements.heightPlane.apply(h);const c=T(t.graphic),g=gt.fromElevationInfo(c),u=c.mode==="on-the-ground"||!c.offset&&c.mode!=="absolute-height",y=new Ni;let f=1,E=1;const G=()=>{y.update(t);const M=Kt(n),D=u&&(e.isDraped||_(M)||!M.hasZ);let L=!0;if(!D&&p(M)){const R=Ft(M,s.elevationProvider,g,s.renderCoordsHelper);N(X,M.x,M.y,R),ut(X,M.spatialReference,X,s.renderCoordsHelper.spatialReference),r.setStartEndFromWorldDownAtLocation(X),o.intersectsWorldUpAtLocation=X}else L=!1;const Xe=2&y.grabbingState?d.visualElements.laserlineAlphaMultiplier:1;Xe!==f&&(f=Xe,d.visualElements.heightPlane.apply(h,Xe));const We=Ya(yn);!D&&e.displaying&&a.calculateMapBounds(We)&&ut(Xa(We,X),s.spatialReference,X,s.renderCoordsHelper.spatialReference)?(h.heightManifoldTarget=X,h.attached=!0):h.attached=!1;const te=4&y.grabbingState?d.visualElements.laserlineAlphaMultiplier:1;te!==E&&(E=te,d.visualElements.pointGraphics.shadowStyle.apply(o,te));const ht=L&&e.displaying&&!D;o.attached=ht,r.attached=ht};i.push(e.watch(["displaying","isDraped"],G),e.on("changed",G)),t.forEachManipulator(M=>{i.push(M.events.on("grab-changed",G))}),i.push(B(o)),i.push(B(r)),i.push(B(h)),G()}function un(t,e,i){const{view:a,graphic:s}=t,n=new qt({view:a,geometry:Kt(s),elevationInfo:T(s),attached:!1});return gn(t,n,e,i),i.push(B(n)),n}function Kt(t){const e=t.geometry;return _(e)?null:e.type==="point"?e:e.type==="mesh"?e.anchor.clone():null}function gn(t,e,i,a){const s=()=>e.attached=i.displaying;mn(t,e,i,a),d.visualElements.pointGraphics.outline.apply(e),a.push(Se(i,"displaying",s))}function mn(t,e,i,a){const{view:s,graphic:n}=t;let r=null;const o=h=>{p(r)&&(r.remove(),r=null),i.isDraped&&p(h)&&(r=vn(s,h,()=>{e.geometry=h}))},l=()=>{const h=Kt(n);o(h),e.geometry=h};a.push(i.on("changed",l),ci(()=>r)),l()}function vn(t,e,i){const a=t.elevationProvider.spatialReference;Wa(e,X,a);const s=X[0],n=X[1];return t.elevationProvider.on("elevation-change",r=>{di(r.extent,s,n)&&i()})}const X=w(),yn=Na();function $t(t){switch(S(t.graphic.geometry).type){case"point":case"mesh":return cn(t);case"polygon":case"polyline":return rn(t);default:return null}}const _n=[1,.5,0],Yi=128,ee=70,fn=80,Xi=.02,Mn=54,bn=100,Wi=Math.ceil(ee/3*2),Ae=160,Jt=.5,ei=24,Ne=9,xn=Ae+30,qi=Ae+53,wn=60,Sn=23,En=5*Math.PI/12,On=1*Math.PI/3,Qi=10,Ki=.2,Ji=30,ea=53,ta=.2,ia=.3,Gn=200,Dn=3,$n=1e6;class rt{constructor(){this._available=!0}set location(e){this.forEachManipulator3D(i=>i.location=e)}set elevationAlignedLocation(e){this.forEachManipulator3D(i=>i.elevationAlignedLocation=e)}set elevationInfo(e){this.forEachManipulator3D(i=>i.elevationInfo=e)}get renderLocation(){let e;return this.forEachManipulator3D(i=>{e||(e=i.renderLocation)}),e}get available(){return this._available}set available(e){this._available=e,this.forEachManipulator3D(i=>i.available=e)}get grabbing(){return this.someManipulator(e=>e.grabbing)}get dragging(){return this.someManipulator(e=>e.dragging)}hasManipulator(e){return this.someManipulator(i=>i===e)}someManipulator(e){let i=!1;return this.forEachManipulator(a=>{!i&&e(a)&&(i=!0)}),i}forEachManipulator3D(e){this.forEachManipulator((i,a)=>{i instanceof Z&&e(i,a)})}}function Rt(t,e,i,a){const s=t.graphic,n=(r,o)=>e({action:r,graphic:s,dxScreen:o.screenDeltaX,dyScreen:o.screenDeltaY});return i((r,o,l)=>{const h=o.next(c=>(c.action==="start"&&n("start",c),c)).next(qa(s,a)).next(c=>{switch(c.action){case"start":case"update":(c.translationX||c.translationY||c.translationZ)&&n("update",c);break;case"end":n("end",c)}return c});return l.next(Qa(s)).next(()=>{n("end",{screenDeltaX:0,screenDeltaY:0})}),h})}function aa(t){if(_(t)||t.type!=="polyline"&&t.type!=="polygon")return 0;const e=(t.type==="polyline"?t.paths:t.rings)[0];if(!e||e.length<2)return 0;const i=e[0],a=e[1];return Math.atan2(a[1]-i[1],a[0]-i[0])}class Rn extends rt{constructor(e){super(),this._handles=new U,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this.createMaterial(),this._transparentMaterial=this.createMaterial(.5),this._angle=0,this._scale=1,this._radius=ee,this._updateAfterDrag=!1,this.events=new me,this._tool=e.tool,this._view=e.view,e.radius!=null&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._handles=z(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(const{manipulator:i}of this._arrowManipulatorInfos)e(i,1)}createGraphicDragPipeline(e,i,a){const s=i.graphic,n=T(s),r=S(s.geometry).spatialReference;return Rt(i,a,o=>this.createDragPipeline((l,h,c,g,u)=>o(l,e(l,h,c,g,u),c),n,r,s),this._view.state.viewingMode)}createDragPipeline(e,i,a,s){return k(this._arrowManipulatorInfos.map(({manipulator:n},r)=>Y(n,(o,l,h,c,g)=>{const u=l.next(y=>$(O({},y),{manipulatorType:1})).next(tt(this._view,o.elevationAlignedLocation)).next(Bt(this._view,o.elevationAlignedLocation,i,a,s)).next(Ka(o.location,this.angle+(r+1)*Math.PI*.5)).next(Ce());e(o,u,h,c,g)})))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:i},a){const s=this._radius/ee,n=Mn*s,r=n*Math.sqrt(3)/2,o=P.createExtrudedTriangle(r,n/2,n/2,Xi);P.transformInPlace(o,ui(j.get(),N(b.get(),0,-r/3,0))),e.renderObjects=[{geometry:o,material:this._opaqueMaterial,stateMask:2},{geometry:o,material:this._transparentMaterial,stateMask:1}],e.radius=r/3*2*1.2;const l=ke(j.get());Ja(l,a*Math.PI/2);const h=ke(j.get());ui(h,N(b.get(),0,bn*s,0)),vt(i,l,h)}_createManipulators(){for(let e=0;e<4;e++){const i=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(i)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,i=ke(j.get());yt(i,i,e,I(0,0,1));const a=_t(j.get(),N(b.get(),this.displayScale,this.displayScale,this.displayScale)),s=ke(j.get());vt(s,a,i);for(const n of this._arrowManipulatorInfos){const r=vt(j.get(),s,n.transform);n.manipulator.modelTransform=r}}_createArrowManipulator(e){const i=new Z({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:I(0,0,1)}}),a={manipulator:i,transform:ft()};return this._updateArrowManipulator(a,e),this._handles.add(i.events.on("drag",s=>{this._updateAfterDrag&&s.action==="end"&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),a}createMaterial(e=1){const i=ce.toUnitRGBA(Xt.main);return i[3]*=e,new jt({color:i,transparent:e!==1,cullFace:2,renderOccluded:2})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map(({manipulator:e})=>e)}}}class An{constructor(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new gi,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&p(this.lastDragEvent)){const i=this.lastDragEvent.mapEnd,a=this.snap(this.lastDragEvent.screenEnd);if(p(a)){const s={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:e===!0?a:i,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(s)}}this._enabled=e}snap(e){const i=p(this.view)?this.view.toMap(e,{exclude:[]}):null;return p(i)&&p(this.view)&&(i.z=es(i,this.view,this.elevationInfo)),i}createDragEventPipelineStep(e,i){return this.view=e,this.elevationInfo=i,this.lastDragEvent=null,a=>{if(this.lastDragEvent=a.action!=="end"?O({},a):null,this._enabled){const s=this.snap(a.screenEnd);return p(s)?{action:a.action,mapStart:a.mapStart,mapEnd:s,screenStart:a.screenStart,screenEnd:a.screenEnd}:null}return{action:a.action,mapStart:a.mapStart,mapEnd:a.mapEnd,screenStart:a.screenStart,screenEnd:a.screenEnd}}}}class Pn extends rt{constructor(e){super(),this._handles=new U,this._snapToScene=new An,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=ee,this._view=e.view,this._tool=e.tool,e.snapToScene!=null&&(this.snapToScene=e.snapToScene),e.radius!=null&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,1)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,i,a){const s=i.graphic,n=T(s),r=S(s.geometry).spatialReference;return Rt(i,a,o=>this.createDragPipeline((l,h,c,g,u)=>o(l,e(l,h,c,g,u),c),n,r,s),this._view.state.viewingMode)}createDragPipeline(e,i,a,s){const n=this._view;return Y(this._manipulator,(r,o,l,h,c)=>{const g=o.next(tt(n,r.elevationAlignedLocation)).next(Bt(n,r.elevationAlignedLocation,i,a,s)).next(this._snapToScene.createDragEventPipelineStep(n,i),this._snapToScene.next).next(u=>$(O({},u),{manipulatorType:1})).next(Ce());e(r,g,l,h,c)})}_updateManipulatorTransform(){const e=_t(j.get(),N(b.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new Z({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:I(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=P.createCylinderGeometry(Xi,1,Yi,I(0,0,1),I(0,0,0)),i=_t(ft(),I(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:i,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:i,stateMask:1}],this._manipulator.radius=fn*(this._radius/ee)}_createMaterial(e=1){const i=ce.toUnitRGBA(Xt.main);return i[3]*=e,new jt({color:i,transparent:e!==1,cullFace:2,renderOccluded:2})}get test(){return{discManipulator:this._manipulator}}}class In extends rt{constructor(e){super(),this._handles=new U,this._radius=ee,this.events=new me,this._tool=e.tool,this._view=e.view,e.radius!=null&&(this._radius=e.radius),this.createManipulator(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()})}forEachManipulator(e){e(this._manipulator,0)}createGraphicDragPipeline(e,i,a){const s=S(i.graphic.geometry).spatialReference;return Rt(i,a,n=>this.createDragPipeline((r,o,l,h,c)=>n(r,e(r,o,l,h,c),l),s),this._view.state.viewingMode)}createDragPipeline(e,i){const a=this._view;return Y(this._manipulator,(s,n,r,o,l)=>{const h=n.next(c=>$(O({},c),{manipulatorType:0})).next(mi(a,s.renderLocation,i)).next(Ce());e(s,h,r,o,l)})}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}updateManipulator(){const e=this._radius/ee,i=d.zManipulator.height*e,a=d.zManipulator.coneHeight*e,s=d.zManipulator.coneWidth*e,n=d.zManipulator.width*e,r=[I(0,0,0),I(0,0,i)],o=P.createTubeGeometry(r,n/2,16,!1),l=P.createConeGeometry(a,s/2,16,!1),h=[I(0,0,0),I(0,0,i+a)],c=M=>{const D=ft();if(is(D,D,[0,0,i]),as(D,D,Math.PI/2),M){const L=1+2*M/s;vi(D,D,[L,L,L])}return D},g=c(0),u=(M,D)=>{const L=Ks(d.zManipulator.color,D);return[L.r/255,L.g/255,L.b/255,d.zManipulator.color.a*M]},y=ae(u(1,.25),1),f=ae(u(1,0),1),E=ae(u(.7,0),d.zManipulator.renderOccluded),G=ae(u(.85,0),d.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:l,transform:g,material:y,stateMask:1},{geometry:o,material:y,stateMask:1},{geometry:l,transform:g,material:f,stateMask:2},{geometry:o,material:f,stateMask:2},{geometry:l,transform:g,material:E,stateMask:1},{geometry:o,material:E,stateMask:1},{geometry:l,transform:g,material:G,stateMask:2},{geometry:o,material:G,stateMask:2}],this._manipulator.radius=n/2+2,this._manipulator.collisionType={type:"line",paths:[h]}}createManipulator(){const e=new Z({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=i=>{const a=this._view.state.camera,s=sa;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,s);const n=ts(a.eye,s),r=a.computeRenderPixelSizeAtDist(n),o=A(Ye,s,a.eye);Ke(o,o);const l=Vn;this._view.renderCoordsHelper.worldUpAtPosition(sa,l);const h=Math.abs(Mt(o,l)),c=ve(Ye,o,l),g=ve(Ye,c,l),u=dt(h,.01,1),y=1-Math.sqrt(1-u*u)/u/a.fullWidth,f=this._radius/ee,E=d.zManipulator.width*f;ge(g,Ke(g,g),(1/y-1)*n+r*E),i[12]-=Ye[0],i[13]-=Ye[1],i[14]-=Ye[2]},this._manipulator=e,this.updateManipulator()}get test(){return{manipulator:this._manipulator}}}const sa=w(),Ye=w(),Vn=w();class Pe extends rt{constructor(e){super(),this._handles=new U,this._angleDeferred=null,this._interactive=!0;const{tool:i,view:a,snapToScene:s,radius:n}=e;this._view=a,this.xyManipulation=new Pn({tool:i,view:a,snapToScene:s,radius:n}),this.xyAxisManipulation=new Rn({tool:i,view:a,radius:n}),this.zManipulation=new In({tool:i,view:a,radius:n}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this.autoHideXYAxis(),this.forEachManipulator(r=>{this._handles.add(r.events.on("grab-changed",()=>this.updateManipulatorInteractivity()))})}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,i,a){return k([this.xyManipulation.createGraphicDragPipeline((s,n,r,o,l)=>e(0,s,n,r,o,l),i,a),this.xyAxisManipulation.createGraphicDragPipeline((s,n,r,o,l)=>e(1,s,n,r,o,l),i,a),this.zManipulation.createGraphicDragPipeline((s,n,r,o,l)=>e(2,s,n,r,o,l),i,a)])}createDragPipeline(e,i,a,s){return k([this.xyManipulation.createDragPipeline((n,r,o,l,h)=>e(0,n,r,o,l,h),i,a,s),this.xyAxisManipulation.createDragPipeline((n,r,o,l,h)=>e(1,n,r,o,l,h),i,a,s),this.zManipulation.createDragPipeline((n,r,o,l,h)=>e(2,n,r,o,l,h),a)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}set angleDeferred(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator(i=>e(i,1)),this.xyAxisManipulation.forEachManipulator(i=>e(i,1)),this.zManipulation.forEachManipulator(i=>e(i,0))}get xyAxisVisible(){const e=this.xyManipulation.someManipulator(i=>i.focused)||this.xyAxisManipulation.someManipulator(i=>i.focused);return this._view.inputManager&&this._view.inputManager.latestPointerType==="touch"||e}autoHideXYAxis(){const e=this.xyAxisManipulation,i=this.xyManipulation;if(ss("esri-mobile"))return;const a=[];i.forEachManipulator(n=>a.push(n)),e.forEachManipulator(n=>a.push(n));const s=()=>{const n=[];this.xyAxisVisible?p(this._angleDeferred)&&(this.angle=this._angleDeferred()):e.forEachManipulator(r=>n.push(r.disableDisplay())),this._handles.remove(na),this._handles.add(n,na)};for(const n of a)this._handles.add(n.events.on("focus-changed",s));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",s)),s()}updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator(i=>{i.interactive=!e&&this._interactive||i.grabbing})}static radiusForSymbol(e){const i=p(e)&&e.type==="point-3d"&&e.symbolLayers;return!!i&&i.length>0&&i.some(a=>a.type==="icon")?Wi:ee}}const na="disable-xy-axis-display";class ti extends rt{constructor(e){super(),this._handles=new U,this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,1)}createGraphicDragPipeline(e){return Rt(this._graphicState,e,i=>this.createDragPipeline(i),this._view.state.viewingMode)}createDragPipeline(e){const i=this._view,a=this._graphicState.graphic,s=p(a.geometry)?a.geometry.spatialReference:null;return Y(this._manipulator,(n,r,o,l,h)=>{const c=r.next(ns(h,i,a,s)).next(He()).next(Ce());e(n,c,o,l,h)})}_createManipulator(){const e=this._view,i=this._graphicState.graphic;this._manipulator=new rs({graphic:i,view:e,selectable:!0,cursor:"move"})}}class zn{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class Tn{constructor(e,i,a){this.dx=e,this.dy=i,this.allGraphics=a,this.type="graphic-move"}}class ra{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}let fe=class extends yi(me.EventedMixin(bt)){constructor(t){super(t),this.graphics=new os,this.enableZ=!0,this.type="move-3d",this._toolHandles=new U,this.snappingPipeline=new xt}initialize(){this._toolHandles.add([this.graphics.on("change",()=>this._refreshManipulators())]),this._refreshManipulators(),this.complete()}destroy(){this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const t=this.graphics.toArray().filter(e=>ls(e)===0).map(e=>new Cn(e));t.length&&(this.createManipulators(t),this.createVisualElements(t),this.handles.add(t.map(e=>this.view.trackGraphicState(e.state))),this.updateMoveManipulation(t))}createManipulators(t){for(const e of t){const i=e.state;e.manipulationXY=new ti({tool:this,view:this.view,graphicState:i}),e.manipulationXY.forEachManipulator(a=>this.handles.add(a.events.on("immediate-click",s=>{this.emit("immediate-click",$(O({},s),{graphic:i.graphic})),s.stopPropagation()}))),this.handles.add(e.manipulationXY.createDragPipeline((a,s,n,r)=>this.buildDragEventPipeline(t,0,a,s,n,r)))}this.createMoveManipulation(t)}createMoveManipulation(t){const e=new Pe({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:t.length===1?Pe.radiusForSymbol(t[0].graphic.symbol):ee});this._moveManipulation=e,e.elevationInfo={mode:"absolute-height",offset:0},e.forEachManipulator(s=>{this.handles.add(s.events.on("immediate-click",n=>{e.zManipulation.hasManipulator(s)||this.graphics.length!==1||this.emit("immediate-click",$(O({},n),{graphic:this.graphics.getItemAt(0)})),n.stopPropagation()}))});const i=()=>this.updateMoveManipulation(t);for(const s of t)this.handles.add([s.state.on("changed",i),s.state.watch("displaying",i)]);const a=t[t.length-1];this.handles.add(a.state.on("changed",()=>this.updateMoveManipulationAngle(a))),this.handles.add(e.createDragPipeline((s,n,r,o,l)=>this.buildDragEventPipeline(t,s,n,r,o,l),T(a.graphic),S(a.graphic.geometry).spatialReference,a.graphic)),this.updateMoveManipulationAngle(a)}createVisualElements(t){for(const e of t){const i=e.graphic,a=$t({view:this.view,graphic:i,forEachManipulator:s=>{e.manipulationXY.forEachManipulator(s),this._moveManipulation.forEachManipulator(s)},onManipulatorsChanged:()=>Te()});_(a)||(e.geometryRepresentation=a.visualElement,e.geometryRepresentation instanceof De&&this.handles.add([e.geometryRepresentation.events.on("attachment-origin-changed",()=>{e.state.isDraped||this.updateMoveManipulation(t)}),e.state.watch("isDraped",()=>this.updateMoveManipulation(t))]),this.handles.add(a))}}updateMoveManipulationAngle(t){this._moveManipulation.angleDeferred=()=>aa(t.graphic.geometry)}updateMoveManipulation(t){const e=wt(0,0,0,this.view.spatialReference);let i=0,a=!1;const s=this._moveManipulation;for(const n of t){if(!n.state.displaying)continue;const r=n.state.graphic;this.enableZ&&Ee(r)&&(a=!0);const o=n.geometryRepresentation instanceof De&&!n.state.isDraped?n.geometryRepresentation.attachmentOrigin:Ut(this.view,r);p(o)&&(e.x+=o.x,e.y+=o.y,e.z+=o.z,i++)}i>0?(e.x/=i,e.y/=i,e.z/=i,s.location=e,s.xyManipulation.available=!0,s.xyAxisManipulation.available=!0,s.zManipulation.available=a):s.available=!1}buildDragEventPipeline(t,e,i,a,s,n){const r=[],o=[];let l=null,h=null;const c=()=>{for(const u of r)u.dragging=!1;r.length=0,o.length=0,l=null,h=null,this._moveManipulation.interactive=!0};if(t.length===1&&e===0){const u=t[0].graphic;a=this.buildSnappingPipelineSteps(u,T(u),a,s,n)}const g=a.next(u=>{if(u.action==="start"){r.length=0,o.length=0;for(const y of t)y.dragging||!y.manipulationXY.hasManipulator(i)&&y.manipulationXY.grabbing||(r.push(y),o.push(y.graphic),y.dragging=!0);if(o.length!==0&&(this._moveManipulation.interactive=!1,l=hs(o,this.view.state.viewingMode),h=ps(o),this.emit("graphic-move-start",new zn(o)),this.destroyed))return null}return o.length!==0?u:null}).next(u=>l(u)).next(u=>{switch(u.action){case"start":case"update":if(u.translationX||u.translationY||u.translationZ){const y=this.view.toScreen(u.mapStart),f=this.view.toScreen(u.mapEnd),E=f.x-y.x,G=f.y-y.y;if(this.emit("graphic-move",new Tn(E,G,o)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new ra(o)),this.destroyed)return null;c()}});return s.next(u=>h(u)).next(()=>{if(this.emit("graphic-move-stop",new ra(o)),this.destroyed)return null;c()}),g}buildSnappingPipelineSteps(t,e,i,a,s){const n=t.geometry;if(_(n)||n.type!=="point"&&n.type!=="mesh")return i;const r=(n.type==="point"?n:n.anchor).clone(),o=new St({elevationInfo:e,pointer:s,editGeometryOperations:Et.fromGeometry(r,this.view.state.viewingMode),visualizer:new nt,excludeFeature:t}),l=this.snappingManager;return i.next(h=>(r.z=cs(this.view,r,T(t),{mode:"absolute-height",offset:0}),$(O({},h),{snapOrigin:o.coordinateHelper.pointToVector(r)}))).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:o,snappingManager:l,cancel:a,updatingHandles:this.updatingHandles}),this.snappingPipeline.next)}};m([v({constructOnly:!0,nonNullable:!0})],fe.prototype,"view",void 0),m([v({readOnly:!0})],fe.prototype,"graphics",void 0),m([v({constructOnly:!0,nonNullable:!0})],fe.prototype,"enableZ",void 0),m([v({constructOnly:!0})],fe.prototype,"snappingManager",void 0),m([v({readOnly:!0})],fe.prototype,"type",void 0),m([v({readOnly:!0})],fe.prototype,"updating",null),fe=m([ue("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],fe);class Cn{constructor(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Ge({graphic:e})}get graphic(){return this.state.graphic}}function oa(t,e,i){const a=i.mode==="on-the-ground"?1:0;return new ds(t,a,e,0)}function la(t,e,i){const a=w();if(!t.renderCoordsHelper.toRenderCoords(e,a))return null;const s=ha(t,e,it(i.plane)),n=ha(t,e,i.edgeDirection);if(_(s)||_(n))return null;const r=ve(w(),s,n);return fi(a,r,Zt())}function ha(t,e,i){const a=wt(e.x+i[0],e.y+i[1],e.z+i[2],e.spatialReference),s=w(),n=w();return t.renderCoordsHelper.toRenderCoords(e,s)&&t.renderCoordsHelper.toRenderCoords(a,n)?_i(n,s,n):null}function kn(t,e,i){const a=it(t),s=_i(w(),e,i),n=ve(w(),s,a),r=ve(w(),s,n);return us(s[0],s[1],s[2],0,n[0],n[1],n[2],0,r[0],r[1],r[2],0,0,0,0,1)}function Hn(t,e,i){const a=i.projectToRenderScreen(t,Mi()),s=i.projectToRenderScreen(e,Mi());return p(a)&&p(s)?gs(A(a,a,s)):0}let Ie=class extends me.EventedMixin(Nt){constructor(t){super(t),this._vertexManipulatorMaterial=ae(d.colorToVec4(d.reshapeManipulators.vertex.color),d.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=at(d.colorToVec4(d.reshapeManipulators.vertex.outlineColor),d.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=at(d.colorToVec4(d.reshapeManipulators.vertex.hoverOutlineColor),d.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=ae(d.colorToVec4(d.reshapeManipulators.edge.color),d.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=at(d.colorToVec4(d.reshapeManipulators.edge.outlineColor),d.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=ae(d.colorToVec4(d.reshapeManipulators.edgeOffset.color),d.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=ae(d.colorToVec4(d.reshapeManipulators.edgeOffset.hoverColor),d.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=ae(d.colorToVec4(d.reshapeManipulators.selected.color),d.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=at(d.colorToVec4(d.reshapeManipulators.selected.outlineColor),d.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=at(d.colorToVec4(d.reshapeManipulators.selected.hoverOutlineColor),d.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._edgeOffsetManipulatorGeometryInside=null,this._edgeOffsetManipulatorGeometryOutside=null,this._manipulatorHandles=new U,this._manipulatorInfos=[],this._editGeometryOperations=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=0,this._outlineVisualElement=null,this.tool=null,this.outputGeometry=null,this._snappingPipeline=new xt,this._snappingPipelineHandle=new xt,this._vertexLaserLineVisualElement=null}initialize(){const t=new Ge({graphic:this.graphic});this._graphicState=t,this.handles.add([t.watch("displaying",e=>{for(const i of this._manipulatorInfos)i.manipulator.available=e}),this.view.trackGraphicState(t)])}destroy(){this._editGeometryOperations=z(this._editGeometryOperations),this._moveManipulation=z(this._moveManipulation),this._graphicMoveManipulation=z(this._graphicMoveManipulation),this._manipulatorHandles=z(this._manipulatorHandles),this.manipulators.removeAll(),this._manipulatorInfos=[],this._resetGrabbingDragging()}get inputGeometry(){return p(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(t){this._recreateEditGeometryAndManipulators(t)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}removeSelectedVertices(){const t=this._manipulatorInfos.filter(e=>e.manipulator.selected&&e.handle.type==="vertex");this._removeVertices(t)}manipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._moveManipulation=z(this._moveManipulation),this._graphicMoveManipulation=z(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[]}_resetGrabbingDragging(){this._numGrabbing=0,this._numDragging=0}_createManipulators(){if(_(this._editGeometryOperations))return;const t=T(this.graphic);for(const e of this._editGeometryOperations.data.components){for(const i of e.vertices)this._createVertexOrEdgeManipulator(i,t);for(const i of e.edges)this._createVertexOrEdgeManipulator(i,t)}this._createGraphicMoveManipulators(t)}get canRedo(){return p(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return p(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if(_(this._editGeometryOperations))return null;const t=this._editGeometryOperations.redo();return p(t)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),t}undo(){if(_(this._editGeometryOperations))return null;this.emit("undo");const t=this._editGeometryOperations.undo();return p(t)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),t}_recreateManipulators(){this._removeManipulators(),this._resetGrabbingDragging(),this._createManipulators()}_recreateEditGeometryAndManipulators(t=this.inputGeometry){this._removeManipulators(),this._resetGrabbingDragging(),_(t)||(z(this._editGeometryOperations),this._editGeometryOperations=Et.fromGeometry(t,this.view.state.viewingMode),this._createManipulators())}_perGraphicManipulatorDragAction(t,e){if(e.action==="end")return;let i=0;const a=[],s=this._manipulatorInfos.some(r=>r.handle.type==="vertex"&&r.manipulator.selected),n=t===1&&s;for(const r of this._manipulatorInfos)ot(r)&&(r.manipulator.grabbing||n&&!r.manipulator.selected||a.push(r),i++);if(a.length!==0)if(this._moveVertices(a,e),a.length===i){if(this._updateEventState(1),this.destroyed)return;this.emit("move",{type:"move",dx:e.screenDeltaX,dy:e.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(2),this.destroyed)return;this.emit("reshape",{type:"reshape",mover:this.graphic})}}_isMultiVertexSelection(){let t=0;for(const e of this._manipulatorInfos)ot(e)&&e.manipulator.selected&&t++;return t>1}_perVertexManipulatorDragAction(t){if(this._updateEventState(2),this.destroyed)return;const{mapDeltaX:e,mapDeltaY:i,mapDeltaZ:a}=t;if(!e&&!i&&!a)return;const s=[];for(const n of this._manipulatorInfos)ot(n)&&(n.manipulator.selected&&!n.manipulator.grabbing||n===t.info)&&s.push(n);this._moveVertices(s,t,1),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(t){if(t===this._reshapeEventState)return!1;switch(t){case 0:if(this._numGrabbing!==0||this._numDragging!==0)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const e=this._reshapeEventState!==t;return this._reshapeEventState=t,e}_createGraphicMoveManipulators(t){if(this._graphicMoveManipulation=new ti({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic){let a=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((s,n,r)=>{n.next(o=>this._trackNumDragging(o)).next(o=>(o.action==="start"&&(a=S(this._editGeometryOperations).createUndoGroup()),o)).next(o=>{this._perGraphicManipulatorDragAction(0,o),o.action==="end"&&(a=Oe(a))}),r.next(this._cancelDragOperation(()=>a=Oe(a)))}))}else this._graphicMoveManipulation.forEachManipulator(a=>{a.grabbable=!1,a.cursor=null});this._graphicMoveManipulation.forEachManipulator(a=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(a,!1),a.events.on("immediate-click",s=>{this._manipulatorInfos.some(n=>n.manipulator.selected)?this._clearSelection():this.emit("immediate-click",$(O({},s),{graphic:this.graphic})),s.stopPropagation()})])),this._moveManipulation=new Pe({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Ee(this.graphic),snapToScene:!1,radius:Pe.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator(a=>{this.handles.add([this._watchAndUpdateGrabState(a,!1),a.events.on("immediate-click",s=>{this._moveManipulation.zManipulation.hasManipulator(a)||this._manipulatorInfos.some(n=>n.manipulator.selected)||this.emit("immediate-click",$(O({},s),{graphic:this.graphic})),s.stopPropagation()})])}),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const e=S(this.graphic.geometry).spatialReference;this.handles.add([this._moveManipulation.createDragPipeline((a,s,n,r,o)=>{const l=n.next(h=>this._trackNumDragging(h)).next(h=>{const c=this._manipulatorInfos.filter(g=>ot(g)&&g.manipulator.selected);return h.manipulatorType===1&&c.length===1?$(O({},h),{info:c[0],snapOrigin:c[0].handle.pos}):$(O({},h),{info:null})}).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:h=>!!h.info,cancel:r,snappingManager:this.tool.snappingManager,snappingContext:new St({editGeometryOperations:S(this._editGeometryOperations),elevationInfo:t,pointer:o,excludeFeature:this.graphic,visualizer:new nt}),updatingHandles:this.updatingHandles}),this._snappingPipelineHandle.next).next(He()).next(h=>(this._perGraphicManipulatorDragAction(1,h),h));return r.next(this._cancelDragOperation()),l},t,e,this.graphic),Se(this._graphicState,"displaying",()=>{this._updateMoveManipulationPosition()}),this._graphicState.on("changed",()=>this._updateMoveManipulationPosition()),Se(this._graphicState,"isDraped",()=>{const a="align-move-manipulation";this._graphicState.isDraped?this.handles.add(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),a):this.handles.remove(a)})]),this._updateMoveManipulationPosition();const i=$t({view:this.view,graphic:this.graphic,forEachManipulator:a=>{if(!this.destroyed){p(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(a);for(const s of this._manipulatorInfos)a(s.manipulator,1);this._moveManipulation.forEachManipulator(a)}},onManipulatorsChanged:a=>this.on("manipulators-changed",a)});p(i)&&(this._outlineVisualElement=i.visualElement instanceof De?i.visualElement:null),p(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}),this._graphicState.watch("isDraped",()=>this._updateMoveManipulationPosition())]),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(t,e=T(this.graphic)){const i=d.reshapeManipulators.edgeOffset,a=i.size/2,s=a+i.collisionPadding;if(_(this._edgeOffsetManipulatorGeometryInside)||_(this._edgeOffsetManipulatorGeometryOutside)){const u=a/s,y=u*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=P.createExtrudedTriangle(y,u/2,u/2,i.height,i.offset),this._edgeOffsetManipulatorGeometryOutside=P.createExtrudedTriangle(-y,u/2,u/2,i.height,-i.offset)}const n=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2}],r=new Z({view:this.view,renderObjects:n,elevationInfo:e.mode!=="on-the-ground"||bi(this.graphic.symbol)?{mode:"absolute-height",offset:0}:e,worldOriented:!1,focusMultiplier:1,radius:s,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:I(0,0,1)},collisionPriority:1}),o=new Z({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default"}),l={manipulator:r,handle:t,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:o,elevationInfo:e,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(l,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(l);const h=this._getManipulatorInfoFromHandle(l.handle.leftVertex).manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(l)),c=this._getManipulatorInfoFromHandle(l.handle.rightVertex).manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(l));l.locationUpdateHandle=k([h,c]),this._manipulatorHandles.add(l.locationUpdateHandle,r),this._manipulatorHandles.add([this._watchAndUpdateGrabState(r,!0),this._watchAndUpdateGrabState(o,!0)],r),this._manipulatorHandles.add(Y(r,this._createEdgeOffsetPipeline(l,e)),r),this._manipulatorHandles.add(Y(o,(u,y,f,E)=>{if(E==="touch")this._createEdgeOffsetPipeline(l,e)(u,y,f);else if(this.enableMoveGraphic){const G=this.graphic,M=p(G.geometry)?G.geometry.spatialReference:null;y.next(D=>this._trackNumDragging(D)).next(tt(this.view,u.elevationAlignedLocation)).next(Bt(this.view,u.elevationAlignedLocation,e,M,G)).next(Ce()).next(He()).next(D=>this._perGraphicManipulatorDragAction(0,D)),f.next(this._cancelDragOperation())}}),r);const g=u=>{this._manipulatorInfos.some(y=>y.manipulator.selected)?this._clearSelection():this.emit("immediate-click",$(O({},u),{graphic:this.graphic})),u.stopPropagation()};return this._manipulatorHandles.add([r.events.on("immediate-click",g),o.events.on("immediate-click",g)],r),this._manipulatorInfos.push(l),this.manipulators.add(r),this.manipulators.add(o),this.emit("manipulators-changed"),l}_autoHideEdgeOffsetManipulator(t,e){const i=t.manipulator,a=t.edgeManipulator,s=()=>{Oe(t.visibilityHandle);const n=Hn(this._getManipulatorInfoFromHandle(t.handle.leftVertex).manipulator.renderLocation,this._getManipulatorInfoFromHandle(t.handle.rightVertex).manipulator.renderLocation,this.view.state.camera)<e;(!i.focused&&!a.focused||n)&&(i.grabbable=!n,a.grabbable=!n,t.visibilityHandle=k([i.disableDisplay(),{remove:()=>{i.grabbable=!0,a.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([i.events.on("focus-changed",s),a.events.on("focus-changed",s),{remove:()=>{Oe(t.visibilityHandle),this.manipulators.remove(a)}}],i),s()}_updateEdgeOffsetManipulator(t){this._updateManipulatorPosition(t);const e=S(this._editGeometryOperations).data.coordinateHelper,i=la(this.view,t.manipulator.elevationAlignedLocation,oa(e,t.handle,S(t.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(t.handle.leftVertex).manipulator.renderLocation,s=this._getManipulatorInfoFromHandle(t.handle.rightVertex).manipulator.renderLocation,n=p(i)?kn(i,a,s):ms;t.manipulator.modelTransform=n,t.edgeManipulator.elevationAlignedLocation=t.manipulator.elevationAlignedLocation,t.edgeManipulator.modelTransform=n;const r=Le(A(At,a,s))/2;t.edgeManipulator.collisionType={type:"line",paths:[[[-r,0,0],[r,0,0]]]}}_createEdgeOffsetPipeline(t,e){return(i,a,s)=>{this._clearSelection();const{step:n,cleanup:r}=this._initializeEdgeOffset(t,e);a.next(o=>this._trackNumDragging(o)).next(tt(this.view,i.elevationAlignedLocation)).next(n).next(vs(this.view)).next(ys(this.view,S(this._editGeometryOperations).data.spatialReference)).next(He()).next(this._applyEdgeOffsetStep(t)).next(o=>{o.action==="end"&&r()}),s.next(o=>(r(),o)).next(this._cancelDragOperation())}}_initializeEdgeOffset(t,e){const i=S(this._editGeometryOperations),a=oa(i.data.coordinateHelper,t.handle,e),s=i.createUndoGroup(),n=la(this.view,t.manipulator.elevationAlignedLocation,a);a.requiresSplitEdgeLeft&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(t.handle.leftVertex.leftEdge),1),a.requiresSplitEdgeRight&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(t.handle.rightVertex.rightEdge),0);const r=()=>new _s({paths:[[t.handle.leftVertex.pos,t.handle.rightVertex.pos]],spatialReference:S(this._editGeometryOperations).data.spatialReference}),o=new De({view:this.view,isDraped:this._graphicState.isDraped,geometry:r(),elevationInfo:t.elevationInfo,width:d.visualElements.lineGraphics.outline.width,color:d.colorToVec4(Xt.main),attached:!0});let l;const h=()=>{this._cleanEdgeOffsetCollapsedEdges(t),l=Oe(l)},c=this.on("undo",h);return l=k([B(o),this._graphicState.watch("isDraped",g=>o.isDraped=g),this._graphicState.on("changed",()=>o.geometry=r()),s,c]),{step:g=>_(a)||_(n)?(h(),null):$(O({},g),{operation:a,plane:n}),cleanup:h}}_applyEdgeOffsetStep(t){return e=>{if(this.destroyed||_(e.operation))return e;this._updateEventState(2);const{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:s}=e;return(i||a||s)&&(this._offsetEdge(t,e),this.emit("reshape",{type:"reshape",mover:this.graphic})),e}}_cleanEdgeOffsetCollapsedEdges(t){var e,i;const a=(e=t.handle.leftVertex.leftEdge)==null?void 0:e.leftVertex,s=t.handle.leftVertex,n=(i=t.handle.rightVertex.rightEdge)==null?void 0:i.rightVertex,r=t.handle.rightVertex,o=S(this._editGeometryOperations).data.coordinateHelper,l=1e-6,h=[];a&&o.distance(a.pos,s.pos)<l&&h.push(this._getManipulatorInfoFromHandle(s)),(o.distance(s.pos,r.pos)<l||n&&o.distance(n.pos,r.pos)<l)&&h.push(this._getManipulatorInfoFromHandle(r)),h.length&&this._removeVertices(h)}_computeVertexManipulatorSizeAndOutline(t){const e=t.size/2,i=e+t.collisionPadding;return{size:e/i,outlineSize:(e+t.outlineSize)/i}}_createVertexOrEdgeManipulator(t,e=T(this.graphic)){if(t.type==="edge"){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(t,e);if(!this.enableMidpoints)return null}if(_(this._vertexManipulatorGeometry)||_(this._vertexManipulatorOutlineGeometry)){const{size:r,outlineSize:o}=this._computeVertexManipulatorSizeAndOutline(d.reshapeManipulators.vertex);this._vertexManipulatorGeometry=P.createSphereGeometry(r,16,16),this._vertexManipulatorOutlineGeometry=P.createSphereGeometry(o,16,16)}if(_(this._edgeManipulatorGeometry)||_(this._edgeManipulatorOutlineGeometry)){const{size:r,outlineSize:o}=this._computeVertexManipulatorSizeAndOutline(d.reshapeManipulators.edge);this._edgeManipulatorGeometry=P.createSphereGeometry(r,16,16),this._edgeManipulatorOutlineGeometry=P.createSphereGeometry(o,16,16)}const i=p(this.graphic.geometry)&&this.graphic.geometry.type==="point"?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|W.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|W.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|W.Vertex},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}];this.enableMidpoints&&i.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|W.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|W.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|W.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|W.Edge});const a=new Z({view:this.view,renderObjects:i,elevationInfo:e,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(a,t,e);const s=t.type==="edge"?{manipulator:a,handle:t,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:a,handle:t,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(s),this.manipulators.add(a),this._updateManipulatorPosition(s),s.type==="edge"){const r=this._getManipulatorInfoFromHandle(s.handle.leftVertex).manipulator.events.on("location-update",()=>this._updateManipulatorPosition(s)),o=this._getManipulatorInfoFromHandle(s.handle.rightVertex).manipulator.events.on("location-update",()=>this._updateManipulatorPosition(s));s.locationUpdateHandle=k([r,o]),this._manipulatorHandles.add(s.locationUpdateHandle,a)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(a,!0),a);const n=Y(a,(r,o,l,h)=>{let c=null;o.next(g=>this._trackNumDragging(g)).next(g=>{if(g.action==="start"&&(c=S(this._editGeometryOperations).createUndoGroup()),ca(s)){const u=this._splitEdgeManipulator(s);return $(O({},g),{info:u,snapOrigin:u.handle.pos})}return $(O({},g),{info:s,snapOrigin:s.handle.pos})}).next(tt(this.view,r.elevationAlignedLocation)).next(fs(this.view,this.graphic,r.elevationAlignedLocation,r.location.spatialReference,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),cancel:l,snappingManager:this.tool.snappingManager,snappingContext:new St({editGeometryOperations:S(this._editGeometryOperations),elevationInfo:e,pointer:h,excludeFeature:this.graphic,visualizer:new nt}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next(He()).next(g=>{this._perVertexManipulatorDragAction(g),g.action==="end"&&(c=Oe(c))}),l.next(this._cancelDragOperation(()=>c=Oe(c)))});return this._manipulatorHandles.add(n,a),this._manipulatorHandles.add([a.events.on("immediate-click",r=>this._manipulatorClickCallback(r,s)),a.events.on("select-changed",()=>{s.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()})],a),this.emit("manipulators-changed"),s}_trackNumDragging(t){switch(t.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return t}_cancelDragOperation(t){return()=>{switch(this._numDragging--,this.undo(),this.outputGeometry=p(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null,p(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._reshapeEventState){case 0:break;case 1:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape",mover:this.graphic})}t&&t(),this.destroyed||this._updateEventState(0)}}_setTypeSpecificManipulatorSettings(t,e,i){switch(e.type){case"vertex":t.state=W.Vertex,t.selectable=!0,t.cursor="move",t.collisionPriority=2,t.radius=d.reshapeManipulators.vertex.size/2+d.reshapeManipulators.vertex.collisionPadding,t.elevationInfo=i,t.interactive=p(this.graphic.geometry)&&this.graphic.geometry.type!=="point";break;case"edge":t.state=W.Edge,t.selectable=!1,t.cursor="copy",t.collisionPriority=-1,t.radius=d.reshapeManipulators.edge.size/2+d.reshapeManipulators.edge.collisionPadding,t.elevationInfo=i.mode!=="on-the-ground"||bi(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(t,e){return t.events.on("grab-changed",i=>{if(i.action==="start")e&&this._updateSelection(t),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(0),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,(i.pointerType!=="touch"||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach(a=>{a.manipulator.interactive=!this._numGrabbing&&p(this.graphic.geometry)&&this.graphic.geometry.type!=="point","edgeManipulator"in a&&(a.edgeManipulator.interactive=!this._numGrabbing)}),S(this._graphicMoveManipulation).forEachManipulator(a=>a.interactive=!this._numGrabbing))})}_clearSelection(){for(const t of this._manipulatorInfos)t.manipulator.grabbing||(t.manipulator.selected=!1)}_updateSelection(t){t.grabbing&&!t.selected&&t.selectable&&(this._clearSelection(),t.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(t){t&&(this._manipulatorHandles.remove(t.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(t),1),this.manipulators.remove(t.manipulator),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(t){if(t){for(const e of this._manipulatorInfos)if(t===e.handle)return e}return null}_updateManipulatorPosition(t){if(!t)return;const e=S(this._editGeometryOperations);if(t.handle.type==="vertex")t.manipulator.location=e.data.coordinateHelper.vectorToDehydratedPoint(t.handle.pos,lt),t.manipulator.grabbing&&p(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=t.manipulator.renderLocation);else if(t.handle.type==="edge"){const i=this._getManipulatorInfoFromHandle(t.handle.leftVertex).manipulator,a=this._getManipulatorInfoFromHandle(t.handle.rightVertex).manipulator;if(p(t.manipulator.elevationInfo)&&t.manipulator.elevationInfo.mode==="on-the-ground"){const s=i.location,n=a.location,r=.5,o=s.x+r*(n.x-s.x),l=s.y+r*(n.y-s.y),h=s.hasZ&&n.hasZ?0:void 0;t.manipulator.location=wt(o,l,h,e.data.spatialReference)}else de(At,i.renderLocation,a.renderLocation,.5),t.manipulator.renderLocation=At}}_splitEdgeManipulator(t,e=.5){const i=S(this._editGeometryOperations),a=S(i.splitEdge(t.handle,e).createdVertex);t.locationUpdateHandle.remove(),t.locationUpdateHandle=void 0;const s=T(this.graphic);let n;this.enableEdgeOffset?(this._removeManipulator(t),n=this._createVertexOrEdgeManipulator(a)):(n=t,n.handle=a,n.type="vertex",this._setTypeSpecificManipulatorSettings(t.manipulator,t.handle,s)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(n),this._updateSelection(t.manipulator);const r=this._updateEventState(2),o=i.data.coordinateHelper.vectorToArray(n.handle.pos),l=i.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:o,componentIndex:l,vertexIndex:S(a.index)}],added:o}),r&&this._updateEventState(0),n}_updateMoveManipulationPosition(){const t=N(At,0,0,0);let e=0,i=!1,a=null,s=null;for(const n of this._manipulatorInfos)ot(n)&&(n.manipulator.selected?(e++,ie(t,t,n.manipulator.renderLocation),_(a)||n.selectedIndex>a.selectedIndex?(s=a,a=n):(_(s)||n.selectedIndex>s.selectedIndex)&&(s=n)):i=!0);if(e!==0){const n=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=n,this._moveManipulation.xyAxisManipulation.available=n,this._moveManipulation.zManipulation.available=n&&this.enableZVertex&&Ee(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=n&&e!==1}else{const n=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=n,this._moveManipulation.xyAxisManipulation.available=n,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=n,this._moveManipulation.zManipulation.available=n&&this.enableZShape&&Ee(this.graphic)}if(e!==0){let n=0;if(p(a)){const r=a.handle.pos,o=p(s)?s.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,l=!p(s)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;o&&l?this._moveManipulation.xyAxisManipulation.available=!1:o?n=pa(o,r):l&&(n=pa(r,l))}this._moveManipulation.angle=n,this._moveManipulation.radius=Wi}else this._moveManipulation.angleDeferred=()=>aa(S(this.graphic.geometry)),this._moveManipulation.radius=Pe.radiusForSymbol(this.graphic.symbol);e!==0&&i?(ge(t,t,1/e),lt.spatialReference=S(this._editGeometryOperations).data.spatialReference,lt.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(t,lt),this._moveManipulation.elevationAlignedLocation=lt):p(this._outlineVisualElement)&&!this._graphicState.isDraped&&p(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:xi(this.view,this._moveManipulation,this.graphic)}_removeVertices(t){const e=[],i=S(this._editGeometryOperations);for(const a of t)if(a.handle.type==="vertex"&&i.canRemoveVertex()){e.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));const s=S(i.removeVertices([a.handle]).removedVertices[0].createdEdge);s&&this._createVertexOrEdgeManipulator(s)}if(e.length>0){const a=e.map(n=>{const r=i.data.components.indexOf(n.component);return{coordinates:i.data.coordinateHelper.vectorToArray(n.pos),componentIndex:r,vertexIndex:S(n.index)}});this.outputGeometry=i.data.geometry;const s=this._updateEventState(2);if(this.destroyed||(this.emit("vertex-remove",{type:"vertex-remove",removed:a.map(n=>n.coordinates),vertices:a}),this.destroyed)||s&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(t,e,i=e.action==="start"?0:1){const a=S(this._editGeometryOperations);a.moveVertices(t.map(s=>s.handle),e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i),this.outputGeometry=a.data.geometry;for(const s of t)this._updateManipulatorPosition(s)}_offsetEdge(t,e){if(_(e.operation))return;const i=S(this._editGeometryOperations),a=e.operation.clone();a.distance=e.operation.signedDistanceToPoint(e.mapEnd),i.updateVertices([t.handle.leftVertex,t.handle.rightVertex],a),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t.handle.rightVertex))}_manipulatorClickCallback(t,e){t.shiftKey||this._clearSelection(),e.handle.type==="vertex"&&(e.manipulator.selected=!e.manipulator.selected),e.handle.type==="vertex"&&t.button===2&&this._removeVertices([e]),ca(e)&&t.button===0&&this._splitEdgeManipulator(e),t.stopPropagation()}};function pa(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])+Math.PI/2}function ot(t){return t.handle.type==="vertex"}function ca(t){return t.handle.type==="edge"}m([v({constructOnly:!0})],Ie.prototype,"tool",void 0),m([v()],Ie.prototype,"inputGeometry",null),m([v()],Ie.prototype,"outputGeometry",void 0),m([v({readOnly:!0})],Ie.prototype,"updating",null),Ie=m([ue("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],Ie);const lt=wt(0,0,null,null),At=w();var W;(function(t){t.Vertex=16,t.Edge=32})(W||(W={}));let H=class extends me.EventedMixin(bt){constructor(t){super(t),this._handles=new U,this._reshapeOperation=null,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.snappingManager=null,this.automaticManipulatorSelection=!1}destroy(){this._handles=z(this._handles),this._reshapeOperation=z(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}get updating(){var t,e;return(t=(e=this._reshapeOperation)==null?void 0:e.updating)!=null&&t}_updateGeometry(){const t=Ms(this.graphic);this._reshapeOperation.inputGeometry=p(t)?t.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),bs(this.graphic)!==0)return;const t=this.watch("graphic.geometry",()=>{this._internalGeometryUpdate===!1&&this._updateGeometry()},!0);this._handles.add(t,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_updateGeometryInternally(t){this._internalGeometryUpdate=!0,this.graphic.geometry=t,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){_(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}initialize(){this._reshapeOperation=new Ie({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",t=>{t.type==="reshape"&&this._onReshapeGeometryChanged(),this.emit("reshape",t)}),this._reshapeOperation.on("move",t=>{t.type==="move"&&this._onReshapeGeometryChanged(),this.emit("move",t)}),this._reshapeOperation.on("vertex-add",t=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",t)}),this._reshapeOperation.on("vertex-remove",t=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",t)}),this._reshapeOperation.on("immediate-click",t=>this.emit("immediate-click",t)),this.view.on("pointer-down",["Shift"],t=>{t.stopPropagation()}),Se(this,"graphic",()=>{this._updateGraphic()},!0)]),this.complete()}get canUndo(){var t,e;return(t=(e=this._reshapeOperation)==null?void 0:e.canUndo)!=null&&t}undo(){p(this.snappingManager)&&this.snappingManager.doneSnapping(),p(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canRedo(){var t,e;return(t=(e=this._reshapeOperation)==null?void 0:e.canRedo)!=null&&t}redo(){p(this.snappingManager)&&this.snappingManager.doneSnapping(),p(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}onInputEvent(t){t.type!=="key-down"||t.key!=="Delete"&&t.key!=="Backspace"||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager}}};m([v()],H.prototype,"_reshapeOperation",void 0),m([v({constructOnly:!0,nonNullable:!0})],H.prototype,"view",void 0),m([v({constructOnly:!0})],H.prototype,"graphic",void 0),m([v({constructOnly:!0,nonNullable:!0})],H.prototype,"enableZShape",void 0),m([v({constructOnly:!0,nonNullable:!0})],H.prototype,"enableZVertex",void 0),m([v({constructOnly:!0,nonNullable:!0})],H.prototype,"enableMoveGraphic",void 0),m([v({constructOnly:!0,nonNullable:!0})],H.prototype,"enableMidpoints",void 0),m([v({constructOnly:!0,nonNullable:!0})],H.prototype,"enableEdgeOffset",void 0),m([v({readOnly:!0})],H.prototype,"type",void 0),m([v({constructOnly:!0})],H.prototype,"snappingManager",void 0),m([v({readOnly:!0})],H.prototype,"updating",null),m([v()],H.prototype,"automaticManipulatorSelection",void 0),H=m([ue("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],H);var x;(function(t){t.ScaleIn=32,t.ScaleOut=64,t.RotateLeft=128,t.RotateRight=256,t.Unlocked=1024,t.DelayedFocused=2048,t.TouchInput=32768})(x||(x={}));class Ln{constructor(e){this.mode=null,this._handles=new U,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new me,this.getFocused=()=>this.ringManipulator.focused,this.getScale=()=>p(this._scaleRotateDragData)&&this._scaleRotateDragData.mode==="scale"?this.adapter.scale:1,this.tool=e.tool,this.mode=e.mode,this.adapter=e.adapter,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this.ringManipulator.location=e}set elevationAlignedLocation(e){this.ringManipulator.elevationAlignedLocation=e}get grabbing(){return this.ringManipulator.grabbing}set interactive(e){this.ringManipulator.interactive=e}destroy(){p(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=z(this._handles),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}startAnimation(e){this.cancelActiveAnimation(),e.start();const i=xs({update:({deltaTime:a})=>{e.update(a)&&this.cancelActiveAnimation()}});this._activeAnimation=$(O({},e),{frameTask:i})}cancelActiveAnimation(){p(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=z(this._activeAnimation))}forEachManipulator(e){e(this.ringManipulator,4)}createManipulator(){this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);const e=this.ringManipulator,i=this.tool.graphicState.graphic,a=Y(e,(s,n,r)=>{this._scaleRotateDragData=null,this.adapter.restart();const o={mode:"none",origin:wi(s.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=o,this.updateDragState();const l=b.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(s.renderLocation,l),n.next(Yt(this.tool.view,fi(s.renderLocation,l,Zt()))).next(h=>{const c=it(h.plane),g=Si(h.renderStart,h.renderEnd,o.origin,c),u=ws.shortestSignedDiff(o.angle,g);o.angleDir=dt(o.angleDir+u,-ia,ia),o.angle=g;const y=Fn(o,h),f=y-this.adapter.scale;if(o.scaleDir=dt(o.scaleDir+f,-ta,ta),this.onScaleChanged(),o.mode==="none"){const E=this.mode||Bn(h,h.plane,o.origin,this.tool.view.state.camera);if(p(E)){switch(E){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:i,angle:0}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:i,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()})}o.mode=E}}switch(o.mode){case"rotate":this.adapter.angle=o.initialAngle+g;break;case"scale":this.adapter.scale=y,this.onScaleChanged()}switch(this.updateDragState(),this.updateManipulatorTransform(),h.action){case"start":case"update":switch(o.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:i,angle:st(o.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:i,xScale:y,yScale:y})}break;case"end":switch(o.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:i,angle:st(o.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:i,xScale:y,yScale:y})}}h.action==="end"&&(this.startAnimation(da(this,()=>this.onScaleChanged())),this._scaleRotateDragData=null,this.updateDragState())}),r.next(()=>{if(this.adapter.cancel(),p(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:i,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:i,xScale:1,yScale:1})}this.startAnimation(da(this,()=>this.onScaleChanged())),this._scaleRotateDragData=null,this.updateDragState()}})});this._handles.add(a),this._handles.add([this.ringManipulator.events.on("focus-changed",s=>{s.action==="focus"?this.startAnimation(jn(this,()=>this.updateDelayedFocusedState())):this.updateDelayedFocusedState()}),this.ringManipulator.events.on("immediate-click",s=>{s.stopPropagation()}),Se(this.tool.graphicState,"displaying",s=>this.ringManipulator.available=s)])}onScaleChanged(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}updateDelayedFocusedState(){this.ringManipulator.updateStateEnabled(x.DelayedFocused,this.getFocused())}updateDragState(){if(this.ringManipulator.updateStateEnabled(x.Unlocked,!(p(this._scaleRotateDragData)&&this._scaleRotateDragData.mode!=="none")),p(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(x.ScaleIn|x.ScaleOut,!1),this.ringManipulator.updateStateEnabled(x.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(x.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(x.RotateLeft|x.RotateRight,!1),this.ringManipulator.updateStateEnabled(x.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(x.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(x.ScaleIn|x.ScaleOut|x.RotateLeft|x.RotateRight,!1)}updateManipulatorTransform(){const e=ke(j.get()),i=this.adapter.angle;yt(e,e,i,I(0,0,1));const a=this.getScale(),s=_t(j.get(),N(b.get(),a,a,a)),n=ke(j.get());vt(n,s,e),this.ringManipulator.modelTransform=n}createRingManipulator(){const e=(R,K,ne)=>{const re=[],oe=Math.ceil(Yi*(K-R)/(2*Math.PI));for(let C=0;C<oe+1;C++){const qe=R+C*(K-R)/oe;re.push(I(ne*Math.cos(qe),ne*Math.sin(qe),0))}return re},i=R=>e(0,2*Math.PI,R),a=R=>[[-R/2,0],[R/2,0],[R/2,Jt/2],[-R/2,Jt/2]],s=(R,K)=>P.createPathExtrusionGeometry(a(K),R,[],[],!1),n=i(Ae),r=s(n,ei),o={left:[],right:[]},l=[];for(let R=0;R<2;R++){const K=R*Math.PI-Math.PI/4,ne=Math.PI/2-En,re=K+ne,oe=K+Math.PI/2-ne,C=e(re,oe,xn),qe=s(C,Ne);l.push(C),l.push(e(re,oe,qi-ei/2)),o.left.push(qe),o.right.push(qe);for(let Vt=0;Vt<2;Vt++){const ai=Vt===0,F=ft();if(ai){vi(F,F,[1,-1,1]),yt(F,F,-re,[0,0,1]);const be=Math.round(Ki*(C.length-1));F[12]=C[be][0],F[13]=C[be][1],F[14]=C[be][2]}else{yt(F,F,oe,[0,0,1]);const be=Math.round((1-Ki)*(C.length-1));F[12]=C[be][0],F[13]=C[be][1],F[14]=C[be][2]}const si=P.createExtrudedTriangle(wn,0,Sn,Jt);P.transformInPlace(si,F),(ai?o.left:o.right).push(si)}}const h=[];for(let R=0;R<2;R++){const K=R*Math.PI-Math.PI/4,ne=Math.PI/2-On,re=K+ne,oe=K+Math.PI/2-ne,C=e(re,oe,qi);h.push(s(C,Ne))}const c=i(Ae+Ji),g=i(Ae+ea),u=s(c,Ne),y=s(g,Ne),f=i(Ae-Ji),E=i(Ae-ea),G=s(f,Ne),M=s(E,Ne),D=this.createMaterial(),L=this.createMaterial(.66),Xe=this.createMaterial(.5),We=this.createMaterial(.33);let te=[{geometry:r,material:D,stateMask:x.DelayedFocused},{geometry:r,material:Xe,stateMask:0}];this.mode&&this.mode!=="scale"||(te=te.concat([{geometry:h,material:D,stateMask:x.DelayedFocused|x.Unlocked},{geometry:u,material:L,stateMask:x.DelayedFocused|x.ScaleIn},{geometry:y,material:We,stateMask:x.DelayedFocused|x.ScaleIn},{geometry:G,material:L,stateMask:x.DelayedFocused|x.ScaleOut},{geometry:M,material:We,stateMask:x.DelayedFocused|x.ScaleOut}])),this.mode&&this.mode!=="rotate"||(te=te.concat([{geometry:o.right,material:D,stateMask:x.DelayedFocused|x.Unlocked},{geometry:o.left,material:D,stateMask:x.DelayedFocused|x.RotateLeft},{geometry:o.right,material:D,stateMask:x.DelayedFocused|x.RotateRight}]));const ht=[n,...l];return new Z({view:this.tool.view,renderObjects:te,autoScaleRenderObjects:!1,worldOriented:!0,radius:ei,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:T(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:ht,direction:I(0,0,1)}})}createMaterial(e=1){const i=[..._n,e];return new jt({color:i,transparent:e!==1,cullFace:2,renderOccluded:2})}get test(){return{ringManipulator:this.ringManipulator}}}function Fn(t,e){const i=A(b.get(),e.renderStart,t.origin),a=A(b.get(),e.renderEnd,t.origin),s=Le(i),n=Le(a);return s===0?0:n/s}function Bn(t,e,i,a){const{renderStart:s,renderEnd:n}=t,r=Pt(s,a,b.get()),o=Pt(n,a,b.get());if(Ss(r,o)<Qi*Qi)return null;const l=A(b.get(),s,i),h=ve(b.get(),l,it(e)),c=s,g=ie(b.get(),c,h),u=Pt(i,a,b.get()),y=r,f=Pt(g,a,b.get()),E=A(b.get(),f,y),G=A(b.get(),r,u),M=Ei(y,E),D=Ei(u,G);return Oi(M,o)<Oi(D,o)?"rotate":"scale"}function Pt(t,e,i){return e.projectToScreen(t,ii),N(i,ii[0],ii[1],0)}function da(t,e){let i=null,a=1;const s=()=>a;return{start:()=>{a=t.getScale(),i=t.getScale,t.getScale=s,e()},update:n=>(a+=((a+1)/2-a)*Math.min(n*Dn,1),e(),Math.abs(a-1)<.01?1:0),destroy:()=>{t.getScale=i,e()}}}function jn(t,e){let i=0,a=null;const s=()=>!1;return{start:()=>{a=t.getFocused,t.getFocused=s,i=0,e()},update:n=>(i+=n,!a()||i>Gn?1:0),destroy:()=>{t.getFocused=a,e()}}}const ii=ze();function ua(t){return p(t.geometry)&&t.geometry.type==="mesh"?Un(t.geometry):Zn(t)}function Un(t){return p(t.transform)?Nn(t,t.transform):Yn(t)}function Zn(t){let e=t.geometry,i=Gi;return{undo(a){i=a.geometry,a.geometry=e},redo(a){e=a.geometry,a.geometry=i}}}function Nn(t,e){let i=e.clone(),a=null;return{undo:s=>{a=p(t.transform)?t.transform.clone():null,t.transform=i,s.notifyGeometryChanged()},redo:s=>{i=p(t.transform)?t.transform.clone():null,t.transform=a,s.notifyGeometryChanged()}}}function Yn(t){let e,i=t.vertexAttributes.clonePositional();return{undo:a=>{e=t.vertexAttributes.clonePositional(),t.vertexAttributes=i,a.notifyGeometryChanged()},redo:a=>{i=t.vertexAttributes.clonePositional(),t.vertexAttributes=e,a.notifyGeometryChanged()}}}let Me=class extends Nt{constructor(t){super(t),this.angle=0,this.scale=1,this.initialAngle=0,this.previousAngle=0,this.previousScale=1}initialize(){this.restart()}restart(){this.handles.remove(ga);const t=this.geometry.transform;if(this.scale=1,p(t)){const e=Js(t.rotation)[2];Math.abs(e)>.999999&&(this.angle=mt(en(t.rotation))*Math.sign(e))}this.initialAngle=this.angle,this.previousAngle=this.angle,this.previousScale=this.scale,this.handles.add(Di(()=>({angle:this.angle,scale:this.scale}),e=>this.update(e),$i),ga)}cancel(){this.scale=1,this.angle=this.initialAngle}createUndoRecord(){return ua(this.graphic)}update({scale:t,angle:e}){const i=this.geometry.anchor,a=this.viewingMode===1;t!==this.previousScale&&(this.geometry.scale(t/this.previousScale,{origin:i,geographic:a}),this.previousScale=t,this.graphic.notifyGeometryChanged()),e!==this.previousAngle&&(this.geometry.rotate(0,0,st(e-this.previousAngle),{origin:i,geographic:a}),this.previousAngle=e,this.graphic.notifyGeometryChanged())}};m([v({constructOnly:!0})],Me.prototype,"graphic",void 0),m([v({constructOnly:!0})],Me.prototype,"geometry",void 0),m([v({constructOnly:!0})],Me.prototype,"viewingMode",void 0),m([v()],Me.prototype,"angle",void 0),m([v()],Me.prototype,"scale",void 0),Me=m([ue("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Me);const ga="scale-heading-update-key";let se=class extends Nt{constructor(t){super(t),this.angle=0,this.scale=1,this.symbol=null,this.initialAngle=0}initialize(){this.restart()}restart(){this.handles.remove(ma);const t=p(this.graphic.symbol)&&this.graphic.symbol.type==="point-3d"?this.graphic.symbol:Gi;if(this.symbol=p(t)?t.clone():null,this.initialSizes=[],p(t)){const e=this.findLayerView();p(e)&&(this.initialSizes=t.symbolLayers.map(i=>i.type==="object"?e.getSymbolLayerSize(t,i):null).toArray())}this.angle=0,p(t)&&t.symbolLayers.some(e=>!(e.type!=="object"||!p(e.heading))&&(this.angle=-mt(e.heading),!0)),this.initialAngle=this.angle,this.scale=1,this.handles.add(Di(()=>({angle:this.angle,scale:this.scale}),e=>this.updateSymbol(e),$i),ma)}cancel(){this.graphic.symbol=this.symbol}createUndoRecord(){let t=this.graphic.symbol,e=null;return{undo:i=>{e=i.symbol,i.symbol=t,this.restart()},redo:i=>{t=i.symbol,i.symbol=e,this.restart()}}}updateSymbol({scale:t,angle:e}){const i=this.graphic.symbol;if(_(this.symbol)||_(i)||i.type!=="point-3d")return;const a=i.clone(),s=-st(e-this.initialAngle);let n=!1;this.forEachObjectSymbolLayerPair(this.symbol,a,(r,o,l)=>{const h=Qe(r.heading,0)+s;o.heading!==h&&(o.heading=h,n=!0);const c=this.initialSizes[l];if(p(c)&&"width"in c){c.width=this.sizeFilter(c.width),c.height=this.sizeFilter(c.height),c.depth=this.sizeFilter(c.depth);const g=c.width*t;o.width!==g&&(o.width=g,n=!0);const u=c.depth*t;o.depth!==u&&(o.depth=u,n=!0);const y=c.height*t;o.height!==y&&(o.height=y,n=!0)}}),n&&(this.graphic.symbol=a)}forEachObjectSymbolLayerPair(t,e,i){t.symbolLayers.forEach((a,s)=>{const n=e.symbolLayers.getItemAt(s);a.type==="object"&&n.type==="object"&&i(a,n,s)})}};m([v()],se.prototype,"angle",void 0),m([v()],se.prototype,"scale",void 0),m([v({constructOnly:!0})],se.prototype,"graphic",void 0),m([v()],se.prototype,"symbol",void 0),m([v({constructOnly:!0})],se.prototype,"findLayerView",void 0),m([v({constructOnly:!0})],se.prototype,"sizeFilter",void 0),se=m([ue("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],se);const ma="scale-heading-update-key";let q=class extends yi(me.EventedMixin(bt)){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.type="transform-3d",this.scaleRotate=null,this.snappingPipeline=new xt}initialize(){this.graphicState=new Ge({graphic:this.graphic}),this.moveManipulation=new Pe({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Ee(this.graphic),radius:Pe.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator(e=>this.handles.add(e.events.on("immediate-click",i=>{this.emit("immediate-click",$(O({},i),{graphic:this.graphicState.graphic})),i.stopPropagation()}))),this.moveManipulation.elevationInfo=T(this.graphic);const t=this.graphic.geometry;if(this.moveManipulation.createGraphicDragPipeline((e,i,a,s,n)=>(p(t)&&e===0&&(a=a.next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new St({elevationInfo:T(this.graphic),pointer:n,editGeometryOperations:Et.fromGeometry(new Es({spatialReference:t.spatialReference}),this.view.state.viewingMode),visualizer:new nt,excludeFeature:this.graphic}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:s}),this.snappingPipeline.next)),a),this.graphicState,e=>{const{action:i,graphic:a,dxScreen:s,dyScreen:n}=e,r={graphic:a,dxScreen:s,dyScreen:n};switch(i){case"start":this.emit("graphic-translate-start",r),this.emit("record-undo",{record:this.createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",r);break;case"end":this.emit("graphic-translate-stop",r)}}),this.moveManipulation.angle=p(this.scaleRotate)?this.scaleRotate.angle:0,this.scaleRotateAdapter=this.createScaleRotateAdapter(),this.handles.add(this.scaleRotateAdapter.watch("angle",()=>this.updateMoveAngle())),this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new Ln({tool:this,mode:e,adapter:this.scaleRotateAdapter}),this.handles.add(this.scaleRotate.events.on("scale-changed",()=>this.onScaleChanged()))}this.handles.add([$t({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>Te()}),this.graphicState.on("changed",()=>this.onGeometryChanged()),this.hideManipulatorsForGraphicState(),this.view.watch("scale",()=>this.updateMoveAngle())]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged(),this.updateMoveAngle(),this.forEachManipulator(e=>{e instanceof Z&&this.handles.add(e.events.on("grab-changed",()=>this.updateManipulatorsInteractive()))}),this.complete()}updateManipulatorsInteractive(){_(this.scaleRotate)||(this.scaleRotate.interactive=!this.moveManipulation.grabbing,this.moveManipulation.interactive=!this.scaleRotate.grabbing)}createScaleRotateAdapter(){return p(this.graphic.geometry)&&this.graphic.geometry.type==="mesh"?new Me({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new se({graphic:this.graphic,sizeFilter:t=>this.enforceNonZeroSize(t),findLayerView:()=>this.view.allLayerViews.find(t=>t.layer===this.graphic.layer)})}forEachManipulator(t){this.moveManipulation.forEachManipulator(t),p(this.scaleRotate)&&this.scaleRotate.forEachManipulator(t)}hideManipulatorsForGraphicState(){return this.graphicState.watch("displaying",t=>{this.forEachManipulator(e=>e.available=t),this.moveManipulation.zManipulation.available=t&&this.enableZ&&Ee(this.graphic)})}createGeometryUndoRecord(){return ua(this.graphic)}destroy(){this.moveManipulation.destroy(),this.scaleRotate=z(this.scaleRotate),this.scaleRotateAdapter=z(this.scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}set snapToScene(t){this.moveManipulation&&(this.moveManipulation.snapToScene=t),this._set("snapToScene",t)}get updating(){return this.updatingHandles.updating}set location(t){this.moveManipulation.location=t,p(this.scaleRotate)&&(this.scaleRotate.location=t)}set elevationAlignedLocation(t){this.moveManipulation.elevationAlignedLocation=t,p(this.scaleRotate)&&(this.scaleRotate.elevationAlignedLocation=t)}reset(){}onDetach(){p(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onHide(){p(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onScaleChanged(){if(_(this.scaleRotate))return;const t=this.scaleRotate.getScale();this.moveManipulation.displayScale=t}updateMoveAngle(){this.view.state.viewingMode===2||this.view.scale<$n?this.moveManipulation.angle=this.scaleRotateAdapter.angle:this.moveManipulation.angle=0}onGeometryChanged(){xi(this.view,this,this.graphic)}enforceNonZeroSize(t){return t||this.view.state.camera.computeRenderPixelSizeAt(this.moveManipulation.renderLocation)}get test(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,zManipulator:this.moveManipulation.zManipulation.test.manipulator,ringManipulator:p(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}};m([v({constructOnly:!0,nonNullable:!0})],q.prototype,"view",void 0),m([v({constructOnly:!0,nonNullable:!0})],q.prototype,"graphic",void 0),m([v({constructOnly:!0,nonNullable:!0})],q.prototype,"enableZ",void 0),m([v()],q.prototype,"enableRotation",void 0),m([v()],q.prototype,"enableScaling",void 0),m([v({value:!1})],q.prototype,"snapToScene",null),m([v({constructOnly:!0})],q.prototype,"snappingManager",void 0),m([v({readOnly:!0})],q.prototype,"type",void 0),m([v({readOnly:!0})],q.prototype,"updating",null),q=m([ue("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],q);class Xn{constructor(){this.lastDragEvent=null,this.next=new gi,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&p(this.lastDragEvent)){const i=$(O({},this.lastDragEvent),{action:"update"});e&&this.adjustScaleFactors(i),this.next.execute(i)}this._enabled=e}createDragEventPipelineStep(){return this.lastDragEvent=null,e=>(this.lastDragEvent=e.action!=="end"?O({},e):null,this._enabled&&this.adjustScaleFactors(e),e)}adjustScaleFactors(e){const i=Ri(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):e.handle.direction[0]===0?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-i:i,e.factor2=e.factor2<0?-i:i}get test(){return{adjustScaleFactors:e=>this.adjustScaleFactors(e)}}}function It(t,e){return ya(t,e,!1)}function va(t,e){return ya(t,e,!0)}function ya(t,e,i){if(t instanceof Gs){if(t.operation instanceof Ds)return Wn(t.operation,e,i),!0;if(t.operation instanceof $s)return qn(t.operation,e,i),!0;if(t.operation instanceof Rs)return Qn(t.operation,e,i),!0}return!1}function Wn(t,e,i=!1){const a=i?-1:1,s=I(a*t.dx,a*t.dy,a*t.dz);ie(e.origin,e.origin,s)}function qn(t,e,i=!1){const a=i?-t.angle:t.angle;Ai(e.basis1,e.basis1,Pi,a),Ai(e.basis2,e.basis2,Pi,a)}function Qn(t,e,i=!1){const a=i?1/t.factor1:t.factor1,s=i?1/t.factor2:t.factor2;ge(e.basis1,e.basis1,a),ge(e.basis2,e.basis2,s),Ii(e.origin,e.origin,t.origin,t.axis1,a),Ii(e.origin,e.origin,t.origin,t.axis2,s)}function Kn(t,e,i,a){a||(a=Fe());const s=pe(Be.get(),t[1],-t[0]),n=pe(Be.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=pe(Be.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),o=Be.get();e.components.forEach(c=>c.vertices.forEach(g=>{const u=g.pos;pe(o,Vi(t,u),Vi(s,u)),As(n,n,o),Ps(r,r,o)}));const l=1e-6,h=pe(Be.get(),r[0]-n[0]<l?i/2:0,r[1]-n[1]<l?i/2:0);return Lt(n,n,h),we(r,r,h),Je(a.basis1,t,(r[0]-n[0])/2),Je(a.basis2,s,(r[1]-n[1])/2),pe(a.origin,n[0]*t[0]+n[1]*s[0],n[0]*t[1]+n[1]*s[1]),we(a.origin,a.origin,a.basis1),we(a.origin,a.origin,a.basis2),a}function Jn(t,e,i,a=0,s){s||(s=Fe()),e.toRenderCoords(t.origin,i,s.origin);const n=b.get();ie(n,t.origin,t.basis1),ie(n,n,t.basis2),e.toRenderCoords(n,i,n);const r=b.get();ie(r,t.origin,t.basis1),A(r,r,t.basis2),e.toRenderCoords(r,i,r);const o=b.get();A(o,t.origin,t.basis1),A(o,o,t.basis2),e.toRenderCoords(o,i,o);const l=b.get();A(l,t.origin,t.basis1),ie(l,l,t.basis2),e.toRenderCoords(l,i,l);const h=de(b.get(),n,r,.5);A(h,h,s.origin);const c=de(b.get(),o,l,.5);A(c,s.origin,c),de(s.basis1,h,c,.5);const g=de(b.get(),l,n,.5);A(g,g,s.origin);const u=de(b.get(),r,o,.5);A(u,s.origin,u),de(s.basis2,g,u,.5);const y=ve(b.get(),s.basis1,s.basis2),f=ve(y,y,s.basis1);return Ke(f,f),ge(s.basis2,f,Mt(s.basis2,f)),ge(s.basis1,s.basis1,1+a/Le(s.basis1)),ge(s.basis2,s.basis2,1+a/Le(s.basis2)),Os(s),s}let Q=class extends me.EventedMixin(bt){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this._preserveAspectRatio=new Xn,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this.handles=new U,this.moveZManipulator=null,this.resizeManipulators=null,this.rotateManipulator=null,this.attachmentOrigin=null,this.outlineVisualElement=null,this.mapBounds=Fe(),this.mapBoundsStart=Fe(),this.displayBounds=Fe(),this.displayBoundsStart=Fe(),this.displayBoundsMarginStart=0,this.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}]}initialize(){this.graphicState=new Ge({graphic:this.graphic});const t=this.graphic.geometry;this.editGeometryOperations=Et.fromGeometry(t,this.view.state.viewingMode),this.graphicMoveManipulation=new ti({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this.createMoveXYGraphicDragPipeline()),this.moveZManipulator=Is(this.view,0),this.moveZManipulator.state|=Vs,this.handles.add(this.watch("enableZ",()=>this.updateManipulatorAvailability(this.moveZManipulator,0))),this.handles.add(this.createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map(n=>{const r=zs(this.view,n);return this.handles.add(this.watch("enableScaling",()=>this.updateManipulatorAvailability(r,2))),r.events.on("grab-changed",o=>this.onResizeGrab(o)),this.handles.add(this.createResizeDragPipeline(r,n)),r}),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=Ts(this.view.toolViewManager.textures),this.rotateManipulator=Cs(this.view,this.rotateManipulatorTexture.texture),this.handles.add(this.watch("enableRotation",()=>this.updateManipulatorAvailability(this.rotateManipulator,3))),this.rotateManipulator.events.on("grab-changed",n=>{this.onRotateGrab(n)}),this.handles.add(this.createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.updateDisplayBounds();const e=$t({view:this.view,graphic:this.graphic,forEachManipulator:n=>this.forEachManipulator(n),onManipulatorsChanged:()=>Te()});p(e)&&(this.outlineVisualElement=e.visualElement instanceof De?e.visualElement:null),p(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",()=>this.updateDisplayBounds())),this.handles.add(e),this.handles.add([this.graphicState.on("changed",()=>this.onGeometryChanged()),this.graphicState.watch("displaying",()=>this.updateAllManipulatorAvailability()),Se(this.graphicState,"isDraped",()=>this.graphicDrapedChanged()),this.view.trackGraphicState(this.graphicState)]);const i=this.view.pointsOfInterest;i&&this.handles.add(i.centerOnSurfaceFrequent.watch("location",()=>this.updateDisplayBounds()));const a=n=>{this.handles.add(n.events.on("grab-changed",()=>{this.grabbing=n.grabbing,this.updateAllManipulatorAvailability()}))};this.forEachManipulator(a);const s=(n,r)=>{this.handles.add(n.events.on("immediate-click",o=>{r===1&&this.emit("immediate-click",$(O({},o),{graphic:this.graphic})),o.stopPropagation()}))};this.forEachManipulator(s),this.onGeometryChanged(),this.updateAllManipulatorAvailability(),this.complete()}graphicDrapedChanged(){this.handles.remove(_a),this.updateDisplayBounds(),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",t=>{p(this.attachmentOrigin)&&di(t.extent,this.attachmentOrigin.x,this.attachmentOrigin.y)&&this.updateDisplayBounds()}),_a)}updateAllManipulatorAvailability(){this.forEachManipulator((t,e)=>this.updateManipulatorAvailability(t,e))}updateManipulatorAvailability(t,e){const i=this.grabbing&&!t.grabbing;if(t.interactive=!i,t instanceof Z){const a=this.graphicState.displaying,s=this.enableZ&&Ee(this.graphic);switch(e){case 3:t.available=a&&this.enableRotation;break;case 2:t.available=a&&(this.enableScaling||this.enableRotation||s),t.interactive=!i&&this.enableScaling,t.state=this.enableScaling?ks:Hs;break;case 0:t.available=a&&s;break;default:t.available=a}}}forEachManipulator(t){this.graphicMoveManipulation.forEachManipulator(t),this.resizeManipulators.forEach(e=>t(e,2)),t(this.rotateManipulator,3),t(this.moveZManipulator,0)}destroy(){this.rotateManipulatorTexture.release(),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.editGeometryOperations.destroy(),this._set("view",null),this._set("graphic",null)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(t){this._preserveAspectRatio.enabled=t,this._set("preserveAspectRatio",t)}reset(){}onDetach(){this.mapBounds=null,this.displayBounds=null}onGeometryChanged(){this.updateDisplayBounds()}calculateMapBounds(){const t=this.graphic.geometry,e=this.editGeometryOperations.data,i=e.components[0].edges[0],a=Lt(Be.get(),i.leftVertex.pos,i.rightVertex.pos);Ht(a,a);const s=Qe(Ut(this.view,this.graphic),t.extent.center);let n=tr*this.view.pixelSizeAt(s);const r=this.view.spatialReference;r!==t.spatialReference&&(n*=zi(r)/zi(t.spatialReference)),Kn(a,e,n,this.mapBounds)}updateDisplayBounds(){const t=this.graphic.geometry;if(_(t))return;const e=p(this.outlineVisualElement)&&!this.graphicState.isDraped&&p(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:Ut(this.view,this.graphic);this.attachmentOrigin=Qe(e,t.extent.center);const i=p(e)?e.z:Ft(this.mapBounds.origin,this.view.elevationProvider,gt.fromElevationInfo(T(this.graphic)),this.view.renderCoordsHelper),a=ye(this.mapBounds);a.origin[2]=i,Jn(a,this.view.renderCoordsHelper,t.spatialReference,this.displayBoundsMargin,this.displayBounds),this.updateManipulators()}get displayBoundsMargin(){const t=this.view.pointsOfInterest,e=t?t.centerOnSurfaceFrequent.location:this.editGeometryOperations.data.geometry.extent.center;return er*this.view.pixelSizeAt(e)}createMoveXYGraphicDragPipeline(){return this.graphicMoveManipulation.createDragPipeline((t,e,i)=>this.applyGraphicMoveSteps(e,i))}createMoveZDragPipeline(){const t=this.view,e=this.editGeometryOperations.data.spatialReference;return Y(this.moveZManipulator,(i,a,s)=>{const n=wi(i.renderLocation),r=a.next(mi(t,n,e)).next(Ce());this.applyGraphicMoveSteps(r,s)})}applyGraphicMoveSteps(t,e){const i=t.next(a=>(a.action==="start"&&(this.inputState={type:"move"},ye(this.mapBounds,this.mapBoundsStart),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:a.screenDeltaX,dyScreen:a.screenDeltaY})),a)).next(He()).next(this.moveDragUpdateGeometry()).next(a=>{const s={graphic:this.graphic,dxScreen:a.screenDeltaX,dyScreen:a.screenDeltaY};switch(a.action){case"start":case"update":(a.mapEnd.x-a.mapStart.x||a.mapEnd.y-a.mapStart.y||a.mapEnd.z-a.mapStart.z)&&this.emit("graphic-translate",s);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",s)}return a});return e.next(()=>{p(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this.cancel()}),i}moveDragUpdateGeometry(){return t=>{if(_(this.inputState)||this.inputState.type!=="move")return t;const e=[];for(const s of this.editGeometryOperations.data.components)e.push(...s.vertices);const i=t.action==="start"?0:1,a=this.editGeometryOperations.moveVertices(e,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i);return It(a,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,t}}onResizeGrab(t){if(t.action!=="start")return;const e=this.calculatePickRay(t.screenPoint);Ti(this.displayBounds.plane,e,b.get())&&(ye(this.displayBounds,this.displayBoundsStart),ye(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin,this.inputState={type:"resize"})}createResizeDragPipeline(t,e){return Y(t,(i,a,s)=>{_(this.inputState)||(a.next(n=>(n.action==="start"&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),n)).next(Yt(this.view,this.displayBoundsStart.plane)).next(n=>$(O({},n),{handle:e})).next(this.resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this.resizeDragUpdateGeometry()).next(n=>{const r={graphic:this.graphic,xScale:n.factor1,yScale:n.factor2};switch(n.action){case"start":case"update":this.emit("graphic-scale",r);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",r)}return n}),s.next(()=>{p(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this.cancel()}))})}resizeDragRenderPlaneToFactors(){return t=>{const e=this.displayBoundsStart,i=t.handle.direction,a=this.displayBoundsMargin,s=this.displayBoundsMarginStart,n=le(b.get(),e.origin);Ot(n,n,e.basis1,-i[0]),Ot(n,n,e.basis2,-i[1]);const r=A(b.get(),t.renderEnd,n),o=A(b.get(),t.renderStart,n),l=Ri(t.handle),h=Ci(e),c=Ci(this.displayBounds)/h,g=(u,y)=>{if(u===0)return 1;let f=Le(y),E=.5*u*Mt(y,r)/f;const G=E<0?-1:1;l&&(E+=(f-.5*u*Mt(y,o)/f)*G*c);const M=f<1.5*s?1:fa;return f=Math.max(f-s,fa),G>0&&(E-=a),G*Math.max(G*(E/f),M)};return $(O({},t),{factor1:g(i[0],e.basis1),factor2:g(i[1],e.basis2)})}}resizeDragUpdateGeometry(){return t=>{const e=le(w(),this.mapBoundsStart.origin);Ot(e,e,this.mapBoundsStart.basis1,-t.handle.direction[0]),Ot(e,e,this.mapBoundsStart.basis2,-t.handle.direction[1]);const i=pe(Ls(),this.mapBoundsStart.basis1[0],this.mapBoundsStart.basis1[1]);Ht(i,i);const a=[];for(const r of this.editGeometryOperations.data.components)a.push(...r.vertices);const s=t.action==="start"?0:1,n=this.editGeometryOperations.scaleVertices(a,e,i,t.factor1,t.factor2,s,1);return ye(this.mapBoundsStart,this.mapBounds),It(n,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,t}}onRotateGrab(t){if(t.action!=="start")return;const e=Fs(this.displayBounds,this.view.renderCoordsHelper,1,Zt()),i=this.calculatePickRay(t.screenPoint);Ti(e,i,b.get())&&(ye(this.displayBounds,this.displayBoundsStart),ye(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:e})}createRotateDragPipeline(t){return Y(t,(e,i,a)=>{const s=this.inputState;_(s)||(i.next(n=>(n.action==="start"&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),n)).next(Yt(this.view,s.rotatePlane)).next(this.rotateDragRenderPlaneToRotate(s)).next(this.rotateDragUpdateGeometry()).next(n=>{const r={graphic:this.graphic,angle:st(n.rotateAngle)};switch(n.action){case"start":case"update":this.emit("graphic-rotate",r);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",r)}return n}),a.next(()=>{p(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this.cancel()}))})}rotateDragRenderPlaneToRotate(t){return e=>{const i=it(t.rotatePlane),a=Si(e.renderStart,e.renderEnd,this.displayBounds.origin,i);return $(O({},e),{rotateAxis:i,rotateAngle:a})}}rotateDragUpdateGeometry(){return t=>{const e=le(w(),this.mapBoundsStart.origin),i=[];for(const n of this.editGeometryOperations.data.components)i.push(...n.vertices);const a=t.action==="start"?0:1,s=this.editGeometryOperations.rotateVertices(i,e,t.rotateAngle,a,1);return ye(this.mapBoundsStart,this.mapBounds),It(s,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,t}}calculatePickRay(t){const e=oi(),i=Bs(t);return js(this.view.state.camera,i,e),Ke(e.direction,e.direction),e}updateManipulators(){if(!this.visible)return;const t=Us(this.displayBounds,j.get());Zs(this.rotateManipulator,t,this.displayBounds,this.view.renderCoordsHelper),this.updateZMoveHandle(this.moveZManipulator,t),this.resizeManipulators.forEach((e,i)=>{Ns(e,this.resizeHandles[i],t,this.displayBounds)})}updateZMoveHandle(t,e){const i=this.displayBounds,a={basis:i.basis1,direction:-1,position:A(b.get(),i.origin,i.basis1),edge:2},s=j.get();Ys(s,e,a.edge*Math.PI/2),s[12]=0,s[13]=0,s[14]=0,t.modelTransform=s,t.renderLocation=a.position}cancel(){const t=this.editGeometryOperations.lastOperation;_(t)||(this.editGeometryOperations.undo(),this.graphic.geometry=this.editGeometryOperations.data.geometry,va(t,this.mapBounds),this.updateDisplayBounds(),this.inputState=null)}get canUndo(){return this.editGeometryOperations.canUndo}undo(){if(p(this.inputState))this.view.activeTool=null;else if(this.canUndo){const t=this.editGeometryOperations.undo();this.graphic.geometry=this.editGeometryOperations.data.geometry,va(S(t),this.mapBounds),this.updateDisplayBounds()}}get canRedo(){return this.editGeometryOperations.canRedo}redo(){if(this.canRedo){const t=this.editGeometryOperations.redo();this.graphic.geometry=this.editGeometryOperations.data.geometry,It(S(t),this.mapBounds),this.updateDisplayBounds()}}get test(){return{resizeManipulators:this.resizeManipulators,rotateManipulator:this.rotateManipulator,moveZManipulator:this.moveZManipulator}}};m([v({constructOnly:!0,nonNullable:!0})],Q.prototype,"view",void 0),m([v({constructOnly:!0,nonNullable:!0})],Q.prototype,"graphic",void 0),m([v({constructOnly:!0,nonNullable:!0})],Q.prototype,"enableZ",void 0),m([v()],Q.prototype,"enableRotation",void 0),m([v()],Q.prototype,"enableScaling",void 0),m([v()],Q.prototype,"preserveAspectRatio",null),m([v()],Q.prototype,"grabbing",void 0),m([v()],Q.prototype,"inputState",void 0),m([v({readOnly:!0})],Q.prototype,"type",void 0),Q=m([ue("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Q);const _a="draped-elevation-changes",er=10,tr=80,fa=1e-6;export{Ze as DrawGraphicTool3D,Q as ExtentTransformTool,fe as GraphicMoveTool,H as GraphicReshapeTool,q as GraphicTransformTool};
