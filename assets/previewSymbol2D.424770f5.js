var T=Object.defineProperty,A=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var S=(a,e,s)=>e in a?T(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s,L=(a,e)=>{for(var s in e||(e={}))b.call(e,s)&&S(a,s,e[s]);if(F)for(var s of F(e))B.call(e,s)&&S(a,s,e[s]);return a},j=(a,e)=>A(a,R(e));import{bk as g,q1 as G,q2 as I,a as J,an as K,pV as N,cL as O}from"./index.a1c5dd56.js";import{t as P,h as E}from"./previewUtils.27c44394.js";import{l as Q}from"./renderUtils.62c2284a.js";import"./vendor.c6be4c00.js";import"./index.a0863940.js";/* empty css              */import"./qrcode.0911187d.js";/* empty css                 */import"./colorUtils.92e1b957.js";const U="picture-fill",W="picture-marker",X="simple-fill",Y="simple-line",_="simple-marker",$="text",ee="Aa",V=22,x=120,Z=80,ae=40,te=document.createElement("canvas");function le(a,e){const s=te.getContext("2d"),d=[];return e&&(e.weight&&d.push(e.weight),e.size&&d.push(e.size+"px"),e.family&&d.push(e.family)),s.font=d.join(" "),s.measureText(a).width}const ne=7.2/2.54,se=72/2.54;function oe(a){if(a.length===0)return 0;if(a.length>2){const e=O(1),s=parseFloat(a);switch(a.slice(-2)){case"px":return s;case"pt":return s*e;case"in":return 72*s*e;case"pc":return 12*s*e;case"mm":return s*ne*e;case"cm":return s*se*e}}return parseFloat(a)}function ye(a,e){var s,d;const m=(e==null?void 0:e.size)!=null?g(e.size):null,v=(e==null?void 0:e.maxSize)!=null?g(e.maxSize):null,D=(e==null?void 0:e.opacity)!=null?e.opacity:null,y=(e==null?void 0:e.rotation)!=null?e.rotation:"angle"in a?a.angle:null,f=G(a);let p=I(a);if(f&&!p){const n="type"in f?null:new J(f);(n?n.toHex():null)==="#ffffff"&&(p={color:"#bdc3c7",width:.75})}const c={shape:null,fill:null,stroke:p,offset:[0,0]};(s=p)!=null&&s.width&&(p.width=Math.min(p.width,Z));const r=((d=p)==null?void 0:d.width)||0;let h=m!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale)),t=0,l=0,w=!1;switch(a.type){case _:{const n=a.style,i=Math.min(m!=null?m:g(a.size),v||x);switch(t=i,l=i,n){case"circle":c.shape={type:"circle",cx:0,cy:0,r:.5*i},h||(t+=r,l+=r);break;case"cross":c.shape={type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[t,.5*l]},{command:"M",values:[.5*t,0]},{command:"L",values:[.5*t,l]}]};break;case"diamond":c.shape={type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[.5*t,0]},{command:"L",values:[t,.5*l]},{command:"L",values:[.5*t,l]},{command:"Z",values:[]}]},h||(t+=r,l+=r);break;case"square":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[t,l]},{command:"L",values:[0,l]},{command:"Z",values:[]}]},h||(t+=r,l+=r),y&&(w=!0);break;case"triangle":c.shape={type:"path",path:[{command:"M",values:[.5*t,0]},{command:"L",values:[t,l]},{command:"L",values:[0,l]},{command:"Z",values:[]}]},h||(t+=r,l+=r),y&&(w=!0);break;case"x":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,l]},{command:"M",values:[t,0]},{command:"L",values:[0,l]}]},y&&(w=!0);break;case"path":c.shape={type:"path",path:a.path||""},h||(t+=r,l+=r),y&&(w=!0),h=!0}break}case Y:{const n=Math.min(m!=null?m:r,v||Z),i=n>V?2*n:ae;p.width=n,t=i,l=n,c.shape={type:"path",path:[{command:"M",values:[0,l]},{command:"L",values:[t,l]}]};break}case U:case X:t=Math.min(m!=null?m:V,v||x)+r,l=t,h=!0,c.shape=typeof(e==null?void 0:e.symbolConfig)=="object"&&e!=null&&e.symbolConfig.isSquareFill?P.squareFill[0]:P.fill[0];break;case W:{let n=g(a.width),i=g(a.height);const o=m!=null?m:Math.max(n,i),u=n/i;n=u<=1?Math.ceil(o*u):o,i=u<=1?o:Math.ceil(o/u),t=Math.min(n,v||x),l=Math.min(i,v||x),c.shape={type:"image",x:-Math.round(t/2),y:-Math.round(l/2),width:t,height:l,src:a.url||""},y&&(w=!0);break}case $:{const n=a,i=n.text||ee,o=n.font,u=Math.min(m!=null?m:g(o.size),v||x),H=le(i,{weight:o.weight,size:u,family:o.family}),C=/[\uE600-\uE6FF]/.test(i);t=C?u:H,l=u;let q=.25*oe((o?u:0).toString());C&&(q+=5),c.shape={type:"text",text:i,x:0,y:q,align:"middle",decoration:o&&o.decoration,rotated:n.rotated,kerning:n.kerning},c.font=o&&{size:u,style:o.style,decoration:o.decoration,weight:o.weight,family:o.family};break}}if(!c.shape)return Promise.reject(new K("symbolPreview: renderPreviewHTML2D","symbol not supported."));const M=f,z=a.color;let k=null;return M&&M.type==="pattern"&&z&&a.type!==U?k=N(M.src,z.toCss(!0)).then(n=>(M.src=n,c.fill=M,c)):(c.fill=f,k=Promise.resolve(c)),k.then(n=>{const i=[[n]];if(typeof(e==null?void 0:e.symbolConfig)=="object"&&e!=null&&e.symbolConfig.applyColorModulation){const o=.6*t;i.unshift([j(L({},n),{offset:[-o,0],fill:E(f,-.3)})]),i.push([j(L({},n),{offset:[o,0],fill:E(f,.3)})]),t+=2*o}return Q(i,[t,l],{node:e&&e.node,scale:h,opacity:D,rotation:y,useRotationSize:w,effectView:e==null?void 0:e.effectView})})}export{ye as previewSymbol2D};
