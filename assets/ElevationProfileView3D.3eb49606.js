import{lP as P,c3 as v,b5 as u,b0 as f,dG as D,bA as H,ss as L,q1 as $,pS as k,gi as G,aX as m,aY as w,aZ as V,a_ as A,aV as y,dm as I,k$ as d,l0 as c,hy as S,b1 as j,bI as x,lx as z,sw as M,hb as b,b9 as _,st as E}from"./vendor.c8f3cc8c.js";import{h as O}from"./HoveredPoints.66e66bbe.js";import{a as R,e as T,A as C}from"./GraphicState.d0c79cc8.js";import"./colorUtils.92e1b957.js";class U{constructor(e){this._params=e,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null}destroy(){this.remove()}remove(){this._highlightTask=P(this._highlightTask),this._highlightHandle=v(this._highlightHandle),this._visualElementHandle=v(this._visualElementHandle)}showHighlight(e){if(this.remove(),u(e)||!g(e))return;const s=e.layer;this._highlightTask=D(async t=>{const h=await this._params.view.whenLayerView(s);H(t),L(h)&&(this._highlightHandle=h.highlight(e))})}showReshaping(e){if(this.remove(),u(e))return;const s=this._params.view,t=new R({view:s,geometry:g(e)?e.geometry:null,attached:!1,elevationInfo:$(e),renderOccluded:8}),h=new T({graphic:e}),i=[h.watch("isDraped",o=>{t.isDraped=o}),h.on("changed",()=>{t.geometry=g(e)?e.geometry:null}),s.trackGraphicState(h),s.maskOccludee(e),k(t)];C.visualElements.lineGraphics.outline.apply(t),t.attached=!0,this._visualElementHandle=G(i)}}function g(a){return f(a.geometry)&&a.geometry.type==="polyline"}const Z=100;let p=class extends A{constructor(a){super(a),this._chartData=null,this._visualElements=[],this._handles=new y}initialize(){const a=I(e=>{this._update(e)},Z);this._handles.add([d(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),a,c),a])}destroy(){this._handles.destroy(),this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(a){this._chartData=a}_update(a){const{chartData:e}=a;if(u(e))return this.remove();if(!e.refined)return;const s=this._visualElements,t=e.lines.filter(n=>n.viewVisualizationEnabled),h=t.length;for(;s.length>h;)s.pop().destroy();const i=M;for(;s.length<h;){const n=new R({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:i.width-i.outlineSize,width:i.width,falloff:i.falloff,color:i.outlineColor,renderOccluded:i.renderOccluded});s.push(n)}const o=a.spatialReference;for(let n=0;n<h;++n){const l=s[n],r=t[h-1-n];l.geometry=this._createLineGeometry(r,o),l.innerColor=S(j.toUnitRGBA(r.color))}}_createLineGeometry(a,e){const s=x(a.samples,[]),t=s.length-1,h=[];let i=[];for(let o=0;o<=t;o++){const{x:n,y:l,z:r}=s[o];f(r)&&i.push([n,l,r]),(o===t||u(r))&&i.length&&(h.push(i),i=[])}return new z({paths:h,hasZ:!0,spatialReference:e})}_destroyVisualElements(){this._visualElements.forEach(a=>a.destroy()),this._visualElements.length=0}};m([w()],p.prototype,"view",void 0),m([w()],p.prototype,"_chartData",void 0),p=m([V("esri.widgets.ElevationProfile.support.ProfileLines3D")],p);class X{constructor(e,s){this._handles=new y,this._inputRepresentation=new U({view:e}),this._hoveredPoints=new O({view:e}),this._profileLines=new p({view:e}),this._handles.add([d(()=>s.viewModel.hoveredPoints,t=>this._hoveredPoints.update(t),c),d(()=>{const{state:t,editable:h,highlightEnabled:i,viewModel:o}=s,n=o.input;return b(n,l=>{l.commitProperty("geometry"),l.commitProperty("layer")}),{input:n,state:t,editable:h,highlightEnabled:i}},t=>this._updateInputRepresentation(t),c),d(()=>s.viewModel.chartData,t=>this._profileLines.update(t),c),d(()=>b(s.viewModel.input,t=>t.geometry),()=>{this._profileLines.remove()},c)])}destroy(){this._handles=_(this._handles),this._inputRepresentation=_(this._inputRepresentation),this._hoveredPoints=_(this._hoveredPoints),this._profileLines=_(this._profileLines)}_updateInputRepresentation({input:e,state:s,editable:t,highlightEnabled:h}){const i=this._inputRepresentation;if(!h)return i.remove();s===E.Selected?i.showHighlight(e):s!==E.Created||t?i.remove():i.showReshaping(e)}}export{X as ElevationProfileView3D};
