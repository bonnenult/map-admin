var R=Object.defineProperty;var x=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var b=(t,e,i)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,w=(t,e)=>{for(var i in e||(e={}))U.call(e,i)&&b(t,i,e[i]);if(x)for(var i of x(e))V.call(e,i)&&b(t,i,e[i]);return t};import{bE as W,c4 as E,b8 as I,bR as L,aX as h,aY as j,aZ as q,fX as _}from"./vendor.c8f3cc8c.js";import{t as $}from"./BitmapContainer.6272fa71.js";import{l as P}from"./LayerView2D.25658a74.js";import{S as D}from"./ExportStrategy.81c07dfc.js";import{i as z}from"./RefreshableLayerView.552e5409.js";import{a as B}from"./WMSLayerView.0f67c32d.js";import"./brushes.97799122.js";import"./definitions.21e97413.js";import"./Utils.b2b84829.js";import"./number.dfbabd3f.js";import"./programUtils.d5889455.js";import"./GeometryUtils.ea8c8742.js";import"./MaterialKey.56ac52e4.js";import"./pixelUtils.c614fa0a.js";import"./WGLContainer.465f24a3.js";import"./Container.98366c00.js";import"./EffectView.59df383f.js";import"./Bitmap.2b92a227.js";import"./ExportWMSImageParameters.491e05de.js";const F=W.getLogger("esri.views.2d.layers.WMSLayerView2D");let s=class extends B(z(P(_))){initialize(){const{layer:t,view:e}=this;t.supportsSpatialReference(e.spatialReference)||this.addResolvingPromise(Promise.reject(new E("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view",{layer:t})))}update(t){this.strategy.update(t).catch(e=>{I(e)||F.error(e)})}attach(){const{layer:t}=this,{imageMaxHeight:e,imageMaxWidth:i}=t;this._bitmapContainer=new $,this.container.addChild(this._bitmapContainer),this.strategy=new D({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:e,imageMaxWidth:i,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add(this.watch("exportImageVersion",()=>this.requestUpdate()),"exportImageVersion")}detach(){this.handles.remove("exportImageVersion"),this.strategy.destroy(),this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(t){const{view:e}=this,i=this._bitmapContainer,{x:r,y:o}=t,{spatialReference:v}=e;let a=null,n=0,d=0;if(i.children.some(S=>{const{width:l,height:f,resolution:y,x:p,y:m}=S,u=p+y*l,g=m-y*f;return r>=p&&r<=u&&o<=m&&o>=g&&(a=new L({xmin:p,ymin:g,xmax:u,ymax:m,spatialReference:v}),n=l,d=f,!0)}),!a)return null;const c=a.width/n,C=Math.round((r-a.xmin)/c),M=Math.round((a.ymax-o)/c);return{extent:a,width:n,height:d,x:C,y:M}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,i,r){return this.layer.fetchImage(t,e,i,w({timeExtent:this.timeExtent},r))}};h([j()],s.prototype,"strategy",void 0),h([j()],s.prototype,"updating",void 0),s=h([q("esri.views.2d.layers.WMSLayerView2D")],s);const ne=s;export{ne as default};
