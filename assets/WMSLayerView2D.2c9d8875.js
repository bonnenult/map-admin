var U=Object.defineProperty;var b=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var x=(t,e,i)=>e in t?U(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,j=(t,e)=>{for(var i in e||(e={}))R.call(e,i)&&x(t,i,e[i]);if(b)for(var i of b(e))V.call(e,i)&&x(t,i,e[i]);return t};import{X as W,an as q,g as I,a8 as L,e as h,d as w,i as E,eg as _}from"./index.988b09cd.js";import{t as $}from"./BitmapContainer.f778b4a7.js";import{l as P}from"./LayerView2D.8eaa8439.js";import{S as D}from"./ExportStrategy.41ff6b2c.js";import{i as z}from"./RefreshableLayerView.c8d2ecf1.js";import{a as B}from"./WMSLayerView.f607f90b.js";import"./vendor.c6be4c00.js";import"./index.25aa0880.js";/* empty css              */import"./qrcode.0911187d.js";/* empty css                 */import"./brushes.0945eb3a.js";import"./definitions.21e97413.js";import"./Utils.56a5b8e8.js";import"./number.dfbabd3f.js";import"./programUtils.cffd2d5b.js";import"./GeometryUtils.ea8c8742.js";import"./MaterialKey.d5a4d0f6.js";import"./pixelUtils.5acf42e1.js";import"./WGLContainer.c4152aca.js";import"./Container.b0eab594.js";import"./EffectView.8c4917f2.js";import"./Bitmap.7e32071f.js";import"./ExportWMSImageParameters.be80fede.js";const F=W.getLogger("esri.views.2d.layers.WMSLayerView2D");let s=class extends B(z(P(_))){initialize(){const{layer:t,view:e}=this;t.supportsSpatialReference(e.spatialReference)||this.addResolvingPromise(Promise.reject(new q("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view",{layer:t})))}update(t){this.strategy.update(t).catch(e=>{I(e)||F.error(e)})}attach(){const{layer:t}=this,{imageMaxHeight:e,imageMaxWidth:i}=t;this._bitmapContainer=new $,this.container.addChild(this._bitmapContainer),this.strategy=new D({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:e,imageMaxWidth:i,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add(this.watch("exportImageVersion",()=>this.requestUpdate()),"exportImageVersion")}detach(){this.handles.remove("exportImageVersion"),this.strategy.destroy(),this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(t){const{view:e}=this,i=this._bitmapContainer,{x:a,y:o}=t,{spatialReference:v}=e;let r=null,n=0,d=0;if(i.children.some(S=>{const{width:l,height:f,resolution:y,x:p,y:m}=S,g=p+y*l,u=m-y*f;return a>=p&&a<=g&&o<=m&&o>=u&&(r=new L({xmin:p,ymin:u,xmax:g,ymax:m,spatialReference:v}),n=l,d=f,!0)}),!r)return null;const c=r.width/n,C=Math.round((a-r.xmin)/c),M=Math.round((r.ymax-o)/c);return{extent:r,width:n,height:d,x:C,y:M}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,i,a){return this.layer.fetchImage(t,e,i,j({timeExtent:this.timeExtent},a))}};h([w()],s.prototype,"strategy",void 0),h([w()],s.prototype,"updating",void 0),s=h([E("esri.views.2d.layers.WMSLayerView2D")],s);const ce=s;export{ce as default};
